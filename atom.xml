<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ç ç ã®Blog</title>
  <icon>https://www.gravatar.com/avatar/4ec65d784d203bac0fd2da7375835dff</icon>
  <subtitle>Just do it!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://yangxiaoge.github.io/"/>
  <updated>2019-03-14T01:40:22.198Z</updated>
  <id>https://yangxiaoge.github.io/</id>
  
  <author>
    <name>Bruce Yang</name>
    <email>yang.jianan0926@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Flutter çŠ¶æ€ç®¡ç† - BLoC</title>
    <link href="https://yangxiaoge.github.io/2019/03/14/2019-3-14-Flutter-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86-Bloc/"/>
    <id>https://yangxiaoge.github.io/2019/03/14/2019-3-14-Flutter-çŠ¶æ€ç®¡ç†-Bloc/</id>
    <published>2019-03-14T09:20:49.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p><code>BLoC</code> æ˜¯ Google æå‡ºçš„ä¸€ç§å…¨æ–°çš„<code>çŠ¶æ€ç®¡ç†</code>æ–¹æ¡ˆã€‚<a href="https://juejin.im/post/5b97fa0d5188255c5546dcf8" target="_blank" rel="noopener">Scoped Model</a>ï¼Œ<a href="https://juejin.im/post/5c6d4b52f265da2dc675b407" target="_blank" rel="noopener">Provide</a>ç­‰ä¹Ÿæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆã€‚</p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†"><a href="#ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†"></a>ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†</h2><p>Flutter è‡ªèº«å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†çŠ¶æ€ç®¡ç† <code>Stateful widget</code>ï¼Œåœ¨ stateful widget ä¸­ï¼Œæˆ‘ä»¬ widget çš„æè¿°ä¿¡æ¯è¢«æ”¾è¿›äº† Stateï¼Œ<br>è€Œ stateful widget åªæ˜¯æŒæœ‰ä¸€äº› immutable çš„æ•°æ®ä»¥åŠåˆ›å»ºå®ƒçš„çŠ¶æ€è€Œå·²ã€‚å®ƒçš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½åº”è¯¥æ˜¯ final çš„ï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œ<br>æˆ‘ä»¬éœ€è¦é€šçŸ¥è§†å›¾é‡æ–°ç»˜åˆ¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ setStateã€‚è¿™çœ‹ä¸Šå»å¾ˆä¸é”™ï¼Œæˆ‘ä»¬æ”¹å˜çŠ¶æ€çš„æ—¶å€™ <code>setState</code> ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚<br>åœ¨æˆ‘ä»¬ä¸€å¼€å§‹æ„å»ºåº”ç”¨çš„æ—¶å€™ï¼Œä¹Ÿè®¸å¾ˆç®€å•ï¼Œæˆ‘ä»¬è¿™æ—¶å€™å¯èƒ½å¹¶ä¸éœ€è¦çŠ¶æ€ç®¡ç†ã€‚<br><img src="https://raw.githubusercontent.com/yangxiaoge/PersonResources/master/flutter/setState%E7%AE%80%E5%8D%95%E5%9E%8B.png" alt><br>ä½†æ˜¯éšç€åŠŸèƒ½çš„å¢åŠ ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°†ä¼šæœ‰å‡ åä¸ªç”šè‡³ä¸Šç™¾ä¸ªçŠ¶æ€ã€‚è¿™ä¸ªæ—¶å€™ä½ çš„åº”ç”¨åº”è¯¥ä¼šæ˜¯è¿™æ ·ï¼<br><img src="https://raw.githubusercontent.com/yangxiaoge/PersonResources/master/flutter/setState%E5%A4%8D%E6%9D%82%E5%9E%8B.png" alt><br>ä¸€æ—¦å½“ app çš„äº¤äº’å˜å¾—å¤æ‚ï¼ŒsetState å‡ºç°çš„æ¬¡æ•°ä¾¿ä¼šæ˜¾è‘—å¢åŠ ï¼Œæ¯æ¬¡ setState éƒ½ä¼šé‡æ–°è°ƒç”¨ build æ–¹æ³•ï¼Œè¿™åŠ¿å¿…å¯¹äºæ€§èƒ½ä»¥åŠä»£ç çš„å¯é˜…è¯»æ€§å¸¦æ¥ä¸€å®šçš„å½±å“ã€‚<br>èƒ½ä¸èƒ½ä¸ä½¿ç”¨ setState å°±èƒ½åˆ·æ–°é¡µé¢å‘¢ï¼Ÿå¦‚ä½•åœ¨å¤šä¸ªé¡µé¢ä¸­å…±äº«çŠ¶æ€ï¼Ÿæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ç§æ›´åŠ å¼ºå¤§çš„æ–¹å¼ï¼Œæ¥ç®¡ç†æˆ‘ä»¬çš„çŠ¶æ€ã€‚</p><h2 id="BLoC-æ˜¯ä»€ä¹ˆ"><a href="#BLoC-æ˜¯ä»€ä¹ˆ" class="headerlink" title="BLoC æ˜¯ä»€ä¹ˆ"></a>BLoC æ˜¯ä»€ä¹ˆ</h2><p><code>BLoC</code> æ˜¯ä¸€ç§åˆ©ç”¨ <code>Reactive Programmingï¼ˆå“åº”å¼ç¼–ç¨‹ï¼‰</code> æ–¹å¼æ„å»ºåº”ç”¨çš„æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±æµæ„æˆçš„å®Œå…¨å¼‚æ­¥çš„ä¸–ç•Œã€‚<br><img src="https://raw.githubusercontent.com/yangxiaoge/PersonResources/master/flutter/bloc.png" alt></p><ol><li>ç”¨ StreamBuilder åŒ…è£¹æœ‰çŠ¶æ€çš„éƒ¨ä»¶ï¼Œstreambuilder å°†ä¼šç›‘å¬ä¸€ä¸ªæµ</li><li>è¿™ä¸ªæµæ¥è‡ªäº BLoC</li><li>æœ‰çŠ¶æ€å°éƒ¨ä»¶ä¸­çš„æ•°æ®æ¥è‡ªäºç›‘å¬çš„æµã€‚</li><li>ç”¨æˆ·äº¤äº’æ‰‹åŠ¿è¢«æ£€æµ‹åˆ°ï¼Œäº§ç”Ÿäº†äº‹ä»¶ã€‚ä¾‹å¦‚æŒ‰äº†ä¸€ä¸‹æŒ‰é’®ã€‚</li><li>è°ƒç”¨ bloc çš„åŠŸèƒ½æ¥å¤„ç†è¿™ä¸ªäº‹ä»¶</li><li>åœ¨ bloc ä¸­å¤„ç†å®Œæ¯•åå°†ä¼šå§æœ€æ–°çš„æ•°æ® add è¿›æµçš„ sink ä¸­</li><li>StreamBuilder ç›‘å¬åˆ°æ–°çš„æ•°æ®ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„ snapshotï¼Œå¹¶é‡æ–°è°ƒç”¨ build æ–¹æ³•</li><li>Widget è¢«é‡æ–°æ„å»º</li></ol><p>BLoC èƒ½å¤Ÿå…è®¸æˆ‘ä»¬å®Œç¾çš„åˆ†ç¦»ä¸šåŠ¡é€»è¾‘ï¼å†ä¹Ÿä¸ç”¨è€ƒè™‘ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ·æ–°å±å¹•äº†ï¼Œä¸€åˆ‡äº¤ç»™ StreamBuilder å’Œ BLoC! å’Œ StatefulWidget è¯´æ‹œæ‹œï¼ï¼</p><p>BLoC ä»£è¡¨ä¸šåŠ¡é€»è¾‘ç»„ä»¶ï¼ˆ<code>Business Logic Component</code>ï¼‰ï¼Œç”±æ¥è‡ª Google çš„ä¸¤ä½å·¥ç¨‹å¸ˆ Paolo Soares å’Œ Cong Hui è®¾è®¡ï¼Œå¹¶åœ¨ 2018 å¹´ DartConf æœŸé—´ï¼ˆ2018 å¹´ 1 æœˆ 23 æ—¥è‡³ 24 æ—¥ï¼‰é¦–æ¬¡å±•ç¤ºã€‚<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DPLHln7wHgPE" target="_blank" rel="noopener">ç‚¹å‡»è§‚çœ‹ Youtube è§†é¢‘ã€‚</a></p><blockquote><p>ä½œè€…ï¼šVadaski<br>é“¾æ¥ï¼š<a href="https://juejin.im/post/5bb6f344f265da0aa664d68a" target="_blank" rel="noopener">https://juejin.im/post/5bb6f344f265da0aa664d68a</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;BLoC&lt;/code&gt; æ˜¯ Google æå‡ºçš„ä¸€ç§å…¨æ–°çš„&lt;code&gt;çŠ¶æ€ç®¡ç†&lt;/code&gt;æ–¹æ¡ˆã€‚&lt;a href=&quot;https://juejin.im/post/5b97fa0d5188255c5546dcf8&quot; target=&quot;_blank&quot; rel=&quot;noo
      
    
    </summary>
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/categories/Flutter/"/>
    
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter_Go ä»£ç å¼€å‘è§„èŒƒ - alibaba</title>
    <link href="https://yangxiaoge.github.io/2019/02/28/2019-02-28-Flutter_Go%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/"/>
    <id>https://yangxiaoge.github.io/2019/02/28/2019-02-28-Flutter_Go ä»£ç å¼€å‘è§„èŒƒ/</id>
    <published>2019-02-28T10:27:22.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<blockquote><ul><li>åŸæ–‡åœ°å€ï¼š<a href="https://github.com/alibaba/flutter-go/blob/develop/Flutter_Go%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83.md" target="_blank" rel="noopener">Flutter Go å¼€å‘è§„èŒƒç¬¬ä¸€ç‰ˆ</a></li><li>åŸæ–‡ä½œè€…ï¼š<a href="https://github.com/alibaba" target="_blank" rel="noopener">alibaba</a></li></ul></blockquote><h2 id="ä»£ç é£æ ¼"><a href="#ä»£ç é£æ ¼" class="headerlink" title="ä»£ç é£æ ¼"></a>ä»£ç é£æ ¼</h2><h3 id="æ ‡è¯†ç¬¦ä¸‰ç§ç±»å‹"><a href="#æ ‡è¯†ç¬¦ä¸‰ç§ç±»å‹" class="headerlink" title="æ ‡è¯†ç¬¦ä¸‰ç§ç±»å‹"></a>æ ‡è¯†ç¬¦ä¸‰ç§ç±»å‹</h3><h4 id="å¤§é©¼å³°"><a href="#å¤§é©¼å³°" class="headerlink" title="å¤§é©¼å³°"></a>å¤§é©¼å³°</h4><p>ç±»ã€æšä¸¾ã€typedefå’Œç±»å‹å‚æ•°</p><pre><code>  class SliderMenu { ... }  class HttpRequest { ... }  typedef Predicate = bool Function&lt;T&gt;(T value);</code></pre><p>åŒ…æ‹¬ç”¨äºå…ƒæ•°æ®æ³¨é‡Šçš„ç±»</p><pre><code>  class Foo {    const Foo([arg]);  }  @Foo(anArg)  class A { ... }  @Foo()  class B { ... }</code></pre><h4 id="ä½¿ç”¨å°å†™åŠ ä¸‹åˆ’çº¿æ¥å‘½ååº“å’Œæºæ–‡ä»¶"><a href="#ä½¿ç”¨å°å†™åŠ ä¸‹åˆ’çº¿æ¥å‘½ååº“å’Œæºæ–‡ä»¶" class="headerlink" title="ä½¿ç”¨å°å†™åŠ ä¸‹åˆ’çº¿æ¥å‘½ååº“å’Œæºæ–‡ä»¶"></a>ä½¿ç”¨å°å†™åŠ ä¸‹åˆ’çº¿æ¥å‘½ååº“å’Œæºæ–‡ä»¶</h4><pre><code>  library peg_parser.source_scanner;  import &#39;file_system.dart&#39;;  import &#39;slider_menu.dart&#39;;</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  library pegparser.SourceScanner;  import &#39;file-system.dart&#39;;  import &#39;SliderMenu.dart&#39;;</code></pre><h4 id="ä½¿ç”¨å°å†™åŠ ä¸‹åˆ’çº¿æ¥å‘½åå¯¼å…¥å‰ç¼€"><a href="#ä½¿ç”¨å°å†™åŠ ä¸‹åˆ’çº¿æ¥å‘½åå¯¼å…¥å‰ç¼€" class="headerlink" title="ä½¿ç”¨å°å†™åŠ ä¸‹åˆ’çº¿æ¥å‘½åå¯¼å…¥å‰ç¼€"></a>ä½¿ç”¨å°å†™åŠ ä¸‹åˆ’çº¿æ¥å‘½åå¯¼å…¥å‰ç¼€</h4><pre><code>  import &#39;dart:math&#39; as math;  import &#39;package:angular_components/angular_components&#39;      as angular_components;  import &#39;package:js/js.dart&#39; as js;</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  import &#39;dart:math&#39; as Math;  import &#39;package:angular_components/angular_components&#39;      as angularComponents;  import &#39;package:js/js.dart&#39; as JS;</code></pre><h4 id="ä½¿ç”¨å°é©¼å³°æ³•å‘½åå…¶ä»–æ ‡è¯†ç¬¦"><a href="#ä½¿ç”¨å°é©¼å³°æ³•å‘½åå…¶ä»–æ ‡è¯†ç¬¦" class="headerlink" title="ä½¿ç”¨å°é©¼å³°æ³•å‘½åå…¶ä»–æ ‡è¯†ç¬¦"></a>ä½¿ç”¨å°é©¼å³°æ³•å‘½åå…¶ä»–æ ‡è¯†ç¬¦</h4><pre><code>  var item;  HttpRequest httpRequest;  void align(bool clearItems) {    // ...  }</code></pre><h4 id="ä¼˜å…ˆä½¿ç”¨å°é©¼å³°æ³•ä½œä¸ºå¸¸é‡å‘½å"><a href="#ä¼˜å…ˆä½¿ç”¨å°é©¼å³°æ³•ä½œä¸ºå¸¸é‡å‘½å" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨å°é©¼å³°æ³•ä½œä¸ºå¸¸é‡å‘½å"></a>ä¼˜å…ˆä½¿ç”¨å°é©¼å³°æ³•ä½œä¸ºå¸¸é‡å‘½å</h4><pre><code>  const pi = 3.14;  const defaultTimeout = 1000;  final urlScheme = RegExp(&#39;^([a-z]+):&#39;);  class Dice {    static final numberGenerator = Random();  }</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  const PI = 3.14;  const DefaultTimeout = 1000;  final URL_SCHEME = RegExp(&#39;^([a-z]+):&#39;);  class Dice {    static final NUMBER_GENERATOR = Random();  }</code></pre><h4 id="ä¸ä½¿ç”¨å‰ç¼€å­—æ¯"><a href="#ä¸ä½¿ç”¨å‰ç¼€å­—æ¯" class="headerlink" title="ä¸ä½¿ç”¨å‰ç¼€å­—æ¯"></a>ä¸ä½¿ç”¨å‰ç¼€å­—æ¯</h4><p>å› ä¸ºDartå¯ä»¥å‘Šè¯‰æ‚¨å£°æ˜çš„ç±»å‹ã€èŒƒå›´ã€å¯å˜æ€§å’Œå…¶ä»–å±æ€§ï¼Œæ‰€ä»¥æ²¡æœ‰ç†ç”±å°†è¿™äº›å±æ€§ç¼–ç ä¸ºæ ‡è¯†ç¬¦åç§°ã€‚</p><pre><code>  defaultTimeout</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  kDefaultTimeout</code></pre><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><p>ä¸ºäº†ä½¿ä½ çš„æ–‡ä»¶å‰è¨€ä¿æŒæ•´æ´ï¼Œæˆ‘ä»¬æœ‰è§„å®šçš„å‘½ä»¤ï¼ŒæŒ‡ç¤ºåº”è¯¥å‡ºç°åœ¨å…¶ä¸­ã€‚æ¯ä¸ªâ€œéƒ¨åˆ†â€åº”è¯¥ç”¨ç©ºè¡Œåˆ†éš”ã€‚</p><h4 id="åœ¨å…¶ä»–å¼•å…¥ä¹‹å‰å¼•å…¥æ‰€éœ€çš„dartåº“"><a href="#åœ¨å…¶ä»–å¼•å…¥ä¹‹å‰å¼•å…¥æ‰€éœ€çš„dartåº“" class="headerlink" title="åœ¨å…¶ä»–å¼•å…¥ä¹‹å‰å¼•å…¥æ‰€éœ€çš„dartåº“"></a>åœ¨å…¶ä»–å¼•å…¥ä¹‹å‰å¼•å…¥æ‰€éœ€çš„dartåº“</h4><pre><code>  import &#39;dart:async&#39;;  import &#39;dart:html&#39;;  import &#39;package:bar/bar.dart&#39;;  import &#39;package:foo/foo.dart&#39;;</code></pre><h4 id="åœ¨ç›¸å¯¹å¼•å…¥ä¹‹å‰å…ˆå¼•å…¥åœ¨åŒ…ä¸­çš„åº“"><a href="#åœ¨ç›¸å¯¹å¼•å…¥ä¹‹å‰å…ˆå¼•å…¥åœ¨åŒ…ä¸­çš„åº“" class="headerlink" title="åœ¨ç›¸å¯¹å¼•å…¥ä¹‹å‰å…ˆå¼•å…¥åœ¨åŒ…ä¸­çš„åº“"></a>åœ¨ç›¸å¯¹å¼•å…¥ä¹‹å‰å…ˆå¼•å…¥åœ¨åŒ…ä¸­çš„åº“</h4><pre><code>  import &#39;package:bar/bar.dart&#39;;  import &#39;package:foo/foo.dart&#39;;  import &#39;util.dart&#39;;</code></pre><h4 id="ç¬¬ä¸‰æ–¹åŒ…çš„å¯¼å…¥å…ˆäºå…¶ä»–åŒ…"><a href="#ç¬¬ä¸‰æ–¹åŒ…çš„å¯¼å…¥å…ˆäºå…¶ä»–åŒ…" class="headerlink" title="ç¬¬ä¸‰æ–¹åŒ…çš„å¯¼å…¥å…ˆäºå…¶ä»–åŒ…"></a>ç¬¬ä¸‰æ–¹åŒ…çš„å¯¼å…¥å…ˆäºå…¶ä»–åŒ…</h4><pre><code>  import &#39;package:bar/bar.dart&#39;;  import &#39;package:foo/foo.dart&#39;;  import &#39;package:my_package/util.dart&#39;;</code></pre><h4 id="åœ¨æ‰€æœ‰å¯¼å…¥ä¹‹åï¼Œåœ¨å•ç‹¬çš„éƒ¨åˆ†ä¸­æŒ‡å®šå¯¼å‡º"><a href="#åœ¨æ‰€æœ‰å¯¼å…¥ä¹‹åï¼Œåœ¨å•ç‹¬çš„éƒ¨åˆ†ä¸­æŒ‡å®šå¯¼å‡º" class="headerlink" title="åœ¨æ‰€æœ‰å¯¼å…¥ä¹‹åï¼Œåœ¨å•ç‹¬çš„éƒ¨åˆ†ä¸­æŒ‡å®šå¯¼å‡º"></a>åœ¨æ‰€æœ‰å¯¼å…¥ä¹‹åï¼Œåœ¨å•ç‹¬çš„éƒ¨åˆ†ä¸­æŒ‡å®šå¯¼å‡º</h4><pre><code>  import &#39;src/error.dart&#39;;  import &#39;src/foo_bar.dart&#39;;  export &#39;src/error.dart&#39;;</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  import &#39;src/error.dart&#39;;  export &#39;src/error.dart&#39;;  import &#39;src/foo_bar.dart&#39;;</code></pre><h3 id="æ‰€æœ‰æµæ§åˆ¶ç»“æ„ï¼Œè¯·ä½¿ç”¨å¤§æ‹¬å·"><a href="#æ‰€æœ‰æµæ§åˆ¶ç»“æ„ï¼Œè¯·ä½¿ç”¨å¤§æ‹¬å·" class="headerlink" title="æ‰€æœ‰æµæ§åˆ¶ç»“æ„ï¼Œè¯·ä½¿ç”¨å¤§æ‹¬å·"></a>æ‰€æœ‰æµæ§åˆ¶ç»“æ„ï¼Œè¯·ä½¿ç”¨å¤§æ‹¬å·</h3><p>è¿™æ ·åšå¯ä»¥é¿å…æ‚¬æµ®çš„elseé—®é¢˜</p><pre><code>  if (isWeekDay) {    print(&#39;Bike to work!&#39;);  } else {    print(&#39;Go dancing or read a book!&#39;);  }</code></pre><h4 id="ä¾‹å¤–"><a href="#ä¾‹å¤–" class="headerlink" title="ä¾‹å¤–"></a>ä¾‹å¤–</h4><p>ä¸€ä¸ªifè¯­å¥æ²¡æœ‰elseå­å¥ï¼Œå…¶ä¸­æ•´ä¸ªifè¯­å¥å’Œthenä¸»ä½“éƒ½é€‚åˆä¸€è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½ å–œæ¬¢çš„è¯ï¼Œä½ å¯ä»¥å»æ‰å¤§æ‹¬å·</p><pre><code>  if (arg == null) return defaultValue;</code></pre><p>å¦‚æœæµç¨‹ä½“è¶…å‡ºäº†ä¸€è¡Œéœ€è¦åˆ†åˆ’è¯·ä½¿ç”¨å¤§æ‹¬å·ï¼š</p><pre><code>  if (overflowChars != other.overflowChars) {    return overflowChars &lt; other.overflowChars;  }</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  if (overflowChars != other.overflowChars)    return overflowChars &lt; other.overflowChars;</code></pre><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><h3 id="è¦åƒå¥å­ä¸€æ ·æ ¼å¼åŒ–"><a href="#è¦åƒå¥å­ä¸€æ ·æ ¼å¼åŒ–" class="headerlink" title="è¦åƒå¥å­ä¸€æ ·æ ¼å¼åŒ–"></a>è¦åƒå¥å­ä¸€æ ·æ ¼å¼åŒ–</h3><p>é™¤éæ˜¯åŒºåˆ†å¤§å°å†™çš„æ ‡è¯†ç¬¦ï¼Œå¦åˆ™ç¬¬ä¸€ä¸ªå•è¯è¦å¤§å†™ã€‚ä»¥å¥å·ç»“å°¾(æˆ–â€œ!â€æˆ–â€œ?â€)ã€‚å¯¹äºæ‰€æœ‰çš„æ³¨é‡Šéƒ½æ˜¯å¦‚æ­¤ï¼šdocæ³¨é‡Šã€å†…è”å†…å®¹ï¼Œç”šè‡³TODOsã€‚å³ä½¿æ˜¯ä¸€ä¸ªå¥å­ç‰‡æ®µã€‚</p><pre><code>  greet(name) {    // Assume we have a valid name.    print(&#39;Hi, $name!&#39;);  }</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  greet(name) {    /* Assume we have a valid name. */    print(&#39;Hi, $name!&#39;);  }</code></pre><p>å¯ä»¥ä½¿ç”¨å—æ³¨é‡Š(/â€¦/)ä¸´æ—¶æ³¨é‡Šæ‰ä¸€æ®µä»£ç ï¼Œä½†æ˜¯æ‰€æœ‰å…¶ä»–æ³¨é‡Šéƒ½åº”è¯¥ä½¿ç”¨//</p><h3 id="Docæ³¨é‡Š"><a href="#Docæ³¨é‡Š" class="headerlink" title="Docæ³¨é‡Š"></a>Docæ³¨é‡Š</h3><p>ä½¿ç”¨///æ–‡æ¡£æ³¨é‡Šæ¥è®°å½•æˆå‘˜å’Œç±»å‹ã€‚</p><p>ä½¿ç”¨docæ³¨é‡Šè€Œä¸æ˜¯å¸¸è§„æ³¨é‡Šï¼Œå¯ä»¥è®©dartdocæ‰¾åˆ°å¹¶ç”Ÿæˆæ–‡æ¡£ã€‚</p><pre><code>  /// The number of characters in this chunk when unsplit.  int get length =&gt; ...</code></pre><blockquote><p>ç”±äºå†å²åŸå› ï¼Œè¾¾ç‰¹èŒ…æ–¯å­¦é™¢æ”¯æŒé“æ ¼è¯„è®ºçš„ä¸¤ç§è¯­æ³•:///(â€œC#é£æ ¼â€)å’Œ/<strong>â€¦* /(â€œJavaDocé£æ ¼â€)ã€‚æˆ‘ä»¬æ›´å–œæ¬¢/// å› ä¸ºå®ƒæ›´ç´§å‡‘ã€‚/</strong>å’Œ<em>/åœ¨å¤šè¡Œæ–‡æ¡£æ³¨é‡Šä¸­æ·»åŠ ä¸¤ä¸ªæ— å†…å®¹çš„è¡Œã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ///è¯­æ³•ä¹Ÿæ›´å®¹æ˜“é˜…è¯»ï¼Œä¾‹å¦‚æ–‡æ¡£æ³¨é‡ŠåŒ…å«ä½¿ç”¨</em>æ ‡è®°åˆ—è¡¨é¡¹çš„é¡¹ç›®ç¬¦å·åˆ—è¡¨ã€‚</p></blockquote><h3 id="è€ƒè™‘ä¸ºç§æœ‰apiç¼–å†™æ–‡æ¡£æ³¨é‡Š"><a href="#è€ƒè™‘ä¸ºç§æœ‰apiç¼–å†™æ–‡æ¡£æ³¨é‡Š" class="headerlink" title="è€ƒè™‘ä¸ºç§æœ‰apiç¼–å†™æ–‡æ¡£æ³¨é‡Š"></a>è€ƒè™‘ä¸ºç§æœ‰apiç¼–å†™æ–‡æ¡£æ³¨é‡Š</h3><p>Docæ³¨é‡Šå¹¶ä¸ä»…ä»…é’ˆå¯¹åº“çš„å…¬å…±APIçš„å¤–éƒ¨ä½¿ç”¨è€…ã€‚å®ƒä»¬è¿˜æœ‰åŠ©äºç†è§£ä»åº“çš„å…¶ä»–éƒ¨åˆ†è°ƒç”¨çš„ç§æœ‰æˆå‘˜</p><h4 id="ç”¨ä¸€å¥è¯æ€»ç»“å¼€å§‹docæ³¨é‡Š"><a href="#ç”¨ä¸€å¥è¯æ€»ç»“å¼€å§‹docæ³¨é‡Š" class="headerlink" title="ç”¨ä¸€å¥è¯æ€»ç»“å¼€å§‹docæ³¨é‡Š"></a>ç”¨ä¸€å¥è¯æ€»ç»“å¼€å§‹docæ³¨é‡Š</h4><p>ä»¥ç®€çŸ­çš„ã€ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„æè¿°å¼€å§‹ä½ çš„æ–‡æ¡£æ³¨é‡Šï¼Œä»¥å¥å·ç»“å°¾ã€‚</p><pre><code>/// Deletes the file at [path] from the file system.void delete(String path) {  ...}</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  /// Depending on the state of the file system and the user&#39;s permissions,  /// certain operations may or may not be possible. If there is no file at  /// [path] or it can&#39;t be accessed, this function throws either [IOError]  /// or [PermissionError], respectively. Otherwise, this deletes the file.  void delete(String path) {    ...  }</code></pre><h4 id="â€œdocæ³¨é‡Šâ€çš„ç¬¬ä¸€å¥è¯åˆ†éš”æˆè‡ªå·±çš„æ®µè½"><a href="#â€œdocæ³¨é‡Šâ€çš„ç¬¬ä¸€å¥è¯åˆ†éš”æˆè‡ªå·±çš„æ®µè½" class="headerlink" title="â€œdocæ³¨é‡Šâ€çš„ç¬¬ä¸€å¥è¯åˆ†éš”æˆè‡ªå·±çš„æ®µè½"></a>â€œdocæ³¨é‡Šâ€çš„ç¬¬ä¸€å¥è¯åˆ†éš”æˆè‡ªå·±çš„æ®µè½</h4><p>åœ¨ç¬¬ä¸€ä¸ªå¥å­ä¹‹åæ·»åŠ ä¸€ä¸ªç©ºè¡Œï¼ŒæŠŠå®ƒåˆ†æˆè‡ªå·±çš„æ®µè½</p><pre><code>  /// Deletes the file at [path].  ///  /// Throws an [IOError] if the file could not be found. Throws a  /// [PermissionError] if the file is present but could not be deleted.  void delete(String path) {    ...  }</code></pre><h2 id="Flutter-Go-ä½¿ç”¨å‚è€ƒ"><a href="#Flutter-Go-ä½¿ç”¨å‚è€ƒ" class="headerlink" title="Flutter_Go ä½¿ç”¨å‚è€ƒ"></a>Flutter_Go ä½¿ç”¨å‚è€ƒ</h2><h3 id="åº“çš„å¼•ç”¨"><a href="#åº“çš„å¼•ç”¨" class="headerlink" title="åº“çš„å¼•ç”¨"></a>åº“çš„å¼•ç”¨</h3><p>flutter go ä¸­ï¼Œå¯¼å…¥libä¸‹æ–‡ä»¶åº“ï¼Œç»Ÿä¸€æŒ‡å®šåŒ…åï¼Œé¿å…è¿‡å¤šçš„<code>../../</code></p><pre><code>package:flutter_go/</code></pre><h3 id="å­—ç¬¦ä¸²çš„ä½¿ç”¨"><a href="#å­—ç¬¦ä¸²çš„ä½¿ç”¨" class="headerlink" title="å­—ç¬¦ä¸²çš„ä½¿ç”¨"></a>å­—ç¬¦ä¸²çš„ä½¿ç”¨</h3><h4 id="ä½¿ç”¨ç›¸é‚»å­—ç¬¦ä¸²è¿æ¥å­—ç¬¦ä¸²æ–‡å­—"><a href="#ä½¿ç”¨ç›¸é‚»å­—ç¬¦ä¸²è¿æ¥å­—ç¬¦ä¸²æ–‡å­—" class="headerlink" title="ä½¿ç”¨ç›¸é‚»å­—ç¬¦ä¸²è¿æ¥å­—ç¬¦ä¸²æ–‡å­—"></a>ä½¿ç”¨ç›¸é‚»å­—ç¬¦ä¸²è¿æ¥å­—ç¬¦ä¸²æ–‡å­—</h4><p>å¦‚æœæœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼(ä¸æ˜¯å€¼ï¼Œè€Œæ˜¯å®é™…å¼•ç”¨çš„å­—é¢å€¼)ï¼Œåˆ™ä¸éœ€è¦ä½¿ç”¨+è¿æ¥å®ƒä»¬ã€‚å°±åƒåœ¨Cå’Œc++ä¸­ï¼Œç®€å•åœ°æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·å°±èƒ½åšåˆ°ã€‚è¿™æ˜¯åˆ›å»ºä¸€ä¸ªé•¿å­—ç¬¦ä¸²å¾ˆå¥½çš„æ–¹æ³•ä½†æ˜¯ä¸é€‚ç”¨äºå•ç‹¬ä¸€è¡Œã€‚</p><pre><code>raiseAlarm(    &#39;ERROR: Parts of the spaceship are on fire. Other &#39;    &#39;parts are overrun by martians. Unclear which are which.&#39;);</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•:</p><pre><code>raiseAlarm(&#39;ERROR: Parts of the spaceship are on fire. Other &#39; +    &#39;parts are overrun by martians. Unclear which are which.&#39;);</code></pre><h4 id="ä¼˜å…ˆä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²"><a href="#ä¼˜å…ˆä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²"></a>ä¼˜å…ˆä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²</h4><pre><code>&#39;Hello, $name! You are ${year - birth} years old.&#39;;</code></pre><h4 id="åœ¨ä¸éœ€è¦çš„æ—¶å€™ï¼Œé¿å…ä½¿ç”¨èŠ±æ‹¬å·"><a href="#åœ¨ä¸éœ€è¦çš„æ—¶å€™ï¼Œé¿å…ä½¿ç”¨èŠ±æ‹¬å·" class="headerlink" title="åœ¨ä¸éœ€è¦çš„æ—¶å€™ï¼Œé¿å…ä½¿ç”¨èŠ±æ‹¬å·"></a>åœ¨ä¸éœ€è¦çš„æ—¶å€™ï¼Œé¿å…ä½¿ç”¨èŠ±æ‹¬å·</h4><pre><code>  &#39;Hi, $name!&#39;  &quot;Wear your wildest $decade&#39;s outfit.&quot;</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  &#39;Hello, &#39; + name + &#39;! You are &#39; + (year - birth).toString() + &#39; y...&#39;;</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  &#39;Hi, ${name}!&#39;  &quot;Wear your wildest ${decade}&#39;s outfit.&quot;</code></pre><h3 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h3><h4 id="å°½å¯èƒ½ä½¿ç”¨é›†åˆå­—é¢é‡"><a href="#å°½å¯èƒ½ä½¿ç”¨é›†åˆå­—é¢é‡" class="headerlink" title="å°½å¯èƒ½ä½¿ç”¨é›†åˆå­—é¢é‡"></a>å°½å¯èƒ½ä½¿ç”¨é›†åˆå­—é¢é‡</h4><p>å¦‚æœè¦åˆ›å»ºä¸€ä¸ªä¸å¯å¢é•¿çš„åˆ—è¡¨ï¼Œæˆ–è€…å…¶ä»–ä¸€äº›è‡ªå®šä¹‰é›†åˆç±»å‹ï¼Œé‚£ä¹ˆæ— è®ºå¦‚ä½•ï¼Œéƒ½è¦ä½¿ç”¨æ„é€ å‡½æ•°ã€‚</p><pre><code>  var points = [];  var addresses = {};  var lines = &lt;Lines&gt;[];</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  var points = List();  var addresses = Map();</code></pre><h4 id="ä¸è¦ä½¿ç”¨-lengthæŸ¥çœ‹é›†åˆæ˜¯å¦ä¸ºç©º"><a href="#ä¸è¦ä½¿ç”¨-lengthæŸ¥çœ‹é›†åˆæ˜¯å¦ä¸ºç©º" class="headerlink" title="ä¸è¦ä½¿ç”¨.lengthæŸ¥çœ‹é›†åˆæ˜¯å¦ä¸ºç©º"></a>ä¸è¦ä½¿ç”¨.lengthæŸ¥çœ‹é›†åˆæ˜¯å¦ä¸ºç©º</h4><pre><code>if (lunchBox.isEmpty) return &#39;so hungry...&#39;;if (words.isNotEmpty) return words.join(&#39; &#39;);</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  if (lunchBox.length == 0) return &#39;so hungry...&#39;;  if (!words.isEmpty) return words.join(&#39; &#39;);</code></pre><h4 id="è€ƒè™‘ä½¿ç”¨é«˜é˜¶æ–¹æ³•è½¬æ¢åºåˆ—"><a href="#è€ƒè™‘ä½¿ç”¨é«˜é˜¶æ–¹æ³•è½¬æ¢åºåˆ—" class="headerlink" title="è€ƒè™‘ä½¿ç”¨é«˜é˜¶æ–¹æ³•è½¬æ¢åºåˆ—"></a>è€ƒè™‘ä½¿ç”¨é«˜é˜¶æ–¹æ³•è½¬æ¢åºåˆ—</h4><p>å¦‚æœæœ‰ä¸€ä¸ªé›†åˆï¼Œå¹¶ä¸”å¸Œæœ›ä»ä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„ä¿®æ”¹åçš„é›†åˆï¼Œé‚£ä¹ˆä½¿ç”¨.map()ã€.where()å’ŒIterableä¸Šçš„å…¶ä»–æ–¹ä¾¿çš„æ–¹æ³•é€šå¸¸æ›´çŸ­ï¼Œä¹Ÿæ›´å…·æœ‰å£°æ˜æ€§</p><pre><code>  var aquaticNames = animals      .where((animal) =&gt; animal.isAquatic)      .map((animal) =&gt; animal.name);</code></pre><h4 id="é¿å…ä½¿ç”¨å¸¦æœ‰å‡½æ•°å­—é¢é‡çš„Iterable-forEach"><a href="#é¿å…ä½¿ç”¨å¸¦æœ‰å‡½æ•°å­—é¢é‡çš„Iterable-forEach" class="headerlink" title="é¿å…ä½¿ç”¨å¸¦æœ‰å‡½æ•°å­—é¢é‡çš„Iterable.forEach()"></a>é¿å…ä½¿ç”¨å¸¦æœ‰å‡½æ•°å­—é¢é‡çš„Iterable.forEach()</h4><p>åœ¨Dartä¸­ï¼Œå¦‚æœä½ æƒ³éå†ä¸€ä¸ªåºåˆ—ï¼Œæƒ¯ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨å¾ªç¯ã€‚</p><pre><code>for (var person in people) {  ...}</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  people.forEach((person) {    ...  });</code></pre><h4 id="ä¸è¦ä½¿ç”¨List-from-ï¼Œé™¤éæ‰“ç®—æ›´æ”¹ç»“æœçš„ç±»å‹"><a href="#ä¸è¦ä½¿ç”¨List-from-ï¼Œé™¤éæ‰“ç®—æ›´æ”¹ç»“æœçš„ç±»å‹" class="headerlink" title="ä¸è¦ä½¿ç”¨List.from()ï¼Œé™¤éæ‰“ç®—æ›´æ”¹ç»“æœçš„ç±»å‹"></a>ä¸è¦ä½¿ç”¨List.from()ï¼Œé™¤éæ‰“ç®—æ›´æ”¹ç»“æœçš„ç±»å‹</h4><p>ç»™å®šä¸€ä¸ªè¿­ä»£ï¼Œæœ‰ä¸¤ç§æ˜æ˜¾çš„æ–¹æ³•å¯ä»¥ç”ŸæˆåŒ…å«ç›¸åŒå…ƒç´ çš„æ–°åˆ—è¡¨</p><pre><code>var copy1 = iterable.toList();var copy2 = List.from(iterable);</code></pre><p>æ˜æ˜¾çš„åŒºåˆ«æ˜¯ç¬¬ä¸€ä¸ªæ¯”è¾ƒçŸ­ã€‚é‡è¦çš„åŒºåˆ«æ˜¯ç¬¬ä¸€ä¸ªä¿ç•™äº†åŸå§‹å¯¹è±¡çš„ç±»å‹å‚æ•°</p><pre><code>// Creates a List&lt;int&gt;:var iterable = [1, 2, 3];// Prints &quot;List&lt;int&gt;&quot;:print(iterable.toList().runtimeType);</code></pre><pre><code>// Creates a List&lt;int&gt;:var iterable = [1, 2, 3];// Prints &quot;List&lt;dynamic&gt;&quot;:print(List.from(iterable).runtimeType);</code></pre><h3 id="å‚æ•°çš„ä½¿ç”¨"><a href="#å‚æ•°çš„ä½¿ç”¨" class="headerlink" title="å‚æ•°çš„ä½¿ç”¨"></a>å‚æ•°çš„ä½¿ç”¨</h3><h4 id="ä½¿ç”¨-å°†å‘½åå‚æ•°ä¸å…¶é»˜è®¤å€¼åˆ†å‰²å¼€"><a href="#ä½¿ç”¨-å°†å‘½åå‚æ•°ä¸å…¶é»˜è®¤å€¼åˆ†å‰²å¼€" class="headerlink" title="ä½¿ç”¨=å°†å‘½åå‚æ•°ä¸å…¶é»˜è®¤å€¼åˆ†å‰²å¼€"></a>ä½¿ç”¨=å°†å‘½åå‚æ•°ä¸å…¶é»˜è®¤å€¼åˆ†å‰²å¼€</h4><p>ç”±äºé—ç•™åŸå› ï¼ŒDartå‡å…è®¸â€œ:â€å’Œâ€œ=â€ä½œä¸ºæŒ‡å®šå‚æ•°çš„é»˜è®¤å€¼åˆ†éš”ç¬¦ã€‚ä¸ºäº†ä¸å¯é€‰çš„ä½ç½®å‚æ•°ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨â€œ=â€ã€‚</p><pre><code>  void insert(Object item, {int at = 0}) { ... }</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  void insert(Object item, {int at: 0}) { ... }</code></pre><h4 id="ä¸è¦ä½¿ç”¨æ˜¾å¼é»˜è®¤å€¼null"><a href="#ä¸è¦ä½¿ç”¨æ˜¾å¼é»˜è®¤å€¼null" class="headerlink" title="ä¸è¦ä½¿ç”¨æ˜¾å¼é»˜è®¤å€¼null"></a>ä¸è¦ä½¿ç”¨æ˜¾å¼é»˜è®¤å€¼null</h4><p>å¦‚æœå‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½†æ²¡æœ‰ç»™å®ƒä¸€ä¸ªé»˜è®¤å€¼ï¼Œåˆ™è¯­è¨€éšå¼åœ°ä½¿ç”¨nullä½œä¸ºé»˜è®¤å€¼ï¼Œå› æ­¤ä¸éœ€è¦ç¼–å†™å®ƒ</p><pre><code>void error([String message]) {  stderr.write(message ?? &#39;\n&#39;);}</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•:</p><pre><code>void error([String message = null]) {  stderr.write(message ?? &#39;\n&#39;);}</code></pre><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><h4 id="ä¸è¦æ˜¾å¼åœ°å°†å˜é‡åˆå§‹åŒ–ä¸ºç©º"><a href="#ä¸è¦æ˜¾å¼åœ°å°†å˜é‡åˆå§‹åŒ–ä¸ºç©º" class="headerlink" title="ä¸è¦æ˜¾å¼åœ°å°†å˜é‡åˆå§‹åŒ–ä¸ºç©º"></a>ä¸è¦æ˜¾å¼åœ°å°†å˜é‡åˆå§‹åŒ–ä¸ºç©º</h4><p>åœ¨Dartä¸­ï¼Œæœªæ˜¾å¼åˆå§‹åŒ–çš„å˜é‡æˆ–å­—æ®µè‡ªåŠ¨è¢«åˆå§‹åŒ–ä¸ºnullã€‚ä¸è¦å¤šä½™èµ‹å€¼null</p><pre><code>  int _nextId;  class LazyId {    int _id;    int get id {      if (_nextId == null) _nextId = 0;      if (_id == null) _id = _nextId++;      return _id;    }  }</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  int _nextId = null;  class LazyId {    int _id = null;    int get id {      if (_nextId == null) _nextId = 0;      if (_id == null) _id = _nextId++;      return _id;    }  }</code></pre><h4 id="é¿å…å‚¨å­˜ä½ èƒ½è®¡ç®—çš„ä¸œè¥¿"><a href="#é¿å…å‚¨å­˜ä½ èƒ½è®¡ç®—çš„ä¸œè¥¿" class="headerlink" title="é¿å…å‚¨å­˜ä½ èƒ½è®¡ç®—çš„ä¸œè¥¿"></a>é¿å…å‚¨å­˜ä½ èƒ½è®¡ç®—çš„ä¸œè¥¿</h4><p>åœ¨è®¾è®¡ç±»æ—¶ï¼Œæ‚¨é€šå¸¸å¸Œæœ›å°†å¤šä¸ªè§†å›¾å…¬å¼€åˆ°ç›¸åŒçš„åº•å±‚çŠ¶æ€ã€‚é€šå¸¸ä½ ä¼šçœ‹åˆ°åœ¨æ„é€ å‡½æ•°ä¸­è®¡ç®—æ‰€æœ‰è§†å›¾çš„ä»£ç ï¼Œç„¶åå­˜å‚¨å®ƒä»¬:</p><p>åº”è¯¥é¿å…çš„å†™æ³•ï¼š</p><pre><code>  class Circle {    num radius;    num area;    num circumference;    Circle(num radius)        : radius = radius,          area = pi * radius * radius,          circumference = pi * 2.0 * radius;  }</code></pre><p>å¦‚ä¸Šä»£ç é—®é¢˜ï¼š</p><ul><li>æµªè´¹å†…å­˜</li><li>ç¼“å­˜çš„é—®é¢˜æ˜¯æ— æ•ˆâ€”â€”å¦‚ä½•çŸ¥é“ä½•æ—¶ç¼“å­˜è¿‡æœŸéœ€è¦é‡æ–°è®¡ç®—ï¼Ÿ</li></ul><p>æ¨èçš„å†™æ³•å¦‚ä¸‹ï¼š</p><pre><code>  class Circle {    num radius;    Circle(this.radius);    num get area =&gt; pi * radius * radius;    num get circumference =&gt; pi * 2.0 * radius;  }</code></pre><h3 id="ç±»æˆå‘˜"><a href="#ç±»æˆå‘˜" class="headerlink" title="ç±»æˆå‘˜"></a>ç±»æˆå‘˜</h3><h4 id="ä¸è¦æŠŠä¸å¿…è¦åœ°å°†å­—æ®µåŒ…è£…åœ¨getterå’Œsetterä¸­"><a href="#ä¸è¦æŠŠä¸å¿…è¦åœ°å°†å­—æ®µåŒ…è£…åœ¨getterå’Œsetterä¸­" class="headerlink" title="ä¸è¦æŠŠä¸å¿…è¦åœ°å°†å­—æ®µåŒ…è£…åœ¨getterå’Œsetterä¸­"></a>ä¸è¦æŠŠä¸å¿…è¦åœ°å°†å­—æ®µåŒ…è£…åœ¨getterå’Œsetterä¸­</h4><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  class Box {    var _contents;    get contents =&gt; _contents;    set contents(value) {      _contents = value;    }  }</code></pre><h4 id="ä¼˜å…ˆä½¿ç”¨finalå­—æ®µæ¥åˆ›å»ºåªè¯»å±æ€§"><a href="#ä¼˜å…ˆä½¿ç”¨finalå­—æ®µæ¥åˆ›å»ºåªè¯»å±æ€§" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨finalå­—æ®µæ¥åˆ›å»ºåªè¯»å±æ€§"></a>ä¼˜å…ˆä½¿ç”¨finalå­—æ®µæ¥åˆ›å»ºåªè¯»å±æ€§</h4><p>å°¤å…¶å¯¹äº <code>StatelessWidget</code></p><h4 id="åœ¨ä¸éœ€è¦çš„æ—¶å€™ä¸è¦ç”¨this"><a href="#åœ¨ä¸éœ€è¦çš„æ—¶å€™ä¸è¦ç”¨this" class="headerlink" title="åœ¨ä¸éœ€è¦çš„æ—¶å€™ä¸è¦ç”¨this"></a>åœ¨ä¸éœ€è¦çš„æ—¶å€™ä¸è¦ç”¨this</h4><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  class Box {    var value;    void clear() {      this.update(null);    }    void update(value) {      this.value = value;    }  }</code></pre><p>æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  class Box {    var value;    void clear() {      update(null);    }    void update(value) {      this.value = value;    }  }</code></pre><h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><h4 id="å°½å¯èƒ½ä½¿ç”¨åˆå§‹åŒ–çš„å½¢å¼"><a href="#å°½å¯èƒ½ä½¿ç”¨åˆå§‹åŒ–çš„å½¢å¼" class="headerlink" title="å°½å¯èƒ½ä½¿ç”¨åˆå§‹åŒ–çš„å½¢å¼"></a>å°½å¯èƒ½ä½¿ç”¨åˆå§‹åŒ–çš„å½¢å¼</h4><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  class Point {    num x, y;    Point(num x, num y) {      this.x = x;      this.y = y;    }  }</code></pre><p>æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>class Point {  num x, y;  Point(this.x, this.y);}</code></pre><h4 id="ä¸è¦ä½¿ç”¨new"><a href="#ä¸è¦ä½¿ç”¨new" class="headerlink" title="ä¸è¦ä½¿ç”¨new"></a>ä¸è¦ä½¿ç”¨new</h4><p>Dart2ä½¿new å…³é”®å­—å¯é€‰</p><p>æ¨èå†™æ³•ï¼š</p><pre><code>  Widget build(BuildContext context) {    return Row(      children: [        RaisedButton(          child: Text(&#39;Increment&#39;),        ),        Text(&#39;Click!&#39;),      ],    );  }</code></pre><p>ä¸æ¨èå¦‚ä¸‹å†™æ³•ï¼š</p><pre><code>  Widget build(BuildContext context) {    return new Row(      children: [        new RaisedButton(          child: new Text(&#39;Increment&#39;),        ),        new Text(&#39;Click!&#39;),      ],    );  }</code></pre><h3 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h3><h4 id="ä¼˜å…ˆä½¿ç”¨async-awaitä»£æ›¿åŸå§‹çš„futures"><a href="#ä¼˜å…ˆä½¿ç”¨async-awaitä»£æ›¿åŸå§‹çš„futures" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨async/awaitä»£æ›¿åŸå§‹çš„futures"></a>ä¼˜å…ˆä½¿ç”¨async/awaitä»£æ›¿åŸå§‹çš„futures</h4><p>async/awaitè¯­æ³•æé«˜äº†å¯è¯»æ€§ï¼Œå…è®¸ä½ åœ¨å¼‚æ­¥ä»£ç ä¸­ä½¿ç”¨æ‰€æœ‰Dartæ§åˆ¶æµç»“æ„ã€‚</p><pre><code>  Future&lt;int&gt; countActivePlayers(String teamName) async {    try {      var team = await downloadTeam(teamName);      if (team == null) return 0;      var players = await team.roster;      return players.where((player) =&gt; player.isActive).length;    } catch (e) {      log.error(e);      return 0;    }  }</code></pre><h4 id="å½“å¼‚æ­¥æ²¡æœ‰ä»»ä½•ç”¨å¤„æ—¶ï¼Œä¸è¦ä½¿ç”¨å®ƒ"><a href="#å½“å¼‚æ­¥æ²¡æœ‰ä»»ä½•ç”¨å¤„æ—¶ï¼Œä¸è¦ä½¿ç”¨å®ƒ" class="headerlink" title="å½“å¼‚æ­¥æ²¡æœ‰ä»»ä½•ç”¨å¤„æ—¶ï¼Œä¸è¦ä½¿ç”¨å®ƒ"></a>å½“å¼‚æ­¥æ²¡æœ‰ä»»ä½•ç”¨å¤„æ—¶ï¼Œä¸è¦ä½¿ç”¨å®ƒ</h4><p>å¦‚æœå¯ä»¥åœ¨ä¸æ”¹å˜å‡½æ•°è¡Œä¸ºçš„æƒ…å†µä¸‹çœç•¥å¼‚æ­¥ï¼Œé‚£ä¹ˆå°±è¿™æ ·åšã€‚ã€</p><pre><code>  Future afterTwoThings(Future first, Future second) {    return Future.wait([first, second]);  }</code></pre><p>ä¸æ¨èå†™æ³•ï¼š</p><pre><code>  Future afterTwoThings(Future first, Future second) async {    return Future.wait([first, second]);  }</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;åŸæ–‡åœ°å€ï¼š&lt;a href=&quot;https://github.com/alibaba/flutter-go/blob/develop/Flutter_Go%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91%E8%
      
    
    </summary>
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/categories/Flutter/"/>
    
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Android åŸç”Ÿé¡¹ç›®é›†æˆ Flutter æ··åˆå¼€å‘</title>
    <link href="https://yangxiaoge.github.io/2019/02/28/2019-02-28-Android%20%E5%8E%9F%E7%94%9F%E9%A1%B9%E7%9B%AE%E9%9B%86%E6%88%90%20Flutter%20%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91/"/>
    <id>https://yangxiaoge.github.io/2019/02/28/2019-02-28-Android åŸç”Ÿé¡¹ç›®é›†æˆ Flutter æ··åˆå¼€å‘/</id>
    <published>2019-02-28T09:09:06.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ¬æ¥æœ€è¿‘å¯¹ Flutter çš„çƒ­è¡·ç¨‹åº¦æ—¥ç›Šå¢é•¿ï¼Œä¹Ÿä½¿ç”¨ Flutter å¼€å‘äº†åº”ç”¨ <a href="https://github.com/yangxiaoge/wanandroid_flutter" target="_blank" rel="noopener">MuMuxi-Flutter</a> ç‰ˆæœ¬ï¼Œ<br>ä½†æ˜¯ç°åœ¨æƒ³è¦æŠŠ Flutter ä½¿ç”¨åœ¨ç°æœ‰çš„é¡¹ç›®ä¸­ï¼Œæ”¹å¦‚ä½•æ“ä½œå‘¢ï¼Ÿå“ˆå“ˆï¼ŒGoogle å®˜æ–¹å·²ç»è€ƒè™‘åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”ç»™å‡ºäº†é›†æˆæ–¹æ¡ˆ <a href="https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps" target="_blank" rel="noopener">Add-Flutter-to-existing-apps</a>ã€‚</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ol><li>æ–°å»ºä¸€ä¸ª <code>Flutter module</code>ï¼Œä½¿ç”¨å‘½ä»¤ï¼š<code>flutter create -t module {moduleName}</code>ï¼Œå…¶ä¸­ <code>moduleName</code> æˆ‘è¿™é‡Œå–å <code>xinhua_media_flutter_module</code></li><li>éšåå°† <code>Flutter module</code> æ¨é€è‡³<code>git</code> ä»“åº“ï¼Œgit æ¨é€æˆ‘å°±ä¸ç´¯èµ˜äº†ï¼Œæ‹¿åˆ°ä»“åº“åœ°å€ <a href="https://gitee.com/xxx/xinhua_media_flutter_module.git" target="_blank" rel="noopener">https://gitee.com/xxx/xinhua_media_flutter_module.git</a></li><li>åœ¨<code>åŸç”Ÿ</code> Android é¡¹ç›®æ›´ç›®å½•æ·»åŠ  <code>git submodule</code><pre><code>git submodule add {Flutter module ä»“åº“åœ°å€}, å³ä¸Šé¢æ‹¿åˆ°çš„ä»“åº“åœ°å€ https://gitee.com/xxx/xinhua_media_flutter_module.gitgit submodule update</code></pre>æ­¤æ—¶é¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾ï¼š<br><img src="https://github.com/yangxiaoge/PersonResources/blob/master/flutter/%E5%8E%9F%E7%94%9F%E9%9B%86%E6%88%90flutter%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png?raw=true" alt="åŸç”Ÿé›†æˆflutterå·¥ç¨‹ç›®å½•ç»“æ„.png"></li><li>åœ¨åŸç”Ÿé¡¹ç›®<code>æ ¹ç›®å½•</code> <code>settings.gradle</code> ä¸­ <code>include &#39;:app&#39;</code> ä¸‹é¢æ·»åŠ å¦‚ä¸‹é…ç½®<pre><code>setBinding(new Binding([gradle: this]))evaluate(new File(     &#39;xinhua_media_flutter_module/.android/include_flutter.groovy&#39;))</code></pre></li><li>åŸç”Ÿé¡¹ç›® <code>app</code> ç›®å½•ä¸‹çš„ <code>build.gradle</code> æ–‡ä»¶ä¸­æ·»åŠ  <code>xinhua_media_flutter_module</code> åº“çš„ä¾èµ–<pre><code>// MyApp/app/build.gradleimplementation project(&#39;:flutter&#39;)</code></pre></li><li>åœ¨åŸç”Ÿé¡¹ç›®ä¸­æ–°å»ºä¸€ä¸ª <code>FlutterActivity</code> ç”¨æ¥åŠ è½½ Flutter mudule é¡µé¢å…¥å£<pre><code>@Overrideprotected void onCreate(@Nullable Bundle savedInstanceState) { super.onCreate(savedInstanceState); // &quot;flutter_page&quot; æ˜¯è·¯ç”±åç§°ï¼Œåœ¨ Flutter `main.dart` é¡µé¢ä¸­éœ€è¦ç”¨åˆ° FlutterView seuicSettingPage = Flutter.createView(this, getLifecycle(), &quot;flutter_page&quot;); FrameLayout.LayoutParams layoutParams = new FrameLayout.LayoutParams(FrameLayout.LayoutParams.MATCH_PARENT, FrameLayout.LayoutParams.MATCH_PARENT); // åŠ  flutterview æ·»åŠ åˆ°å¸ƒå±€ä¸­ addContentView(seuicSettingPage, layoutParams);}</code></pre></li><li>åœ¨ <code>xinhua_media_flutter_module</code> lib ä¸‹çš„ <code>main.dart</code> æ–‡ä»¶ä¸­æ·»åŠ é€»è¾‘<br><code>`</code><br>// xinhua_media_flutter_module/lib/main.dart<br>// ä»¥ä¸‹ â€œflutter_pageâ€ åˆ¤æ–­è·¯ç”±åç§°ï¼ŒMyApp æ˜¯è‡ªå®šä¹‰çš„ç»„ä»¶ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å‘è‡ªå·±çš„åŠŸèƒ½é€»è¾‘ã€‚<br>// å¦‚æœå‘ç° AS ä¸è¯†åˆ« Dart è¯­è¨€ï¼Œè®¾ç½®ä¸­å‹¾é€‰ <code>Enable Dart support</code><br>import â€˜dart:uiâ€™;<br>import â€˜package:flutter/material.dartâ€™;</li></ol><p>void main() =&gt; runApp(_widgetForRoute(window.defaultRouteName));</p><p>Widget _widgetForRoute(String route) {<br>  switch (route) {<br>    case â€˜flutter_pageâ€™:<br>      return MyApp();<br>    default:<br>      return Center(<br>        child: Text(â€˜Unknown route: $routeâ€™, textDirection: TextDirection.ltr),<br>      );<br>  }<br>}<br><code>`</code></p><ol start="8"><li>ç„¶å<code>è¿è¡Œ</code> Android åŸç”Ÿé¡¹ç›®ï¼Œ</li></ol><p>å¦‚æœæ··åˆé¡¹ç›®æƒ³è¦ä½¿ç”¨ flutter <code>hot start/reload</code>ï¼Œéœ€è¦ cd è¿›å…¥ <code>xinhua_media_flutter_module</code> ç›®å½•ï¼Œç„¶åæ‰§è¡Œ <code>flutter attach</code>ï¼Œ<br>ç„¶åæ‰“å¼€ flutter çš„é¡µé¢å°±èƒ½æ­£å¸¸ä½¿ç”¨ Hot restart/reload å•¦ï¼Œå¥½äº† Android é›†æˆ flutter åˆ°æ­¤ç»“æŸï¼ŒiOS é›†æˆå¯ä»¥çœ‹ Google å®˜æ–¹æ•™ç¨‹ã€‚</p><ol start="9"><li>emmmmmï¼ŒFlutter çœŸé¦™ğŸ˜€ğŸ˜†ğŸ˜‰ğŸ˜ğŸ˜˜ğŸ¤© </li></ol><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p><code>Flutter</code> ä½œä¸º Google çš„äº²å„¿å­ï¼Œå®ƒè¿˜æ˜¯ã€ŒGoogle ä¸‹ä¸€ä»£æ“ä½œç³»ç»Ÿã€<code>Fuchsia OS</code> çš„å†…ç½® UI SDK ï¼2019 å¹´å°†æ˜¯ Flutter çš„çˆ†å‘æœŸï¼Œ<a href="https://github.com/search?q=flutter" target="_blank" rel="noopener">Github</a> ä¸Šå·²ç»æœ‰å¾ˆå¤š<br>å›½äººå¼€å‘çš„ç›¸å…³æ’ä»¶ä»¥åŠé¡¹ç›®äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä¹Ÿä¼šå†™ä¸€äº›è·Ÿè‡ªå·± Flutter é¡¹ç›®ç›¸å…³çš„æŠ€æœ¯æ–‡ç« ï¼åŠ æ²¹ï¼ğŸ“š</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;æœ¬æ¥æœ€è¿‘å¯¹ Flutter çš„çƒ­è¡·ç¨‹åº¦æ—¥ç›Šå¢é•¿ï¼Œä¹Ÿä½¿ç”¨ Flutter å¼€å‘äº†åº”ç”¨ &lt;a href=&quot;https://github.com/
      
    
    </summary>
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/categories/Flutter/"/>
    
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter | çŠ¶æ€ç®¡ç†æ‹“å±•ç¯‡â€”â€”RxDart</title>
    <link href="https://yangxiaoge.github.io/2019/02/19/2019-02-19-Flutter%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%8B%93%E5%B1%95%E7%AF%87-RxDart/"/>
    <id>https://yangxiaoge.github.io/2019/02/19/2019-02-19-FlutterçŠ¶æ€ç®¡ç†æ‹“å±•ç¯‡-RxDart/</id>
    <published>2019-02-19T11:22:01.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å…ƒå®µä½³èŠ‚é½æ¬¢ä¹ï¼Œæœˆåœ†æ—¶åˆ†å¤§å›¢åœ†ã€‚å¼€å¼€å¿ƒå¿ƒä¸€å¹´å¤´ï¼Œå¥å¥åº·åº·ä¸€å¹´å°¾ï¼Œç¥èº«ä½“å¥åº·ï¼Œä¸‡äº‹å¦‚æ„ï¼</strong></p><blockquote><ul><li>åŸæ–‡åœ°å€ï¼š<a href="https://juejin.im/post/5bcea438e51d4536c65d2232" target="_blank" rel="noopener">https://juejin.im/post/5bcea438e51d4536c65d2232</a></li><li>åŸæ–‡ä½œè€…ï¼š<a href="https://juejin.im/user/5b5d45f4e51d453526175c06/posts" target="_blank" rel="noopener">Vadaski</a></li></ul></blockquote><h2 id="RxDart"><a href="#RxDart" class="headerlink" title="RxDart"></a>RxDart</h2><h3 id="ReactiveX-æ˜¯ä»€ä¹ˆ"><a href="#ReactiveX-æ˜¯ä»€ä¹ˆ" class="headerlink" title="ReactiveX æ˜¯ä»€ä¹ˆ"></a>ReactiveX æ˜¯ä»€ä¹ˆ</h3><p>ReactiveX æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åº“ï¼Œç”¨äºé€šè¿‡ä½¿ç”¨<strong>å¯è§‚å¯Ÿåºåˆ—</strong>æ¥ç¼–å†™<strong>å¼‚æ­¥</strong>å’Œ<strong>åŸºäºäº‹ä»¶</strong>çš„ç¨‹åºã€‚å®ƒçªç ´äº†<strong>è¯­è¨€</strong>å’Œ<strong>å¹³å°</strong>çš„é™åˆ¶ï¼Œè®©æˆ‘ä»¬ç¼–å†™å¼‚æ­¥ç¨‹åºå°±åƒåœ¨è‡ªå®¶èŠ±å›­æ•£æ­¥é‚£æ · easyã€‚æˆ‘ç›¸ä¿¡ä½ ä¸€å®šä¼šçˆ±ä¸Šå®ƒï¼</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/24/166a563fd4eb5800?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt></p><p><img src="https://user-gold-cdn.xitu.io/2018/10/10/1665e4f1257f4e00?imageslim" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;å…ƒå®µä½³èŠ‚é½æ¬¢ä¹ï¼Œæœˆåœ†æ—¶åˆ†å¤§å›¢åœ†ã€‚å¼€å¼€å¿ƒå¿ƒä¸€å¹´å¤´ï¼Œå¥å¥åº·åº·ä¸€å¹´å°¾ï¼Œç¥èº«ä½“å¥åº·ï¼Œä¸‡äº‹å¦‚æ„ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;åŸæ–‡åœ°å€ï¼š&lt;a href=&quot;https://juejin.im/post/5bcea438e51d4
      
    
    </summary>
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/categories/Flutter/"/>
    
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Androidæ•°æ®åº“é«˜æ‰‹ç§˜ç±ï¼ˆLitePalï¼‰</title>
    <link href="https://yangxiaoge.github.io/2018/08/23/2018-8-23-Android%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E6%89%8B%E7%A7%98%E7%B1%8D%EF%BC%88LitePal%EF%BC%89/"/>
    <id>https://yangxiaoge.github.io/2018/08/23/2018-8-23-Androidæ•°æ®åº“é«˜æ‰‹ç§˜ç±ï¼ˆLitePalï¼‰/</id>
    <published>2018-08-23T15:28:49.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ‘˜è‡ª <a href="https://blog.csdn.net/column/details/android-database-pro.html" target="_blank" rel="noopener">éƒ­éœ– CSDN</a></p><p>Android æ•°æ®åº“é«˜æ‰‹ç§˜ç±ï¼š <a href="https://blog.csdn.net/column/details/android-database-pro.html" target="_blank" rel="noopener">https://blog.csdn.net/column/details/android-database-pro.html</a></p><p>æœ¬ä¸“æ ä¸»è¦è®²è§£ Android æ•°æ®åº“ç›¸å…³çš„é«˜çº§æŠ€æœ¯ã€‚å…¶ä¸­åŒ…æ‹¬äº† SQLite ä¸­ä¸€äº›ä¸ä¸ºäººçŸ¥çš„ä½¿ç”¨æŠ€å·§ï¼Œä»¥åŠå…¨é¢å‰–æ LitePal è¿™æ¬¾ Android æ•°æ®åº“æ¡†æ¶çš„æ‰€æœ‰ç”¨æ³•ã€‚LitePal é¡¹ç›®åœ°å€æ˜¯: <a href="https://github.com/LitePalFramework/LitePal" target="_blank" rel="noopener">https://github.com/LitePalFramework/LitePal</a></p><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-é›¶-â€”â€”å‰è¨€"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-é›¶-â€”â€”å‰è¨€" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (é›¶)â€”â€”å‰è¨€"></a><a href="https://blog.csdn.net/guolin_blog/article/details/38083103" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (é›¶)â€”â€”å‰è¨€</a></h3><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-ä¸€-â€”â€”SQLite-å‘½ä»¤"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-ä¸€-â€”â€”SQLite-å‘½ä»¤" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (ä¸€)â€”â€”SQLite å‘½ä»¤"></a><a href="http://blog.csdn.net/guolin_blog/article/details/38461239" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (ä¸€)â€”â€”SQLite å‘½ä»¤</a></h3><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-äºŒ-â€”â€”åˆ›å»ºè¡¨å’Œ-LitePal-çš„åŸºæœ¬ç”¨æ³•"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-äºŒ-â€”â€”åˆ›å»ºè¡¨å’Œ-LitePal-çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (äºŒ)â€”â€”åˆ›å»ºè¡¨å’Œ LitePal çš„åŸºæœ¬ç”¨æ³•"></a><a href="http://blog.csdn.net/guolin_blog/article/details/38556989" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (äºŒ)â€”â€”åˆ›å»ºè¡¨å’Œ LitePal çš„åŸºæœ¬ç”¨æ³•</a></h3><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-ä¸‰-â€”â€”ä½¿ç”¨-LitePal-å‡çº§è¡¨"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-ä¸‰-â€”â€”ä½¿ç”¨-LitePal-å‡çº§è¡¨" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (ä¸‰)â€”â€”ä½¿ç”¨ LitePal å‡çº§è¡¨"></a><a href="http://blog.csdn.net/guolin_blog/article/details/39151617" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (ä¸‰)â€”â€”ä½¿ç”¨ LitePal å‡çº§è¡¨</a></h3><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-å››-â€”â€”ä½¿ç”¨-LitePal-å»ºç«‹è¡¨å…³è”"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-å››-â€”â€”ä½¿ç”¨-LitePal-å»ºç«‹è¡¨å…³è”" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (å››)â€”â€”ä½¿ç”¨ LitePal å»ºç«‹è¡¨å…³è”"></a><a href="http://blog.csdn.net/guolin_blog/article/details/39207945" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (å››)â€”â€”ä½¿ç”¨ LitePal å»ºç«‹è¡¨å…³è”</a></h3><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-äº”-â€”â€”LitePal-çš„å­˜å‚¨æ“ä½œ"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-äº”-â€”â€”LitePal-çš„å­˜å‚¨æ“ä½œ" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (äº”)â€”â€”LitePal çš„å­˜å‚¨æ“ä½œ"></a><a href="http://blog.csdn.net/guolin_blog/article/details/39345833" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (äº”)â€”â€”LitePal çš„å­˜å‚¨æ“ä½œ</a></h3><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-å…­-â€”â€”LitePal-çš„ä¿®æ”¹å’Œåˆ é™¤æ“ä½œ"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-å…­-â€”â€”LitePal-çš„ä¿®æ”¹å’Œåˆ é™¤æ“ä½œ" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (å…­)â€”â€”LitePal çš„ä¿®æ”¹å’Œåˆ é™¤æ“ä½œ"></a><a href="http://blog.csdn.net/guolin_blog/article/details/40083685" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (å…­)â€”â€”LitePal çš„ä¿®æ”¹å’Œåˆ é™¤æ“ä½œ</a></h3><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-ä¸ƒ-â€”â€”ä½“éªŒ-LitePal-çš„æŸ¥è¯¢è‰ºæœ¯"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-ä¸ƒ-â€”â€”ä½“éªŒ-LitePal-çš„æŸ¥è¯¢è‰ºæœ¯" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (ä¸ƒ)â€”â€”ä½“éªŒ LitePal çš„æŸ¥è¯¢è‰ºæœ¯"></a><a href="http://blog.csdn.net/guolin_blog/article/details/40153833" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (ä¸ƒ)â€”â€”ä½“éªŒ LitePal çš„æŸ¥è¯¢è‰ºæœ¯</a></h3><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-å…«-â€”â€”ä½¿ç”¨-LitePal-çš„èšåˆå‡½æ•°"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-å…«-â€”â€”ä½¿ç”¨-LitePal-çš„èšåˆå‡½æ•°" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (å…«)â€”â€”ä½¿ç”¨ LitePal çš„èšåˆå‡½æ•°"></a><a href="http://blog.csdn.net/guolin_blog/article/details/40614197" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (å…«)â€”â€”ä½¿ç”¨ LitePal çš„èšåˆå‡½æ•°</a></h3><h3 id="Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-ä¹-â€”â€”èµ¶å¿«ä½¿ç”¨-LitePal-2-0-ç‰ˆæœ¬å§"><a href="#Android-æ•°æ®åº“é«˜æ‰‹ç§˜ç±-ä¹-â€”â€”èµ¶å¿«ä½¿ç”¨-LitePal-2-0-ç‰ˆæœ¬å§" class="headerlink" title="Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (ä¹)â€”â€”èµ¶å¿«ä½¿ç”¨ LitePal 2.0 ç‰ˆæœ¬å§"></a><a href="http://blog.csdn.net/guolin_blog/article/details/80586028" target="_blank" rel="noopener">Android æ•°æ®åº“é«˜æ‰‹ç§˜ç± (ä¹)â€”â€”èµ¶å¿«ä½¿ç”¨ LitePal 2.0 ç‰ˆæœ¬å§</a></h3><h3 id="LitePal-å­¦ä¹ ç¬”è®°-å¿½ç•¥å­—æ®µï¼Œå¤šæ•°æ®åº“"><a href="#LitePal-å­¦ä¹ ç¬”è®°-å¿½ç•¥å­—æ®µï¼Œå¤šæ•°æ®åº“" class="headerlink" title="LitePal å­¦ä¹ ç¬”è®° - å¿½ç•¥å­—æ®µï¼Œå¤šæ•°æ®åº“"></a><a href="https://www.jianshu.com/p/bc68e763c7a2" target="_blank" rel="noopener">LitePal å­¦ä¹ ç¬”è®° - å¿½ç•¥å­—æ®µï¼Œå¤šæ•°æ®åº“</a></h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡æ‘˜è‡ª &lt;a href=&quot;https://blog.csdn.net/column/details/android-database-pro.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;éƒ­éœ– CSDN&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Android æ•°
      
    
    </summary>
    
      <category term="æ•°æ®åº“" scheme="https://yangxiaoge.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>Android å¸¸ç”¨è®¾è®¡æ¨¡å¼</title>
    <link href="https://yangxiaoge.github.io/2018/08/22/2018-8-22-Android%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>https://yangxiaoge.github.io/2018/08/22/2018-8-22-Androidå¸¸ç”¨è®¾è®¡æ¨¡å¼/</id>
    <published>2018-08-22T15:37:34.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p>è®¾è®¡æ¨¡å¼ä¸“æ ï¼š <a href="https://blog.csdn.net/lovelixue/article/category/7959476" target="_blank" rel="noopener">https://blog.csdn.net/lovelixue/article/category/7959476</a></p><p>ä»£ç  Github ï¼š<a href="https://github.com/sdgSnow/DesignPattern" target="_blank" rel="noopener">https://github.com/sdgSnow/DesignPattern</a></p><h3 id="Android-å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼ˆä¸€ã€å•ä¾‹æ¨¡å¼ï¼‰ï¼š"><a href="#Android-å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼ˆä¸€ã€å•ä¾‹æ¨¡å¼ï¼‰ï¼š" class="headerlink" title="Android å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼ˆä¸€ã€å•ä¾‹æ¨¡å¼ï¼‰ï¼š"></a><a href="https://blog.csdn.net/lovelixue/article/details/81940996" target="_blank" rel="noopener">Android å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼ˆä¸€ã€å•ä¾‹æ¨¡å¼ï¼‰</a>ï¼š</h3><ol><li>é¥¿æ±‰å¼</li><li>æ‡’æ±‰å¼</li><li>åŒé‡é”æ¨¡å¼</li></ol><h3 id="Android-å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼ˆäºŒã€å»ºé€ è€…æ¨¡å¼ï¼‰"><a href="#Android-å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼ˆäºŒã€å»ºé€ è€…æ¨¡å¼ï¼‰" class="headerlink" title="Android å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼ˆäºŒã€å»ºé€ è€…æ¨¡å¼ï¼‰:"></a><a href="https://blog.csdn.net/lovelixue/article/details/81944629" target="_blank" rel="noopener">Android å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼ˆäºŒã€å»ºé€ è€…æ¨¡å¼ï¼‰</a>:</h3><pre><code>//é€šè¿‡builderåˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡Person person = new Person.PersonBuilder(&quot;å°ç¾Šç¾Š&quot;)        .setAge(18)        .setSex(&quot;ç”·&quot;)        .setIdentity(&quot;ç å†œ&quot;)        .build();</code></pre><p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è®¾è®¡æ¨¡å¼ä¸“æ ï¼š &lt;a href=&quot;https://blog.csdn.net/lovelixue/article/category/7959476&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://blog.csdn.net/lovelixue
      
    
    </summary>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://yangxiaoge.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>java å­—èŠ‚æ•°ç»„ åºåˆ—åŒ– ä¸ C# å­—èŠ‚æ•°ç»„ åºåˆ—åŒ–å·®å¼‚æ€§</title>
    <link href="https://yangxiaoge.github.io/2018/08/16/2018-8-16-java%E5%AD%97%E8%8A%82%E6%95%B0%E7%BB%84%E4%B8%8EC%E4%BA%95%E5%AD%97%E8%8A%82%E6%95%B0%E7%BB%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%B7%AE%E5%BC%82%E6%80%A7/"/>
    <id>https://yangxiaoge.github.io/2018/08/16/2018-8-16-javaå­—èŠ‚æ•°ç»„ä¸Cäº•å­—èŠ‚æ•°ç»„åºåˆ—åŒ–å·®å¼‚æ€§/</id>
    <published>2018-08-16T19:40:05.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘é¡¹ç›®é‡åˆ°ä¸€ä¸ªå¤§å‘ï¼ˆæ¥å£æ–‡æ¡£ç«Ÿç„¶è¯´è¦ä¼  byte[]ï¼Œå…¶å®åº”è¯¥ä¼  stringï¼Œè¿˜å¥½æˆ‘è¦è¦äº†ä¸€ä¸ª C# ä»£ç ï¼Œå·®ç‚¹è¢«å‘ï¼ï¼ï¼ï¼‰ï¼Œéœ€è¦ä¸Šä¼ ä¸€ä¸ª byte[] æ•°ç»„ç»™åå°ã€‚ java byte[] åºåˆ—åŒ–ä¹‹åè¿˜æ˜¯ byte[], ç„¶è€Œ C# åˆ™å˜æˆäº† Base64ï¼ˆNO_WRAPï¼‰å­—ç¬¦ä¸²ï¼›</p><p>å› æ­¤ï¼š java è¿™è¾¹éœ€è¦æ‰‹åŠ¨å°† byte[] è½¬æˆ  Base64å­—ç¬¦ä¸²:<code>Base64.encodeToString(bytes, Base64.NO_WRAP);</code><br>java æˆ‘ç”¨çš„æ˜¯ <code>Gson</code> åºåˆ—åŒ–ï¼Œ å®¢æˆ·çš„ .NET ä»£ç ç”¨çš„æ˜¯ <code>JsonConvert.SerializeObject(obj)</code>ã€‚</p><p><img src="https://img-blog.csdn.net/20180816185942460?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25uOTkxOTI2/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdn.net/20180816190114298?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25uOTkxOTI2/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘é¡¹ç›®é‡åˆ°ä¸€ä¸ªå¤§å‘ï¼ˆæ¥å£æ–‡æ¡£ç«Ÿç„¶è¯´è¦ä¼  byte[]ï¼Œå…¶å®åº”è¯¥ä¼  stringï¼Œè¿˜å¥½æˆ‘è¦è¦äº†ä¸€ä¸ª C# ä»£ç ï¼Œå·®ç‚¹è¢«å‘ï¼ï¼ï¼ï¼‰ï¼Œéœ€è¦ä¸Šä¼ ä¸€ä¸ª byte[] æ•°ç»„ç»™åå°ã€‚ java byte[] åºåˆ—åŒ–ä¹‹åè¿˜æ˜¯ byte[], ç„¶è€Œ C# åˆ™å˜æˆäº† Base64ï¼ˆNO_WR
      
    
    </summary>
    
    
      <category term="byteï¼ŒC#" scheme="https://yangxiaoge.github.io/tags/byte%EF%BC%8CC/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“è·å– Android çŸ­ä¿¡</title>
    <link href="https://yangxiaoge.github.io/2018/08/14/2018-8-14-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8E%B7%E5%8F%96Android%E7%9F%AD%E4%BF%A1/"/>
    <id>https://yangxiaoge.github.io/2018/08/14/2018-8-14-æ•°æ®åº“è·å–AndroidçŸ­ä¿¡/</id>
    <published>2018-08-14T14:43:05.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è¯»å–çŸ­ä¿¡éœ€è¦çš„æƒé™"><a href="#è¯»å–çŸ­ä¿¡éœ€è¦çš„æƒé™" class="headerlink" title="è¯»å–çŸ­ä¿¡éœ€è¦çš„æƒé™"></a>è¯»å–çŸ­ä¿¡éœ€è¦çš„æƒé™</h3><pre><code>&lt;uses-permission android:name=&quot;android.permission.READ_SMS&quot;/&gt;</code></pre><h3 id="è¯»å–æ•°æ®åº“çŸ­ä¿¡æ–¹æ³•"><a href="#è¯»å–æ•°æ®åº“çŸ­ä¿¡æ–¹æ³•" class="headerlink" title="è¯»å–æ•°æ®åº“çŸ­ä¿¡æ–¹æ³•"></a>è¯»å–æ•°æ®åº“çŸ­ä¿¡æ–¹æ³•</h3><pre><code>   public static List&lt;Map&lt;String, String&gt;&gt; getSmsCode() {        String lastTime = &quot;1534228493681&quot;; // æ—¶é—´        Log.i(&quot;SMSUtil&quot;, &quot;å¼€å§‹è·å–çŸ­ä¿¡&quot;);        Cursor cursor = null;        // æ·»åŠ å¼‚å¸¸æ•æ‰        try {            //ç¬¬ä¸€ç§ï¼Œ æŸ¥è¯¢æ‰€æœ‰çŸ­ä¿¡            cursor = App.mContext.getContentResolver().query(                    Uri.parse(&quot;content://sms&quot;),                    new String[]{&quot;_id&quot;, &quot;address&quot;, &quot;body&quot;, &quot;date&quot;, &quot;person&quot;, &quot;type&quot;},                    null, null, &quot;date desc&quot;);            //ç¬¬äºŒç§ï¼Œ é€šè¿‡æŸ¥è¯¢æ¡ä»¶ï¼Œ ä¾‹å¦‚ï¼šdate &gt; lastTimeï¼Œ è¿‡æ»¤æ•°æ®            /*cursor = App.mContext.getContentResolver().query(                        Uri.parse(&quot;content://sms&quot;),                        new String[]{&quot;_id&quot;, &quot;address&quot;, &quot;body&quot;, &quot;date&quot;, &quot;person&quot;, &quot;type&quot;},                        &quot;date &gt; ?&quot;, new String[]{lastTime}, &quot;date desc&quot;);*/            if (cursor != null) {                List&lt;Map&lt;String, String&gt;&gt; smsList = new ArrayList&lt;&gt;();                while (cursor.moveToNext()) {                    String body = cursor.getString(cursor.getColumnIndex(&quot;body&quot;));// åœ¨è¿™é‡Œè·å–çŸ­ä¿¡ä¿¡æ¯                    String person = cursor.getString(cursor.getColumnIndex(&quot;person&quot;)); // é™Œç”Ÿäººä¸ºnull                    String address = cursor.getString(cursor.getColumnIndex(&quot;address&quot;));                    String _id = cursor.getString(cursor.getColumnIndex(&quot;_id&quot;));                    String date = cursor.getString(cursor.getColumnIndex(&quot;date&quot;));                    String type = cursor.getString(cursor.getColumnIndex(&quot;type&quot;));                    HashMap&lt;String, String&gt; smsMap = new HashMap&lt;&gt;();                    smsMap.put(&quot;body&quot;, body);                    smsMap.put(&quot;person&quot;, person);                    smsMap.put(&quot;address&quot;, address);                    smsMap.put(&quot;_id&quot;, _id);                    smsMap.put(&quot;date&quot;, date);                    smsList.add(smsMap);                    Log.i(&quot;test_sms&quot;, &quot;body = &quot; + body + &quot;  person = &quot; + person + &quot;  address = &quot; + address                            + &quot;  date = &quot; + date + &quot;  type = &quot; + type);                }                // è¿”å›æ‰€æœ‰çš„çŸ­ä¿¡                return smsList;            }        } catch (Exception e) {            e.printStackTrace();            Log.i(&quot;test_sms&quot;, &quot;e = &quot; + e.getMessage());        } finally {            if (cursor != null) {                cursor.close();            }        }        return null;    }</code></pre><h3 id="URI-ä¸»è¦æœ‰ï¼š"><a href="#URI-ä¸»è¦æœ‰ï¼š" class="headerlink" title="URI ä¸»è¦æœ‰ï¼š"></a>URI ä¸»è¦æœ‰ï¼š</h3><pre><code>content://sms/             æ‰€æœ‰çŸ­ä¿¡ (æœ¬ç¤ºä¾‹ç”¨çš„æ‰€æœ‰)content://sms/inbox        æ”¶ä»¶ç®±content://sms/sent         å·²å‘é€content://sms/draft        è‰ç¨¿content://sms/outbox       å‘ä»¶ç®±content://sms/failed       å‘é€å¤±è´¥content://sms/queued       å¾…å‘é€åˆ—è¡¨</code></pre><h3 id="SMS-ä¸»è¦ç»“æ„ï¼š"><a href="#SMS-ä¸»è¦ç»“æ„ï¼š" class="headerlink" title="SMS ä¸»è¦ç»“æ„ï¼š"></a>SMS ä¸»è¦ç»“æ„ï¼š</h3><pre><code>_id =&gt; çŸ­æ¶ˆæ¯åºå· å¦‚ 100  thread_id =&gt; å¯¹è¯çš„åºå· å¦‚ 100  address =&gt; å‘ä»¶äººåœ°å€ï¼Œæ‰‹æœºå·. å¦‚ + 8613811810000  person =&gt; å‘ä»¶äººï¼Œè¿”å›ä¸€ä¸ªæ•°å­—å°±æ˜¯è”ç³»äººåˆ—è¡¨é‡Œçš„åºå·ï¼Œé™Œç”Ÿäººä¸º null  date =&gt; æ—¥æœŸ  long å‹ã€‚å¦‚ 1256539465022  protocol =&gt; åè®® 0 SMS_RPOTO, 1 MMS_PROTO   read =&gt; æ˜¯å¦é˜…è¯» 0 æœªè¯»ï¼Œ 1 å·²è¯»   status =&gt; çŠ¶æ€ -1 æ¥æ”¶ï¼Œ0 complete, 64 pending, 128 failed   type =&gt; ç±»å‹ 1 æ˜¯æ¥æ”¶åˆ°çš„ï¼Œ2 æ˜¯å·²å‘å‡º          (ALL    = 0; æ‰€æœ‰    INBOX  = 1; æ”¶ä»¶ç®±    SENT   = 2; å·²å‘é€    DRAFT  = 3; è‰ç¨¿    OUTBOX = 4; å‘ä»¶ç®±    FAILED = 5; å¤±è´¥    QUEUED = 6;)å¾…å‘é€body =&gt; çŸ­æ¶ˆæ¯å†…å®¹   service_center =&gt; çŸ­ä¿¡æœåŠ¡ä¸­å¿ƒå·ç ç¼–å·ã€‚å¦‚ + 8613800755500  </code></pre><h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><p><a href="https://blog.csdn.net/ithomer/article/details/7328321" target="_blank" rel="noopener">https://blog.csdn.net/ithomer/article/details/7328321</a><br><a href="https://blog.csdn.net/laichao1112/article/details/6436511" target="_blank" rel="noopener">https://blog.csdn.net/laichao1112/article/details/6436511</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;è¯»å–çŸ­ä¿¡éœ€è¦çš„æƒé™&quot;&gt;&lt;a href=&quot;#è¯»å–çŸ­ä¿¡éœ€è¦çš„æƒé™&quot; class=&quot;headerlink&quot; title=&quot;è¯»å–çŸ­ä¿¡éœ€è¦çš„æƒé™&quot;&gt;&lt;/a&gt;è¯»å–çŸ­ä¿¡éœ€è¦çš„æƒé™&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;&amp;lt;uses-permission android:name=&amp;
      
    
    </summary>
    
    
      <category term="Androidï¼ŒSMS" scheme="https://yangxiaoge.github.io/tags/Android%EF%BC%8CSMS/"/>
    
  </entry>
  
  <entry>
    <title>ï¼ˆè¯‘ï¼‰ä¸ºä»€ä¹ˆæ¯ä¸ª Android å¼€å‘è€…éƒ½åº”è¯¥å°è¯• Flutter</title>
    <link href="https://yangxiaoge.github.io/2018/08/06/2018-8-6-why-every-android-developer-should-try-out-flutter/"/>
    <id>https://yangxiaoge.github.io/2018/08/06/2018-8-6-why-every-android-developer-should-try-out-flutter/</id>
    <published>2018-08-06T18:10:08.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<blockquote><ul><li>åŸæ–‡åœ°å€ï¼š<a href="https://proandroiddev.com/why-every-android-developer-should-try-out-flutter-319ae710e97f" target="_blank" rel="noopener">Why every Android Developer should try out Flutter</a></li><li>åŸæ–‡ä½œè€…ï¼š<a href="https://proandroiddev.com/@aaronoe?source=post_header_lockup" target="_blank" rel="noopener">Aaron Oertel</a></li><li>è¯‘æ–‡å‡ºè‡ªï¼š<a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a></li><li>æ˜é‡‘é“¾æ¥ï¼š<a href="https://juejin.im/post/5b5e70ffe51d4518e311b63d" target="_blank" rel="noopener">https://juejin.im/post/5b5e70ffe51d4518e311b63d</a></li><li>æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š<a href="https://github.com/xitu/gold-miner/blob/master/TODO1/why-every-android-developer-should-try-out-flutter.md" target="_blank" rel="noopener">https://github.com/xitu/gold-miner/blob/master/TODO1/why-every-android-developer-should-try-out-flutter.md</a></li><li>è¯‘è€…ï¼š<a href="https://github.com/ALVINYEH" target="_blank" rel="noopener">ALVINYEH</a></li><li>æ ¡å¯¹è€…ï¼š<a href="https://github.com/DateBro" target="_blank" rel="noopener">DateBro</a></li></ul></blockquote><h1 id="ä¸ºä»€ä¹ˆæ¯ä¸ª-Android-å¼€å‘è€…éƒ½åº”è¯¥å°è¯•-Flutter"><a href="#ä¸ºä»€ä¹ˆæ¯ä¸ª-Android-å¼€å‘è€…éƒ½åº”è¯¥å°è¯•-Flutter" class="headerlink" title="ä¸ºä»€ä¹ˆæ¯ä¸ª Android å¼€å‘è€…éƒ½åº”è¯¥å°è¯• Flutter"></a>ä¸ºä»€ä¹ˆæ¯ä¸ª Android å¼€å‘è€…éƒ½åº”è¯¥å°è¯• Flutter</h1><p>å‡ ä¸ªæœˆå‰ï¼Œæˆ‘å†™è¿‡ä¸€ç¯‡é¢˜ä¸ºâ€œ<a href="https://juejin.im/post/5add65c46fb9a07aa541e97e" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆ Flutter èƒ½æœ€å¥½åœ°æ”¹å˜ç§»åŠ¨å¼€å‘</a>â€çš„æ–‡ç« ã€‚è™½ç„¶å·²ç»è¿‡å»äº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯æˆ‘å¯¹ Flutter çš„çƒ­çˆ±ä¾ç„¶éå¸¸å¼ºçƒˆï¼›äº‹å®ä¸Šï¼Œå½“æˆ‘ç»§ç»­ä½¿ç”¨å®ƒæ—¶ï¼Œæˆ‘æ„è¯†åˆ°äº†æˆ‘ä¹‹å‰å¿½ç•¥äº† Flutter ç‹¬ç‰¹æ–¹é¢çš„é‡è¦æ€§ã€‚ä¸è¦è¯¯ä¼šæˆ‘çš„æ„æ€ â€”â€” æˆ‘ä»ç„¶è®¤ä¸º Flutter æœ€å¼ºå¤§çš„ä¸€ç‚¹å°±æ˜¯å¦‚ä½•è§£å†³è·¨å¹³å°å¼€å‘çš„è®¸å¤šé—®é¢˜ã€‚ä½†æœ€è¿‘æˆ‘å¼€å§‹å…³æ³¨ç§»åŠ¨å¼€å‘å‘å±•çš„æ›´å¤šé¢†åŸŸï¼Œç‰¹åˆ«æ˜¯å£°æ˜æ€§ç”¨æˆ·ç•Œé¢çš„æ¦‚å¿µã€‚</p><p><img src="https://cdn-images-1.medium.com/max/800/0*pV87QzKfowqgkEkd" alt></p><p>æ‘„å½±è€…ï¼šæ¥è‡ª <a href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" target="_blank" rel="noopener">Unsplash</a> çš„ <a href="https://unsplash.com/@licole?utm_source=medium&amp;utm_medium=referral" target="_blank" rel="noopener">Chris Charles</a>ã€‚</p><p>æˆ‘ç›¸ä¿¡ä½ å·²ç»å¬è¿‡ä¸€ç³»åˆ—å…³äºä¸ºä»€ä¹ˆ Android å¼€å‘è€…åº”è¯¥å…³æ³¨ Flutter çš„è‹¥å¹²è®ºæ®ï¼ˆå¦‚æœä½ è¿˜æ²¡æœ‰çœ‹è¿‡ï¼Œè¯·è®©æˆ‘è°¦é€Šåœ°å»ºè®®ä½ ç§ç§<a href="https://proandroiddev.com/why-flutter-will-change-mobile-development-for-the-best-c249f71fa63c" target="_blank" rel="noopener">è¿™ä¸ª</a>ï¼‰ï¼Œä½†æ˜¯æˆ‘æƒ³æŒ‡å‡ºä¸€ä¸ªæˆ‘è¿˜æ²¡æœ‰çœŸæ­£è§£å†³çš„å¤§é—®é¢˜ï¼Œé‚£å°±æ˜¯ Flutter å¯ä»¥è®©ä½ å¯¹ App å¼€å‘æœ‰å®Œå…¨ä¸åŒçš„çœ‹æ³•ã€‚é¦–å…ˆï¼Œä½ çš„åº”ç”¨æœ¬èº«å°†é‡‡ç”¨ä¸åŒçš„æ–¹å¼æ„å»º â€”â€” ä½†æ›´é‡è¦çš„æ˜¯ï¼Œå®é™…çš„ UI å¼€å‘é€šè¿‡å°†å…¶åˆå¹¶åˆ°ä½ çš„ Dart ä»£ç ï¼ˆè€Œä¸æ˜¯ XMLï¼‰ä¸­è€Œè¢«æ¨åˆ°å‰å°ï¼Œå› æ­¤ä½¿å®ƒæˆä¸ºäº†â€œä¸€ç­‰å…¬æ°‘â€ã€‚ä¸€æ—¦ä½ çš„ UI ä»£ç çªç„¶å‡ºç°åœ¨ä¸€ç§éæ ‡è®°è¯­è¨€ä¸­ï¼Œä½ å°±ä¼šæ„è¯†åˆ°ä½ çªç„¶æœ‰äº†æ„å»ºåº”ç”¨çš„å¯èƒ½æ€§ã€‚è¯´å®è¯ï¼Œåœ¨ä½¿ç”¨ Flutter ä¹‹åï¼Œæˆ‘å¼€å§‹è®¨åŒåœ¨ Android ä¸Šç¼–å†™ UI ä»£ç ï¼›å› ä¸ºåœ¨ Android ä¸­æ­¥éª¤æ›´åŠ ç¹çï¼Œè™½ç„¶ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨æ•°æ®ç»‘å®šç­‰å·¥å…·æ„å»ºå“åº”å¼åº”ç”¨ï¼Œä½†å®ƒå®é™…ä¸Šæ¯” Flutter ä¸­è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚</p><p>å½“ä½ è€ƒè™‘åœ¨ Android ä¸­æ•´åˆåŠ¨ç”»å’Œå…¶ä»–åŠ¨æ€æ•°æ®æ—¶ï¼Œä½¿ç”¨ Flutter çš„è®ºç‚¹å˜å¾—æ›´åŠ æœ‰åŠ›ã€‚æ•´åˆåŠ¨ç”»å¯èƒ½ä¼šä¸å¤ªæ–¹ä¾¿ï¼Œæœ‰æ—¶ä½ å¯èƒ½ä¸å¾—ä¸æ‹’ç»è®¾è®¡å¸ˆçš„è¦æ±‚ï¼Œå› ä¸ºè¦å®ç°ä»–ä»¬çš„éœ€æ±‚å¤ªéš¾äº†ã€‚è°¢å¤©è°¢åœ°ï¼ŒFlutter æ”¹å˜äº†è¿™ä¸€åˆ‡ã€‚å¦‚æœä½ ä¸€ç›´åœ¨å…³æ³¨ Flutterï¼Œä½ å¯èƒ½å·²ç»ä» <a href="https://medium.com/fluttery" target="_blank" rel="noopener">Fluttery</a> å¬è¯´è¿‡ <strong>Flutter æŒ‘æˆ˜</strong>ã€‚è¿™äº›æŒ‘æˆ˜å±•ç¤ºäº†æ„å»ºå…·æœ‰å¤§é‡è‡ªå®šä¹‰ç»„ä»¶å’Œç²¾ç¾è®¾è®¡ï¼ˆåŒ…æ‹¬åŠ¨ç”»ï¼‰çš„å¤æ‚ UI çš„å¿«é€Ÿå’Œç›´è§‚æ€§ã€‚åœ¨ Android ä¸Šå®ç°è¿™æ ·çš„ä¸œè¥¿ä¼šå˜å¾—éå¸¸å›°éš¾ â€”â€” ç‰¹åˆ«æ˜¯å› ä¸ºä¸ Flutter ä¸åŒï¼ŒAndroid çš„è§†å›¾åŸºäºç»§æ‰¿è€Œéç»„åˆï¼Œè¿™ä½¿å¾—æ„å»ºè§†å›¾å˜å¾—æ›´åŠ å¤æ‚ã€‚</p><p>ä¸‹é¢ï¼Œè®©æˆ‘ä»¬åˆ‡å…¥æ­£é¢˜ï¼šä½¿ç”¨ Flutter <strong>æ„å»ºå£°æ˜æ€§ UI</strong>ï¼Œè¿™æ”¹å˜äº† UI å¼€å‘çš„ä¸€åˆ‡ã€‚ç°åœ¨ä¹Ÿè®¸ä½ åœ¨æƒ³ï¼Œ<strong>Android å¸ƒå±€ä¸ä¹Ÿæ˜¯ä»¥å£°æ˜æ–¹å¼æ„å»ºçš„å—ï¼Ÿ</strong>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä½†äº‹å®ä¸æ˜¯ã€‚ä½¿ç”¨ XML æ¥å®šä¹‰å¸ƒå±€è®©æˆ‘ä»¬æœ‰äº†ä»¥å£°æ˜æ–¹å¼å®šä¹‰å¸ƒå±€çš„æ„Ÿè§‰ï¼Œä½†å¦‚æœä½ çš„è§†å›¾æ˜¯å®Œå…¨é™æ€çš„ï¼Œå¹¶ä¸”æ‰€æœ‰æ•°æ®éƒ½æ˜¯ä»¥ XML æ ¼å¼è®¾ç½®çš„ï¼Œé‚£ä¹ˆè¿™ç§æ„Ÿè§‰æ‰çœŸæ­£æˆç«‹ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§æƒ…å†µå‡ ä¹ä»æœªå‘ç”Ÿè¿‡ï¼›ä¸€æ—¦æ·»åŠ åŠ¨æ€æ•°æ®å’Œç±»ä¼¼åˆ—è¡¨ä¹‹ç±»çš„ä¸œè¥¿ï¼Œä½ è‡ªç„¶å¿…é¡»ä½¿ç”¨ä¸€äº› Java / Kotlin ä»£ç å°†æ•°æ®ç»‘å®šåˆ°è§†å›¾ã€‚ç„¶åæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°æŸç§ ViewModelï¼Œå®ƒå°†æ•°æ®è®¾ç½®ä¸ºè§†å›¾ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œè¿™å°±åƒåœ¨ Android ä¸Šè°ƒç”¨ <code>textView.text =â€œHello Mediumï¼â€</code> ä¸€æ ·ã€‚åœ¨ Flutter ä¸Šï¼Œè¿™æ˜¯å®Œå…¨ä¸åŒçš„ï¼šä½ åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«æŸä¸ªçŠ¶æ€çš„çª—å£ç»„ä»¶ç±»ï¼Œç„¶åæ ¹æ®è¯¥çŠ¶æ€ä»¥å£°æ˜æ–¹å¼å®šä¹‰ä½ çš„å¸ƒå±€ã€‚æ¯å½“çŠ¶æ€æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>setStateï¼ˆï¼‰</code> æ¥é‡æ–°æ¸²æŸ“æˆ‘ä»¬æ”¹å˜çš„ç»„ä»¶æ ‘çš„éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ Flutter ä¸­ä½¿ç”¨ APIï¼Œå¹¶ä½¿ç”¨ç»“æœæ¸²æŸ“ä¸€ä¸ª Listï¼š</p><pre><code>@overrideWidget build(BuildContext context) {  return new FutureBuilder&lt;Repositories&gt;(    future: apiClient.getUserRepositoriesFuture(username),    builder: (BuildContext context,         AsyncSnapshot&lt;Repositories&gt; snapshot) {      if (snapshot.hasError)        return new Center(child: new Text(&quot;Network error&quot;));      if (!snapshot.hasData)        return new Center(          child: new CircularProgressIndicator(),        );      return new ListView.builder(        itemCount: snapshot.data.nodes.length,        itemBuilder: (BuildContext context, int index) =&gt;            new RepoPreviewTile(              repository: snapshot.data.nodes[index],            ),      );    },  );}</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>FutureBuilder</code> æ¥ç­‰å¾…ç½‘ç»œè°ƒç”¨ï¼ˆFutureï¼‰çš„å®Œæˆã€‚ä¸€æ—¦ç½‘ç»œè°ƒç”¨å®Œæˆï¼Œå‡ºç°ç»“æœæˆ–é”™è¯¯ï¼Œ<code>FutureBuilder</code> ç»„ä»¶ä¼šåœ¨å†…éƒ¨è°ƒç”¨ <code>setState</code> æ¥è°ƒç”¨æ‰€æä¾›çš„ <code>builder</code> æ–¹æ³•æ¥é‡æ–°æ¸²æŸ“ã€‚æ­£å¦‚ä½ åœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹åˆ°çš„ï¼Œä¸€åˆ‡éƒ½æ˜¯<strong>å£°æ˜å¼çš„</strong>ã€‚åœ¨ Android ä¸ŠåšåŒæ ·çš„äº‹æƒ…é€šå¸¸éœ€è¦ä¸€ä¸ªè¢«åŠ¨çš„ XML å¸ƒå±€ï¼Œç„¶åéœ€è¦ä¸€äº›å…¶ä»–ç±»æ¥æ‰‹åŠ¨è®¾ç½®çŠ¶æ€ï¼Œæ¯”å¦‚ Adapter å’Œè§†å›¾æ¨¡å‹ã€‚è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼ŒçŠ¶æ€å¯èƒ½ä¸å±å¹•ä¸Šæ¸²æŸ“çš„çŠ¶æ€ä¸åŒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¸Œæœ›æ‹¥æœ‰åƒ Flutter ä¸ºæˆ‘ä»¬æä¾›çš„é‚£æ ·çš„å£°æ˜æ€§å¸ƒå±€ã€‚æˆ‘ä»¬æœ€ç»ˆç¼–å†™çš„ä»£ç è¦å°‘å¾—å¤šï¼ŒåŒæ—¶å°†çŠ¶æ€ç»‘å®šåˆ°è¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ã€‚</p><p>æœ‰äº†è¿™äº›å£°æ˜æ€§å¸ƒå±€ï¼Œæˆ‘ä»¬ä¹Ÿå¼€å§‹å¯¹æ¶æ„è¿›è¡Œäº†ä¸åŒçš„æ€è€ƒã€‚çªç„¶é—´ï¼Œ<strong>reactive</strong> è¿™ä¸ªè¯å‡ºç°äº†ï¼Œæˆ‘ä»¬è°ˆè®ºäº†æ›´å¤šçš„æ˜¯å…³äºçŠ¶æ€ç®¡ç†çš„å†…å®¹ï¼Œè€Œä¸æ˜¯æ¶æ„ã€‚æœ‰äº† Flutterï¼Œåƒ MVP å’Œ MVVM è¿™æ ·çš„æ¶æ„å·²ç»æ²¡æœ‰å¤šå¤§æœ‰æ„ä¹‰äº†ï¼›æˆ‘ä»¬ä¸å†ä½¿ç”¨å®ƒä»¬äº†ï¼Œè€Œæ˜¯è€ƒè™‘çŠ¶æ€å¦‚ä½•æµç»æˆ‘ä»¬çš„åº”ç”¨ã€‚çŠ¶æ€çªç„¶æˆä¸ºè®¨è®ºçš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æŠ•å…¥è¶Šæ¥è¶Šå¤šç²¾åŠ›å»æ€è€ƒæ„å»ºåº”ç”¨çš„æ–°æ–¹æ³•ä¸Šã€‚è¿™å¯¹æˆ‘ä»¬æ‰€æœ‰äººæ¥è¯´éƒ½æ˜¯ä¸€æ¬¡æ–°çš„æ—…ç¨‹ï¼Œæœ‰è®¸å¤šäº‹æƒ…å¯ä»¥è§£å†³ï¼Œä½†æœ€é‡è¦çš„æ˜¯ï¼Œè¿™æ˜¯æˆ‘ä»¬å¼€é˜”è§†é‡çš„æœºä¼šã€‚</p><p>å¦ç™½åœ°è¯´ï¼ŒFlutter ä¹Ÿä¸åªæœ‰é˜³å…‰å’Œå½©è™¹ã€‚æˆ‘ç›®å‰æ­£åœ¨ä¸ Flutter åˆä½œå¼€å±•ä¸€ä¸ªæ›´å¤§çš„é¡¹ç›®æ¥äº†è§£å®ƒçš„å¼±ç‚¹ï¼Œè¿„ä»Šä¸ºæ­¢æˆ‘é‡åˆ°çš„æœ€å¤§ç¼ºé™·æ˜¯ç¼ºä¹åŸºç¡€è®¾æ–½ã€‚å½“æˆ‘å°è¯•ä½¿ç”¨ Graphql-API æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å°±éå¸¸æ˜æ˜¾ï¼›è™½ç„¶æœ‰åº“ç¡®å®ä¼šè¿™æ ·åšï¼Œä½†å®ƒä»¬å¹¶æ²¡æœ‰æ¥è¿‘ Android ä¸ Apollo çš„å…³ç³»ã€‚ä¸è¿‡ï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼ŒFlutter è¿å¤´èµ¶ä¸Šåªæ˜¯æ—¶é—´çš„é—®é¢˜ï¼Œåœ¨æ­¤æœŸé—´æ‰©å±•ç°æœ‰çš„åº“ï¼Œç”šè‡³å»ºç«‹è‡ªå·±çš„åº“å¹¶ä¸å›°éš¾ã€‚è¯·æ³¨æ„ï¼Œä½ å¯èƒ½éœ€è¦èŠ±ä¸€äº›æ—¶é—´æŠ•å…¥åœ¨åº”ç”¨ç¨‹åºçš„åŸºç¡€è®¾æ–½ä¸­ï¼Œè€Œå¯¹äº Android å’Œ iOS æ¥è¯´ï¼Œæƒ…å†µé€šå¸¸å¹¶éå¦‚æ­¤ â€”â€” æ¯•ç«Ÿï¼Œå¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ã€‚</p><p>æœ€åï¼Œæˆ‘æœ€è¿‘ä»ä½¿ç”¨ Flutter ä¸­å¾—åˆ°çš„æœ€å¤§å¯ç¤ºä¹‹ä¸€å°±æ˜¯ï¼Œä½“éªŒè¿™ç§æ„å»º UI çš„å£°æ˜æ–¹å¼ä»¥åŠå®ƒå¯¹çŠ¶æ€ç®¡ç†çš„å½±å“æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æˆ‘è§‰å¾— Flutter å¤ªæ£’äº†ï¼›ä¸è¿‡ï¼Œæˆ‘å‘Šè¯«ä½ ä¸è¦æŠŠå®ƒå½“ä½œè§£å†³ä½ æ‰€æœ‰é—®é¢˜çš„é“¶å¼¹ï¼Œè€Œåº”è¯¥æ˜¯ä½œä¸ºä¸€ç§åˆ›æ–°çš„å·¥å…·ï¼Œå®ƒå¯ä»¥æ¯”åœ¨ Android ä¸Šæ›´å¿«åœ°æ„å»ºæ¼‚äº®çš„è‡ªå®šä¹‰ UIã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå±•ç¤ºäº†å¼ºå¤§çš„å£°æ˜æ€§å¸ƒå±€åŠŸèƒ½ï¼Œå¹¶è®©ä½ å°†åº”ç”¨è§†ä¸ºæ¸²æŸ“çŠ¶æ€ï¼Œè€Œä¸æ˜¯éè¿è´¯æ€§ Activityï¼Œè§†å›¾å’Œè§†å›¾æ¨¡å‹ â€”â€” ä»…æ­¤è€Œè¨€ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ å°è¯•ä¸€ä¸‹ Flutterã€‚</p><blockquote><p>å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° <a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a> å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ <strong>æœ¬æ–‡æ°¸ä¹…é“¾æ¥</strong> å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚</p></blockquote><hr><blockquote><p><a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a> æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º <a href="https://juejin.im" target="_blank" rel="noopener">æ˜é‡‘</a> ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– <a href="https://github.com/xitu/gold-miner#android" target="_blank" rel="noopener">Android</a>ã€<a href="https://github.com/xitu/gold-miner#ios" target="_blank" rel="noopener">iOS</a>ã€<a href="https://github.com/xitu/gold-miner#å‰ç«¯" target="_blank" rel="noopener">å‰ç«¯</a>ã€<a href="https://github.com/xitu/gold-miner#åç«¯" target="_blank" rel="noopener">åç«¯</a>ã€<a href="https://github.com/xitu/gold-miner#åŒºå—é“¾" target="_blank" rel="noopener">åŒºå—é“¾</a>ã€<a href="https://github.com/xitu/gold-miner#äº§å“" target="_blank" rel="noopener">äº§å“</a>ã€<a href="https://github.com/xitu/gold-miner#è®¾è®¡" target="_blank" rel="noopener">è®¾è®¡</a>ã€<a href="https://github.com/xitu/gold-miner#äººå·¥æ™ºèƒ½" target="_blank" rel="noopener">äººå·¥æ™ºèƒ½</a>ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ <a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a>ã€<a href="http://weibo.com/juejinfanyi" target="_blank" rel="noopener">å®˜æ–¹å¾®åš</a>ã€<a href="https://zhuanlan.zhihu.com/juejinfanyi" target="_blank" rel="noopener">çŸ¥ä¹ä¸“æ </a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;åŸæ–‡åœ°å€ï¼š&lt;a href=&quot;https://proandroiddev.com/why-every-android-developer-should-try-out-flutter-319ae710e97f&quot; target=&quot;_blan
      
    
    </summary>
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/categories/Flutter/"/>
    
    
      <category term="Flutter" scheme="https://yangxiaoge.github.io/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Git clone æ…¢æ€ä¹ˆåŠ - é…ç½®ä»£ç†</title>
    <link href="https://yangxiaoge.github.io/2018/08/03/2018-8-3-git%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86/"/>
    <id>https://yangxiaoge.github.io/2018/08/03/2018-8-3-gité…ç½®ä»£ç†/</id>
    <published>2018-08-03T17:23:35.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬äººæ˜¯ macOS ç³»ç»Ÿï¼Œç”¨çš„ ShadowsocksX-NG ï¼Œå¼€äº†å…¨å±€ä»£ç†ä¹Ÿæ— äº‹äºè¡¥ï¼ŒæŠ˜è…¾äº†å¥½ä¸€ä¼šå„¿æ‰¾åˆ°äº†è§£å†³åŠæ³•ã€‚</p><p>é…ç½® Git ä»£ç†ã€‚</p><pre><code>// æŸ¥çœ‹å½“å‰ä»£ç†è®¾ç½®git config --global http.proxy// è®¾ç½®å½“å‰ä»£ç†ä¸º http://127.0.0.1:1080 æˆ– socket5://127.0.0.1:1080git config --global http.proxy &#39;http://127.0.0.1:1080&#39;git config --global http.proxy &#39;socks5://127.0.0.1:1080&#39;/// åˆ é™¤ä»£ç†git config --global --unset http.proxy// æ³¨æ„ `mac` å°é£æœºéœ€è¦å¼€å¯å…¨å±€ä»£ç†</code></pre><p>æ¥ä¸‹æ¥å°½æƒ…çš„ä½¿ç”¨ git å§ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬äººæ˜¯ macOS ç³»ç»Ÿï¼Œç”¨çš„ ShadowsocksX-NG ï¼Œå¼€äº†å…¨å±€ä»£ç†ä¹Ÿæ— äº‹äºè¡¥ï¼ŒæŠ˜è…¾äº†å¥½ä¸€ä¼šå„¿æ‰¾åˆ°äº†è§£å†³åŠæ³•ã€‚&lt;/p&gt;
&lt;p&gt;é…ç½® Git ä»£ç†ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// æŸ¥çœ‹å½“å‰ä»£ç†è®¾ç½®
git config --global http.proxy

      
    
    </summary>
    
    
      <category term="Git" scheme="https://yangxiaoge.github.io/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•æ¥å…¥ VirtualAPK æ’ä»¶æ¡†æ¶</title>
    <link href="https://yangxiaoge.github.io/2018/07/25/2018-07-25%20-%20%E5%A6%82%E4%BD%95%E6%8E%A5%E5%85%A5%20virtualapk%20%E6%8F%92%E4%BB%B6%E6%A1%86%E6%9E%B6/"/>
    <id>https://yangxiaoge.github.io/2018/07/25/2018-07-25 - å¦‚ä½•æ¥å…¥ virtualapk æ’ä»¶æ¡†æ¶/</id>
    <published>2018-07-25T17:05:06.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://github.com/didi/VirtualAPK/raw/master/imgs/va.png" alt></p><p>å°é¢å›¾ç‰‡æ¥æº: <a href="https://blog.csdn.net/byeweiyang/article/details/80127643" target="_blank" rel="noopener">https://blog.csdn.net/byeweiyang/article/details/80127643</a></p><p>è¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šæˆ‘çš„ Demo åœ°å€ï¼š<a href="https://github.com/yangxiaoge/VirtualAPKDemo" target="_blank" rel="noopener">https://github.com/yangxiaoge/VirtualAPKDemo</a></p><p>æœ¬æ–‡è½¬è½½ï¼šåŸæ–‡é“¾æ¥<a href="https://blog.csdn.net/lovelixue/article/details/81141213" target="_blank" rel="noopener">https://blog.csdn.net/lovelixue/article/details/81141213</a></p><p>æœ€è¿‘éƒ½åœ¨ææ’ä»¶æ¡†æ¶ï¼Œä¸ºé¡¹ç›®æ­å»ºç”¨ï¼Œä¹‹å‰é›†æˆäº†ä¸‹é˜¿é‡Œçš„ atlasï¼Œç°åœ¨é€ä¸Šä¸€ç¯‡æ»´æ»´çš„ virtualapkï¼Œå°±ä¸ªäººè€Œè¨€ï¼Œæ»´æ»´çš„é›†æˆè¿‡ç¨‹æ¯”é˜¿é‡Œç®€å•äº›ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹æˆ‘ atlas çš„ï¼š<a href="https://blog.csdn.net/lovelixue/article/details/81141213" target="_blank" rel="noopener">https://blog.csdn.net/lovelixue/article/details/81141213</a></p><p><em>åºŸè¯ä¸å¤šè¯´ï¼Œä¸Šè¿‡ç¨‹</em></p><h3 id="1-ç¯å¢ƒé…ç½®ï¼Œå¾ˆé‡è¦ï¼Œå®˜æ–¹æœ‰è§„å®š-gradle-ä½¿ç”¨å“ªä¸ªä¹‹ç±»çš„ï¼Œæˆ‘ç”¨çš„ä¸åŒï¼Œæˆ‘å°±åŸºäºæˆ‘çš„æ¥å†™"><a href="#1-ç¯å¢ƒé…ç½®ï¼Œå¾ˆé‡è¦ï¼Œå®˜æ–¹æœ‰è§„å®š-gradle-ä½¿ç”¨å“ªä¸ªä¹‹ç±»çš„ï¼Œæˆ‘ç”¨çš„ä¸åŒï¼Œæˆ‘å°±åŸºäºæˆ‘çš„æ¥å†™" class="headerlink" title="1. ç¯å¢ƒé…ç½®ï¼Œå¾ˆé‡è¦ï¼Œå®˜æ–¹æœ‰è§„å®š gradle ä½¿ç”¨å“ªä¸ªä¹‹ç±»çš„ï¼Œæˆ‘ç”¨çš„ä¸åŒï¼Œæˆ‘å°±åŸºäºæˆ‘çš„æ¥å†™"></a>1. ç¯å¢ƒé…ç½®ï¼Œå¾ˆé‡è¦ï¼Œå®˜æ–¹æœ‰è§„å®š gradle ä½¿ç”¨å“ªä¸ªä¹‹ç±»çš„ï¼Œæˆ‘ç”¨çš„ä¸åŒï¼Œæˆ‘å°±åŸºäºæˆ‘çš„æ¥å†™</h3><p>1.1 æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œæ ¹ç›®å½•çš„ build.gradle é‡Œé¢</p><p>classpath â€˜com.android.tools.build:gradle:3.0.0â€™</p><p>classpath â€˜com.didi.virtualapk:gradle:0.9.8.4â€™</p><p>æ ¹ç›®å½• å°±é…ç½®è¿™ä¸¤ä¸ª</p><p>1.2 åœ¨ appï¼ˆå®¿ä¸»ï¼‰ç›®å½•ä¸‹çš„ build.gradle æ–‡ä»¶ä¸‹æ·»åŠ </p><p>apply plugin: â€˜com.didi.virtualapk.hostâ€™<br>åœ¨ dependencies é‡Œé¢æ·»åŠ </p><p>implementation â€˜com.didi.virtualapk:core:0.9.6â€™<br>1.3 é‡ç‚¹æ¥äº†ï¼Œé€šè¿‡ fileï¼Œnew module çš„å½¢å¼æ–°å»ºä¸€ä¸ª moduleï¼Œç„¶åæˆ‘å‘½åä¸º plugindemoï¼Œç„¶ååœ¨ nodule.gradle é‡Œé¢æ·»åŠ </p><p>implementation â€˜com.didi.virtualapk:core:0.9.6â€™<br>æ¥ç€åœ¨æœ«ç«¯æ·»åŠ </p><p>apply plugin: â€˜com.didi.virtualapk.pluginâ€™<br>virtualApk {<br>    // æ’ä»¶èµ„æºè¡¨ä¸­çš„packageIdï¼Œéœ€è¦ç¡®ä¿ä¸åŒæ’ä»¶æœ‰ä¸åŒçš„packageId.<br>    packageId = 0x6f             // The package id of Resources.<br>    // å®¿ä¸»å·¥ç¨‹applicationæ¨¡å—çš„è·¯å¾„ï¼Œæ’ä»¶çš„æ„å»ºéœ€è¦ä¾èµ–è¿™ä¸ªè·¯å¾„<br>    targetHost=â€™../appâ€™ // The path of application module in host project.<br>    //é»˜è®¤ä¸ºtrueï¼Œå¦‚æœæ’ä»¶æœ‰å¼•ç”¨å®¿ä¸»çš„ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªé€‰é¡¹å¯ä»¥ä½¿å¾—æ’ä»¶å’Œå®¿ä¸»ä¿æŒæ··æ·†ä¸€è‡´<br>    applyHostMapping = true      // [Optional] Default value is true.<br>}<br>æˆªå›¾<br><img src="https://img-blog.csdn.net/20180725103642552?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xvdmVsaXh1ZQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p><p>åŸºæœ¬ ç¯å¢ƒå°±åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œæ¥ä¸‹æ¥ä»£ç éƒ¨åˆ†</p><h3 id="2-ä»£ç æ·»åŠ å¹¶éªŒè¯"><a href="#2-ä»£ç æ·»åŠ å¹¶éªŒè¯" class="headerlink" title="2. ä»£ç æ·»åŠ å¹¶éªŒè¯"></a>2. ä»£ç æ·»åŠ å¹¶éªŒè¯</h3><p>åœ¨ app çš„ mainactivity é‡Œé¢æ·»åŠ ä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªæ˜¯è·³è½¬åˆ° module å»çš„ï¼Œä¸€ä¸ªæ˜¯åŠ è½½æ’ä»¶çš„</p><p>public void loadPlugin() {<br>    PluginManager pluginManager = PluginManager.getInstance(this);<br>    //æ­¤å¤„æ˜¯å½“æŸ¥çœ‹æ’ä»¶apkæ˜¯å¦å­˜åœ¨,å¦‚æœå­˜åœ¨å°±å»åŠ è½½(æ¯”å¦‚ä¿®æ”¹çº¿ä¸Šçš„bug,æŠŠæ’ä»¶apkä¸‹è½½åˆ°sdcardçš„æ ¹ç›®å½•ä¸‹å–åä¸ºplugin-release.apk)<br>    File apk = new File(Environment.getExternalStorageDirectory(), â€œplugin-release.apkâ€);<br>    if (apk.exists()) {<br>        try {<br>            pluginManager.loadPlugin(apk);<br>            Toast.makeText(this, â€œæ’ä»¶åŠ è½½æˆåŠŸâ€, Toast.LENGTH_SHORT).show();<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>            Toast.makeText(this, â€œæ’ä»¶åŠ è½½å¼‚å¸¸ï¼â€, Toast.LENGTH_SHORT).show();<br>        }<br>    }<br>}<br>æˆªå›¾<br><img src="https://img-blog.csdn.net/20180725104101299?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xvdmVsaXh1ZQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p><p>è¿™ä¸ªæ—¶å€™è·³è½¬æ˜¯ä¸è¡Œçš„ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦åŠ è½½æ’ä»¶äº† ï¼Œé¦–å…ˆéœ€è¦ç”Ÿæˆæ’ä»¶ apk</p><p>å®˜æ–¹æ–‡æ¡£æ˜¯é€šè¿‡å‘½ä»¤</p><p>gradle clean assemblePluginæ¥æ„å»ºæ’ä»¶</p><p>å¦‚æœä¸æƒ³è¿™æ ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥ gradle çš„æ¥ï¼Œå…·ä½“å¦‚ä¸‹<br><img src="https://img-blog.csdn.net/20180725104350857?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xvdmVsaXh1ZQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p><p>è¿™æ · å°±ç”Ÿæˆæ’ä»¶ apk äº†ï¼ŒåŒæ—¶å®˜æ–¹æ–‡æ¡£ä»‹ç»äº†ä¸‹è¿™ä¸ªï¼Œå°±æ˜¯åªèƒ½ç”Ÿæˆ release ç‰ˆæœ¬çš„ï¼Œæ’ä»¶åŒ…ä½äº build ç›®å½•ä¸‹<br><img src="https://img-blog.csdn.net/20180725104530319?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xvdmVsaXh1ZQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p><p>åˆ°è¿™é‡Œ å°±å¯ä»¥ç»“æŸéªŒè¯äº†ï¼Œç‚¹å‡»åŠ è½½æ’ä»¶ï¼Œç„¶åå†ç‚¹å‡»è·³è½¬ï¼Œä½ ä¼šå‘ç°å¯ä»¥è·³è½¬äº†ï¼Œå¦‚æœå¦‚æœæœ‰å¸®åŠ©å¯ä»¥å¸®æˆ‘ç‚¹ä¸ªèµæˆ–è€… githup ä¸Šé¢ star ä¸€ä¸‹ï¼Œè°¢è°¢ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥ä¸‹é¢è¯„è®ºå›å¤ï¼Œä¸€èµ·å­¦ä¹ æ¢è®¨ã€‚ä¸‹é¢è´´ä¸Šæ³¨æ„ç‚¹</p><ol><li><p>é›†æˆç¯å¢ƒä¸€å®šè¦é…ç½®å¥½</p></li><li><p>ç”Ÿæˆçš„æ’ä»¶åŒ…å’ŒåŠ è½½çš„æ—¶å€™åå­—ä¸€å®šè¦ä¸€æ ·</p></li><li><p>æ³¨æ„ SD å¡çš„æƒé™</p></li></ol><p>è´´ä¸Šç›¸å…³å‚è€ƒæ–‡æ¡£å’Œæˆ‘çš„ githup ä»£ç </p><p><a href="https://github.com/didi/VirtualAPK" target="_blank" rel="noopener">https://github.com/didi/VirtualAPK</a></p><p><a href="https://github.com/didi/VirtualAPK/wiki/VirtualAPK-%E6%9E%84%E5%BB%BA%E5%99%A8-API-%E6%A6%82%E8%A7%88" target="_blank" rel="noopener">https://github.com/didi/VirtualAPK/wiki/VirtualAPK-%E6%9E%84%E5%BB%BA%E5%99%A8-API-%E6%A6%82%E8%A7%88</a></p><p>githubï¼š<a href="https://github.com/sdgSnow/VirtualAPK" target="_blank" rel="noopener">https://github.com/sdgSnow/VirtualAPK</a></p><p>å¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://github.com/didi/VirtualAPK/raw/master/imgs/va.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;å°é¢å›¾ç‰‡æ¥æº: &lt;a href=&quot;https://blog.csdn.net/byeweiyang/articl
      
    
    </summary>
    
      <category term="Android" scheme="https://yangxiaoge.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://yangxiaoge.github.io/tags/Android/"/>
    
      <category term="æ’ä»¶åŒ–" scheme="https://yangxiaoge.github.io/tags/%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>é”»ç‚¼èº«ä½“ä»ç°åœ¨åšèµ·</title>
    <link href="https://yangxiaoge.github.io/2018/03/23/2018-3-23-%E9%94%BB%E7%82%BC%E8%BA%AB%E4%BD%93%E4%BB%8E%E7%8E%B0%E5%9C%A8%E5%81%9A%E8%B5%B7/"/>
    <id>https://yangxiaoge.github.io/2018/03/23/2018-3-23-é”»ç‚¼èº«ä½“ä»ç°åœ¨åšèµ·/</id>
    <published>2018-03-23T11:19:14.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>èƒ–ï¼Œæ˜¯ä¸€ç§ä¸ç®¡åˆ«äººè¯´ã€Œä½ èƒ–äº†ã€æˆ–æ˜¯ã€Œä½ ç˜¦äº†ã€éƒ½èƒ½æ„Ÿè§‰åˆ°æœ‰å½¢çŠ¶çš„æ¶æ„æ‰‘é¢ç ¸æ¥çš„æ•æ„Ÿã€‚- <a href="https://www.zhihu.com/question/22918787/answer/23166234" target="_blank" rel="noopener">æ¨å°å½»çš„å›ç­” - çŸ¥ä¹ </a></p></blockquote><h3 id="ä¸Šå­¦"><a href="#ä¸Šå­¦" class="headerlink" title="ä¸Šå­¦"></a>ä¸Šå­¦</h3><p>æˆ‘ä¹Ÿæ˜¯æ›¾ç»ç˜¦è¿‡çš„äººï¼Œä¸€åº¦è®¤ä¸ºè‡ªå·±ä¸ä¼šèƒ–ï¼Œä¸Šåˆé«˜ä¸­ä¸€ç›´éƒ½æ²¡æœ‰èƒ–èµ·æ¥ã€‚äºæ˜¯æˆ‘ä¸Šäº†å¤§å­¦ï¼Œå…¥å­¦æ—¶119æ–¤173çš„ä¸ªå­ï¼Œå¤§å­¦ç–¯ç©äº†4å¹´ï¼Œèƒ¡åƒèƒ¡å–ï¼Œæ¯•ä¸šåæˆ‘125æ–¤ğŸ˜‚</p><h3 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h3><p>å·¥ä½œ1å¹´ä¸åˆ°ï¼Œé•¿æœŸåç€ä¹Ÿä¸æ€ä¹ˆè¿åŠ¨ï¼Œæ”¾å‡ä¹Ÿä¸å‡ºé—¨ï¼Œåè¶³çš„å®…ç”·ã€‚ä¸ç”¨æƒ³è‚¯å®šåˆèƒ–äº†ï¼Œemmmï¼Œ130æ–¤äº†Î£( Â°å“Â°|||)ï¸´ã€‚</p><h3 id="æ‰¾å¯¹è±¡"><a href="#æ‰¾å¯¹è±¡" class="headerlink" title="æ‰¾å¯¹è±¡"></a>æ‰¾å¯¹è±¡</h3><p>äº¤å¾€æˆ‘è€å©†ä»¥åï¼Œè‡ªå·±ä¹Ÿä¸å®…äº†ï¼ŒçŠ¹å¦‚ä¸€ä¸ªæ²¡åƒè¿‡ä¸œè¥¿çš„äººï¼Œåƒéäº†å„ç§ä»¥å‰æ²¡åƒè¿‡çš„é£Ÿç‰©ã€‚å¥¹åƒä¸å®Œçš„æˆ‘è¿™äººåˆèˆä¸å¾—æµªè´¹æˆ‘å°±å¸®ç€æ¶ˆç­äº†ï¼ˆå…¶å®è¿˜æ˜¯æˆ‘èƒ½åƒï¼‰ï¼Œå†åŠ ä¸Šè€å©†çƒ§çš„é¥­ä¹Ÿå¾ˆå¥½åƒï¼Œæˆ‘å°±holdä¸ä½äº†ã€‚</p><h3 id="ç°åœ¨"><a href="#ç°åœ¨" class="headerlink" title="ç°åœ¨"></a>ç°åœ¨</h3><p>éšç€æ—¶é—´æµé€ï¼Œæ¯•ä¸šå¿«3å¹´äº†ï¼Œæˆ‘ä½“é‡é£šåˆ°144æ–¤äº†ï¼Œå•Šäº”ç¯ï½ çªç„¶æƒ³å”±è¿™é¦–æ­ŒğŸ¤ã€‚å‘µï¼Œéš¾é“å°±æ˜¯èƒ–äº†å°±è¿™ä¹ˆç»“æŸäº†ï¼Ÿä¸ï¼Œæˆ‘è¿˜è¶Šæ¥è¶Šé»‘äº†ï¼Œç”±äºä»äº‹itæ¯å¤©ç”µè„‘ç›¸ä¼´ï¼ˆæˆ‘çŒœæ˜¯è¿™æ ·çš„ï¼‰ã€‚</p><h3 id="ä¸‹ä¸€æ­¥"><a href="#ä¸‹ä¸€æ­¥" class="headerlink" title="ä¸‹ä¸€æ­¥"></a>ä¸‹ä¸€æ­¥</h3><p>é‡ç‚¹æ¥äº†ï¼Œåœ¨è€å©†çš„<code>åŠå¯¼</code>ä¸‹æˆ‘è¦å¼€å§‹å¥èº«äº†ï¼Œæ²¡é”™å°±æ˜¯å¥èº«ï¼Œä¸èƒ½ä»»ç”±è‡ªå·±è¿™ä¹ˆèƒ–ä¸‹å»äº†ã€‚æ—¢ç„¶äº‹æ€å‘å±•åˆ°è¿™æ­¥ç”°åœ°ï¼Œç®­åœ¨å¼¦ä¸Šä¸å¾—ä¸å‘äº†ï¼Œä¸æ˜¯æˆ‘ç˜¦å°±æ˜¯å¥èº«æˆ¿äº¡ï¼ç¤¾ä¼šç¤¾ä¼š|ï½¥Ï‰ï½¥ï½€)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;èƒ–ï¼Œæ˜¯ä¸€ç§ä¸ç®¡åˆ«äººè¯´ã€Œä½ èƒ–äº†ã€æˆ–æ˜¯ã€Œä½ ç˜¦äº†ã€éƒ½èƒ½æ„Ÿè§‰åˆ°æœ‰å½¢çŠ¶çš„æ¶æ„æ‰‘é¢ç ¸æ¥çš„æ•æ„Ÿã€‚- &lt;a href=&quot;https://www.zhihu.com/question/22918787/answer/23166234&quot; target=&quot;_blank&quot;
      
    
    </summary>
    
    
      <category term="é—²è°ˆ" scheme="https://yangxiaoge.github.io/tags/%E9%97%B2%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>Nice git log</title>
    <link href="https://yangxiaoge.github.io/2017/12/13/2017-12-13-nice-git-log/"/>
    <id>https://yangxiaoge.github.io/2017/12/13/2017-12-13-nice-git-log/</id>
    <published>2017-12-13T10:11:01.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p>Git æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰ˆæœ¬ç®¡ç†å™¨ï¼Œè‡ªä»ç”¨ä¸Š git åï¼Œè…°ä¸é…¸è…¿ä¸ç–¼äº†ã€‚</p><p>å¼€å‘ä¸­æŸ¥çœ‹æäº¤è®°å½•æ˜¯å®¶å¸¸ä¾¿é¥­äº†ï¼Œ<code>git log</code> å‘½ä»¤æ˜¯æŸ¥çœ‹å…¨éƒ¨æäº¤æ—¥å¿—ï¼Œ<code>git log -2</code>  æŸ¥çœ‹æœ€è¿‘ 2 æ¬¡çš„æäº¤æ—¥å¿—ï¼Œ<code>git log -p</code>  æŸ¥çœ‹å†å²çºªå½•ä»¥æ¥å“ªå‡ è¡Œè¢«ä¿®æ”¹ï¼Œ<code>git log --stat --summary</code> æŸ¥çœ‹æ¯ä¸ªç‰ˆæœ¬å˜åŠ¨çš„æ¡£æ¡ˆå’Œè¡Œæ•°ã€‚</p><p>Git é»˜è®¤çš„ git log æ˜¯è¿™æ ·å­çš„ï¼Œemmmmmmâ€¦.. ä¸‘</p><div align="center"><img src="https://i.loli.net/2017/12/14/5a31e2fcca990.png"></div><p>äºæ˜¯ä¹ Google äº†ä¸€ä¸ª git é…ç½®ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ã€‚</p><pre><code>git config --global alias.lg &quot;log --color --graph --pretty=format:&#39;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#39; --abbrev-commit&quot;  </code></pre><p>ä»¥ååœ¨ç»ˆç«¯è¾“å…¥ git lgï¼Œå°±èƒ½çœ‹åˆ°ä¸‹é¢æ¼‚äº®çš„ git log äº†ã€‚</p><div align="center"><img src="https://i.loli.net/2017/12/14/5a31e32602b21.png"></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Git æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰ˆæœ¬ç®¡ç†å™¨ï¼Œè‡ªä»ç”¨ä¸Š git åï¼Œè…°ä¸é…¸è…¿ä¸ç–¼äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¼€å‘ä¸­æŸ¥çœ‹æäº¤è®°å½•æ˜¯å®¶å¸¸ä¾¿é¥­äº†ï¼Œ&lt;code&gt;git log&lt;/code&gt; å‘½ä»¤æ˜¯æŸ¥çœ‹å…¨éƒ¨æäº¤æ—¥å¿—ï¼Œ&lt;code&gt;git log -2&lt;/code&gt;  æŸ¥çœ‹æœ€è¿‘ 2 æ¬¡çš„æäº¤æ—¥å¿—ï¼Œ&lt;code&gt;
      
    
    </summary>
    
    
      <category term="Git" scheme="https://yangxiaoge.github.io/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Android Launcher ç•Œé¢æ·»åŠ æœªæ¥æ¥ç”µ/æœªè¯»çŸ­ä¿¡æ¡æ•°æ˜¾ç¤º</title>
    <link href="https://yangxiaoge.github.io/2017/10/19/2017-10-19-Android-Launcher-%E7%95%8C%E9%9D%A2%E6%B7%BB%E5%8A%A0%E6%9C%AA%E6%8E%A5%E6%9D%A5%E7%94%B5-%E6%9C%AA%E8%AF%BB%E7%9F%AD%E4%BF%A1%E6%9D%A1%E6%95%B0%E6%98%BE%E7%A4%BA/"/>
    <id>https://yangxiaoge.github.io/2017/10/19/2017-10-19-Android-Launcher-ç•Œé¢æ·»åŠ æœªæ¥æ¥ç”µ-æœªè¯»çŸ­ä¿¡æ¡æ•°æ˜¾ç¤º/</id>
    <published>2017-10-19T16:00:50.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Thumbnail by <a href="https://octiviotti.deviantart.com/" target="_blank" rel="noopener">octiviotti</a></p></blockquote><p>æœ¬æ–‡ä»£ç åŸºäº Android 6.0ï¼ˆé«˜é€šï¼‰ï¼ŒåŸç”Ÿä¸æ”¯æŒæœªæ¥æ¥ç”µä»¥åŠæœªè¯»çŸ­ä¿¡çš„å›¾æ ‡å³ä¸Šè§’æ•°ç›®æ˜¾ç¤ºã€‚</p><p>æ¶‰åŠåˆ°å‡ ä¸ªæ–‡ä»¶ï¼š<br><a id="more"></a></p><ol><li>packages/apps/Launcher3/src/com/android/launcher3/Launcher.java</li><li>packages/apps/Launcher3/src/com/android/launcher3/Utilities.java</li><li>packages/apps/Launcher3/AndroidManifest.xml </li></ol><p>å…·ä½“çš„æ€è·¯ï¼š<code>Launcher</code> ä¸­æ³¨å†Œ <code>ContentObserver</code> æ¥ç›‘å¬çŸ­ä¿¡å’Œç”µè¯æ•°æ®åº“ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¯»å–è¯»å–æ•°æ®åº“æœªè¯»æ•°ç›®ä¹‹åé€šè¿‡ ICON_NAME ï¼Œ<code>é‡æ–°ç»˜åˆ¶</code>çŸ­ä¿¡ï¼Œç”µè¯çš„å›¾æ ‡ï¼ˆåœ¨åŸå›¾å³ä¸Šè§’ç”»åœ†å’Œæ•°å­—ï¼‰ã€‚</p><hr><p>å…·ä½“ä»£ç ï¼š</p><h3 id="1-Launcher-java"><a href="#1-Launcher-java" class="headerlink" title="1. Launcher.java"></a>1. Launcher.java</h3><ul><li>é¦–å…ˆæ˜¯å®šä¹‰ä¸¤ä¸ª ContentObserver</li></ul><pre><code>private final static int UPDATE_MMS_ICON = 826;  private final static int UPDATE_CALL_ICON = 1206;public class SMSContentObserver extends ContentObserver {    private Handler mHandler;    public SMSContentObserver(Context context, Handler handler) {        super(handler);        mHandler = handler;    }    @Override    public void onChange(boolean selfChange) {        Log.i(&quot;Launcher-&quot;,&quot;SMSContentObserver onChange&quot;);        mHandler.removeMessages(UPDATE_MMS_ICON);        Message msg = mHandler.obtainMessage(UPDATE_MMS_ICON);        msg.obj = getMissMmsCount();        mHandler.sendMessage(msg);    }}public class CallContentObserver extends ContentObserver {    private Handler mHandler;    public CallContentObserver(Context context, Handler handler) {        super(handler);        mHandler = handler;    }    @Override    public void onChange(boolean selfChange) {        Log.i(&quot;Launcher-&quot;,&quot;CallContentObserver onChange&quot;);        mHandler.removeMessages(UPDATE_CALL_ICON);        Message msg = mHandler.obtainMessage(UPDATE_CALL_ICON);        msg.obj = getMissCallCount();        mHandler.sendMessage(msg);    }}</code></pre><ul><li>åœ¨ onCreate() ä¸­æ³¨å†Œ ContentObserver</li></ul><pre><code>private SMSContentObserver smsContentObserver = null;  private CallContentObserver callContentObserver = null;  smsContentObserver = new SMSContentObserver(this,mHandler);callContentObserver =new CallContentObserver(this,mHandler);getContentResolver().registerContentObserver(Calls.CONTENT_URI,true,callContentObserver);getContentResolver().registerContentObserver(Uri.parse(&quot;content://mms-sms/&quot;),true,smsContentObserver);</code></pre><ul><li>å®šä¹‰ä¸¤ä¸ª ICON_NAME</li></ul><pre><code>// è¿™ä¸¤ä¸ª ICON_NAME æ ¹æ®è‡ªå·±å®é™…ç³»ç»ŸçŸ­ä¿¡å’Œç”µè¯é¡µé¢å¯¹åº”åŒ…åå¡«å†™private final static String PHONE_ICON_NAME = &quot;com.android.dialer.DialtactsActivity&quot;;private final static String MMS_ICON_NAME = &quot;com.android.messaging.ui.conversationlist.ConversationListActivity&quot;;</code></pre><ul><li>mHandler ä¸­å¤„ç†</li></ul><pre><code>@Thunkfinal Handler mHandler = new Handler(new Handler.Callback() {    @Override    public boolean handleMessage(Message msg) {        Log.i(&quot;Launcher-&quot;,&quot;mHandler msg.what = &quot; + msg.what);        if (msg.what == ADVANCE_MSG) {            int i = 0;            for (View key : mWidgetsToAdvance.keySet()) {                final View v = key.findViewById(mWidgetsToAdvance.get(key).autoAdvanceViewId);                final int delay = mAdvanceStagger * i;                if (v instanceof Advanceable) {                    mHandler.postDelayed(new Runnable() {                        public void run() {                            ((Advanceable) v).advance();                        }                    }, delay);                }                i++;            }            sendAdvanceMessage(mAdvanceInterval);        }        //ADD BY Bruce Yang FOR SHOW UNREAD MMS        else if (msg.what == UPDATE_MMS_ICON) {            setMmsOrPhoneNum(MMS_ICON_NAME, getMissMmsCount());        } else if (msg.what == UPDATE_CALL_ICON) {            setMmsOrPhoneNum(PHONE_ICON_NAME, getMissCallCount());        }        return true;    }});</code></pre><ul><li>è·å–æ•°æ®åº“ä¸­æœªè¯»æ•°ç›®</li></ul><pre><code> private int getMissMmsCount() {    Log.i(&quot;Launcher-&quot;,&quot;getMissMmsCount&quot;);    int missSmsCount = 0;    Cursor cursorSMS = null;    Cursor cursorMMS = null;    try {        cursorSMS = getContentResolver().query(                Uri.parse(&quot;content://sms&quot;), null, &quot;(read=0 and type=1)&quot;,                null, null);        cursorMMS = getContentResolver().query(                Uri.parse(&quot;content://mms&quot;), null, &quot;(read=0)&quot;, null,                null);    } catch (SQLiteException e) {        return missSmsCount;    }    if (cursorSMS != null) {        missSmsCount = cursorSMS.getCount();        cursorSMS.close();    }    if (cursorMMS != null) {            missSmsCount = missSmsCount + cursorMMS.getCount();        cursorMMS.close();    }    Log.i(&quot;Launcher-&quot;,&quot;getMissMmsCount  missSmsCount = &quot; + missSmsCount);    return missSmsCount;}private int getMissCallCount() {    Log.i(&quot;Launcher-&quot;,&quot;getMissCallCount&quot;);    int missCallCount = 0;    Uri missingCallUri = Calls.CONTENT_URI;    String where = Calls.TYPE + &quot;=&#39;&quot; + Calls.MISSED_TYPE + &quot;&#39;&quot;            + &quot; AND new=1&quot;;    Cursor cursorCall = null;    try {        cursorCall = getContentResolver().query(missingCallUri,                null, where, null, null);    } catch (SQLiteException e) {        return missCallCount;    }    if (cursorCall != null) {        missCallCount = cursorCall.getCount();        cursorCall.close();    }    Log.i(&quot;Launcher-&quot;,&quot;getMissCallCount  missCallCount = &quot; + missCallCount);    return missCallCount;}</code></pre><ul><li>è®¾ç½® ICON æœªè¯»æ•°</li></ul><pre><code>/**    *    * @param flag æ›´æ–°ç”µè¯æˆ–çŸ­ä¿¡ ICON    * @param missCount æœªè¯»æ•°*/private void setMmsOrPhoneNum(final String flag, final int missCount) {    Log.i(&quot;Launcher-&quot;,&quot;flag = &quot;+flag +&quot; missCount = &quot;+missCount);    if(mWorkspace == null) return;    ArrayList&lt;CellLayout&gt; cellLayouts = mWorkspace.getWorkspaceAndHotseatCellLayouts();    for (final CellLayout layoutParent: cellLayouts) {        final ViewGroup shortcutAndWidgetContainer = layoutParent.getShortcutsAndWidgets();        mWorkspace.post(new Runnable() {            public void run() {                int childCount = shortcutAndWidgetContainer.getChildCount();                for (int j = 0; j &lt;childCount; j++) {                    View view = shortcutAndWidgetContainer.getChildAt(j);                    Object tag = view.getTag();                    if (tag instanceof ShortcutInfo) {                        final ShortcutInfo info = (ShortcutInfo) tag;                        final Intent intent = info.intent;                        if (intent != null) {                            final ComponentName name = intent.getComponent();                            if (name != null &amp;&amp; name.getClassName().equals(flag)) {                                BubbleTextView bv = (BubbleTextView) view;                                Bitmap defaultIconBitmap = Bitmap.createBitmap(info.getIcon(mIconCache));                                Bitmap bitmap = Utilities.createIconBitmap(defaultIconBitmap, missCount);                                bv.setCompoundDrawablesWithIntrinsicBounds(null,                                        new FastBitmapDrawable(bitmap),                                        null, null);                            }                        }                    }                }            }        });    }}</code></pre><ul><li>ç¬¬ä¸€æ¬¡å¯åŠ¨ Launcher å°±èƒ½è·å–æœªè¯»æ•°ç›®ï¼Œåœ¨ finishBindingItems() æ·»åŠ é€»è¾‘</li></ul><pre><code>//ADD BY Bruce Yangint missCall = getMissCallCount();int missMms = getMissMmsCount();if(missCall != 0) {    setMmsOrPhoneNum(PHONE_ICON_NAME, missCall);}if(missMms != 0) {    setMmsOrPhoneNum(MMS_ICON_NAME, missMms);}</code></pre><ul><li>åœ¨ onDestroy() ä¸­åæ³¨å†Œ ContentObserver</li></ul><pre><code>getContentResolver().unregisterContentObserver(smsContentObserver);getContentResolver().unregisterContentObserver(callContentObserver);</code></pre><h3 id="2-Utilities-java"><a href="#2-Utilities-java" class="headerlink" title="2. Utilities.java"></a>2. Utilities.java</h3><p>æ–°å¢æ„é€ æ–¹æ³•ï¼Œç”¨äºé‡æ–°ç»˜åˆ¶å¸¦æ•°å­—çš„åº”ç”¨å›¾æ ‡ã€‚</p><pre><code>//add by Bruce Yang for ...static Bitmap createIconBitmap(Bitmap b, int count) {    Bitmap bitmap = b.copy(Bitmap.Config.ARGB_8888,true);    Log.i(&quot;Launcher-&quot;,&quot;b.isMutable() = &quot;+b.isMutable()); // å¦‚æœä¸º false å°±ä¼šæŠ›å‡º java.lang.IllegalStateException å¼‚å¸¸ï¼Œ http://bbs.csdn.net/topics/370021698    if (count == 0) return b;    int textureWidth = bitmap.getWidth();    final Canvas canvas = sCanvas;    Paint paint = new Paint(Paint.ANTI_ALIAS_FLAG | Paint.DEV_KERN_TEXT_FLAG);    canvas.setBitmap(bitmap);    paint.setColor(Color.RED);    canvas.drawCircle(textureWidth - 17-6, 16+6, 16+6, paint);    paint.setColor(Color.WHITE);    paint.setStyle(Paint.Style.STROKE);    paint.setStrokeWidth(2);    canvas.drawCircle(textureWidth - 17-6, 16+6, 16+6, paint);    Paint countPaint = new Paint(Paint.ANTI_ALIAS_FLAG | Paint.DEV_KERN_TEXT_FLAG);    countPaint.setColor(Color.WHITE);    countPaint.setTextSize(26f);    countPaint.setTypeface(Typeface.DEFAULT_BOLD);    float x = textureWidth - 24-4;    if (count &gt; 9) x -= 4+6;    if (count &gt; 99) {        countPaint.setTextSize(22f);        String text = String.valueOf(99) + &quot;+&quot;;        canvas.drawText(text, x-2, 25+5, countPaint);    } else {        String text = String.valueOf(count);        canvas.drawText(text,x, 25+5, countPaint);    }    return bitmap;}</code></pre><h3 id="3-AndroidManifest-xml"><a href="#3-AndroidManifest-xml" class="headerlink" title="3. AndroidManifest.xml"></a>3. AndroidManifest.xml</h3><p>æ·»åŠ å¦‚ä¸‹ä¸¤ä¸ªæƒé™ï¼Œç”±äº Android 6.0 ä»¥ä¸Šéœ€è¦åŠ¨æ€æƒé™ç”³è¯·ï¼Œè¿™é‡Œä¸ºäº†ç›´æ¥è·å–æƒé™ï¼Œå¯ä»¥å°† targetSdkVersion æ”¹æˆ 21ï¼ˆåŸæ¥æ˜¯ 23ï¼‰ã€‚</p><pre><code>&lt;uses-permission android:name=&quot;android.permission.READ_SMS&quot; /&gt;&lt;uses-permission android:name=&quot;android.permission.READ_CALL_LOG&quot; /&gt;</code></pre><h3 id="4-ä¿®æ”¹å¯¹æ¯”"><a href="#4-ä¿®æ”¹å¯¹æ¯”" class="headerlink" title="4. ä¿®æ”¹å¯¹æ¯”"></a>4. ä¿®æ”¹å¯¹æ¯”</h3><blockquote><p>ä¿®æ”¹å‰ï¼š</p></blockquote><p><img src="https://i.loli.net/2017/10/19/59e865f6b26df.png" width="270" height="480"></p><blockquote><p>ä¿®æ”¹åï¼š</p></blockquote><p><img src="https://i.loli.net/2017/10/19/59e86659672b9.png" width="270" height="480"></p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š </p></blockquote><p><a href="http://blog.csdn.net/chenxiong668/article/details/12851357" target="_blank" rel="noopener">http://blog.csdn.net/chenxiong668/article/details/12851357</a><br><a href="http://blog.csdn.net/kerancsdn/article/details/26705767" target="_blank" rel="noopener">http://blog.csdn.net/kerancsdn/article/details/26705767</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Thumbnail by &lt;a href=&quot;https://octiviotti.deviantart.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;octiviotti&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä»£ç åŸºäº Android 6.0ï¼ˆé«˜é€šï¼‰ï¼ŒåŸç”Ÿä¸æ”¯æŒæœªæ¥æ¥ç”µä»¥åŠæœªè¯»çŸ­ä¿¡çš„å›¾æ ‡å³ä¸Šè§’æ•°ç›®æ˜¾ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;æ¶‰åŠåˆ°å‡ ä¸ªæ–‡ä»¶ï¼š&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://yangxiaoge.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ä» 0 æ­å»ºç›´æ’­ç³»ç»Ÿ</title>
    <link href="https://yangxiaoge.github.io/2017/09/12/2017-09-12-%E4%BB%8E-0-%E6%90%AD%E5%BB%BA%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/"/>
    <id>https://yangxiaoge.github.io/2017/09/12/2017-09-12-ä»-0-æ­å»ºç›´æ’­ç³»ç»Ÿ/</id>
    <published>2017-09-12T15:45:18.000Z</published>
    <updated>2017-10-12T15:45:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ç›´æƒ³æä¸ªç›´æ’­çš„ Demoï¼Œä»Šå¤©æ­£å¥½çœ‹åˆ°<a href="http://blog.csdn.net/lmj623565791/article/details/77937483" target="_blank" rel="noopener">é¸¿æ´‹å…¬ä¼—å·ï¼šè½»æ¾å…¥é—¨ Android ç›´æ’­ç›¸å…³æŠ€æœ¯ ä» 0 æ­å»ºç›´æ’­ç³»ç»Ÿ</a>ï¼Œç´¢æ€§å°±æŠŠæˆ‘è‡ªå·±çš„æ­(æŠ˜)å»º(è…¾)è¿‡ç¨‹åšä¸€ä¸ªè®°å½•ã€‚<br><a id="more"></a><br>æ­å»ºæµç¨‹ï¼š</p><blockquote><p>æœåŠ¡å™¨ç³»ç»Ÿï¼šUbuntu 16.10 ç³»ç»Ÿ<br>æ¨æµï¼Œæ‹‰æµç³»ç»Ÿï¼šWin 7, Android</p></blockquote><p>ä¸€ä¸ªç®€æ˜“çš„ç›´æ’­ç³»ç»Ÿï¼Œå¤§è‡´å¯ä»¥ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼ˆè¯¦æƒ…è§<a href="http://blog.csdn.net/lmj623565791/article/details/77937483" target="_blank" rel="noopener">é¸¿æ´‹åšå®¢</a>ï¼‰ï¼š</p><ul><li>æ­å»ºä¸€ä¸ª rtmp åª’ä½“æœåŠ¡å™¨ï¼šè¿™é‡Œä½¿ç”¨ srsï¼Œé“¾æ¥ä¸ºï¼š<a href="https://github.com/ossrs/srs" target="_blank" rel="noopener">https://github.com/ossrs/srs</a></li><li>æ¨æµç«¯ï¼šè¿™é‡Œä½¿ç”¨ obsï¼Œé“¾æ¥ä¸ºï¼š<a href="https://obsproject.com/" target="_blank" rel="noopener">https://obsproject.com/</a></li><li>æ‹‰æµç«¯ï¼šè¿™é‡Œä½¿ç”¨æ’­æ”¾å™¨ vlcï¼Œé“¾æ¥ä¸ºï¼š<a href="http://www.videolan.org/vlc/" target="_blank" rel="noopener">http://www.videolan.org/vlc/</a></li></ul><h3 id="ä½¿ç”¨ç¬¬ä¸‰æ–¹-SDK-æ¨æµ"><a href="#ä½¿ç”¨ç¬¬ä¸‰æ–¹-SDK-æ¨æµ" class="headerlink" title="ä½¿ç”¨ç¬¬ä¸‰æ–¹ SDK æ¨æµ"></a>ä½¿ç”¨ç¬¬ä¸‰æ–¹ SDK æ¨æµ</h3><p>è¿™é‡Œä»¥ç™¾åº¦äº‘çš„ç›´æ’­ SDK ä¸ºä¾‹ï¼Œä¸‹è½½åœ°å€ï¼š<br><a href="https://cloud.baidu.com/doc/Downloadcenter/Push.html#.E7.89.88.E6.9C.AC.E6.9B.B4.E6.96.B0.E8.AF.B4.E6.98.8E" target="_blank" rel="noopener">https://cloud.baidu.com/doc/Downloadcenter/Push.html#.E7.89.88.E6.9C.AC.E6.9B.B4.E6.96.B0.E8.AF.B4.E6.98.8E</a></p><p>ä¿®æ”¹æ¨æµåœ°å€ä¹‹åä¸Šä¼ åˆ°äº†æˆ‘çš„ <a href="https://github.com/yangxiaoge/PushFlowLive" target="_blank" rel="noopener">PushFlowLive</a></p><p><a href="https://github.com/yangxiaoge/Zz_Application/raw/master/gif_public/%E4%BB%8E%200%20%E6%90%AD%E5%BB%BA%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/apk/baidu-livecamera-%E6%8E%A8%E6%B5%81.apk" target="_blank" rel="noopener">apk ä¸‹è½½</a></p><h3 id="ä½¿ç”¨å¼€æºé¡¹ç›®æ¨æµ"><a href="#ä½¿ç”¨å¼€æºé¡¹ç›®æ¨æµ" class="headerlink" title="ä½¿ç”¨å¼€æºé¡¹ç›®æ¨æµ"></a>ä½¿ç”¨å¼€æºé¡¹ç›®æ¨æµ</h3><p>ä½¿ç”¨ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼š</p><blockquote><p><a href="https://github.com/begeekmyfriend/yasea" target="_blank" rel="noopener">https://github.com/begeekmyfriend/yasea</a></p></blockquote><blockquote><p><a href="https://github.com/yangxiaoge/Zz_Application/raw/master/gif_public/%E4%BB%8E%200%20%E6%90%AD%E5%BB%BA%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/apk/yasea-æ¨æµ.apk" target="_blank" rel="noopener">apk ä¸‹è½½</a></p></blockquote><h3 id="åˆ©ç”¨-ffmpeg-æ¨æµ"><a href="#åˆ©ç”¨-ffmpeg-æ¨æµ" class="headerlink" title="åˆ©ç”¨ ffmpeg æ¨æµ"></a>åˆ©ç”¨ ffmpeg æ¨æµ</h3><blockquote><p>è¯¦æƒ…è§é¸¿æ´‹åšå®¢</p></blockquote><p>å¤§å®¶å¯ä»¥è‡ªå·±ä¸‹è½½ ffmepg çš„æºç ï¼Œç„¶åæŒ‰ç…§ç½‘ä¸Šçš„æ–¹å¼å»ç¼–æˆ soï¼Œç®€å•çš„ä¸€ç‚¹è€Œä¸”æ¯”è¾ƒå®ç”¨çš„ï¼Œå°±æ˜¯ç¼–å‡ºå¯ä»¥æ‰§è¡Œ ffmpeg å‘½ä»¤çš„ soï¼Œè¿™æ ·å°±èƒ½å¹²å¾ˆå¤šäº‹æƒ…äº†ã€‚</p><p>è¿™é‡Œï¼Œç”±äºç¯‡å¹…ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨åˆ«äººç¼–å¥½çš„é¡¹ç›®äº†ã€‚</p><p><a href="https://github.com/WritingMinds/ffmpeg-android-java" target="_blank" rel="noopener">https://github.com/WritingMinds/ffmpeg-android-java</a></p><p><strong><em>æ­å»ºè¿‡ç¨‹æˆªå›¾</em></strong>ï¼š<br>ç›´æ’­æ­¥éª¤ï¼š1ï¼Œå¼€å¯rtmp åª’ä½“æœåŠ¡å™¨ 2ï¼Œæ¨æµï¼ˆæ¨æµå®¢æˆ·ç«¯ï¼Œapkç­‰ï¼‰ 3ï¼Œæ‹‰æµï¼ˆvlcç­‰ï¼‰<br><img src="https://raw.githubusercontent.com/yangxiaoge/Zz_Application/fc9482b0e15cf82aa60e0a7b943e41d22cac09c9/gif_public/%E4%BB%8E%200%20%E6%90%AD%E5%BB%BA%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/photo_2017-09-12_14-43-43.jpg" alt></p><p><img src="https://raw.githubusercontent.com/yangxiaoge/Zz_Application/fc9482b0e15cf82aa60e0a7b943e41d22cac09c9/gif_public/%E4%BB%8E%200%20%E6%90%AD%E5%BB%BA%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/photo_2017-09-12_14-43-51.jpg" alt="åˆ©ç”¨æ‰‹æœºç«¯æ¨æµï¼Œç”µè„‘ç«¯é€šè¿‡ VLC æ‹‰æµ"></p><p><img src="https://raw.githubusercontent.com/yangxiaoge/Zz_Application/fc9482b0e15cf82aa60e0a7b943e41d22cac09c9/gif_public/%E4%BB%8E%200%20%E6%90%AD%E5%BB%BA%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/photo_2017-09-12_14-43-57.jpg" alt="åˆ©ç”¨æ‰‹æœºç«¯æ¨æµï¼Œç”µè„‘ç«¯é€šè¿‡ VLC æ‹‰æµ"></p><p><img src="https://raw.githubusercontent.com/yangxiaoge/Zz_Application/fc9482b0e15cf82aa60e0a7b943e41d22cac09c9/gif_public/%E4%BB%8E%200%20%E6%90%AD%E5%BB%BA%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/photo_2017-09-12_14-44-02.jpg" alt="åˆ©ç”¨æ‰‹æœºç«¯æ¨æµï¼Œç”µè„‘ç«¯é€šè¿‡ VLC æ‹‰æµ"></p><p><img src="https://raw.githubusercontent.com/yangxiaoge/Zz_Application/fc9482b0e15cf82aa60e0a7b943e41d22cac09c9/gif_public/%E4%BB%8E%200%20%E6%90%AD%E5%BB%BA%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/photo_2017-09-12_14-44-04.jpg" alt></p><blockquote><p>å°é¢å°é»„äººåŠ¨å›¾æ¥è‡ª <a href="https://giphy.com/search/new-follower" target="_blank" rel="noopener">giphy</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€ç›´æƒ³æä¸ªç›´æ’­çš„ Demoï¼Œä»Šå¤©æ­£å¥½çœ‹åˆ°&lt;a href=&quot;http://blog.csdn.net/lmj623565791/article/details/77937483&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é¸¿æ´‹å…¬ä¼—å·ï¼šè½»æ¾å…¥é—¨ Android ç›´æ’­ç›¸å…³æŠ€æœ¯ ä» 0 æ­å»ºç›´æ’­ç³»ç»Ÿ&lt;/a&gt;ï¼Œç´¢æ€§å°±æŠŠæˆ‘è‡ªå·±çš„æ­(æŠ˜)å»º(è…¾)è¿‡ç¨‹åšä¸€ä¸ªè®°å½•ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="ç›´æ’­" scheme="https://yangxiaoge.github.io/tags/%E7%9B%B4%E6%92%AD/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çœ¼ä¸­çš„ Android Framework</title>
    <link href="https://yangxiaoge.github.io/2017/09/05/2017-09-05-%E6%88%91%E7%9C%BC%E4%B8%AD%E7%9A%84-Android-Framework/"/>
    <id>https://yangxiaoge.github.io/2017/09/05/2017-09-05-æˆ‘çœ¼ä¸­çš„-Android-Framework/</id>
    <published>2017-09-05T14:16:37.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å¼€å‘ä¸­æˆ‘ä»¬ä¼šé‡åˆ°å„ç§å„æ ·çš„éå¸¸å¥‡æ€ªçš„é—®é¢˜ï¼Œæœ‰äº›é—®é¢˜æ˜¯ç™¾æ€ä¸å¾—éª‘å§ã€‚å…¶å®è¿™äº›é—®é¢˜å¤§éƒ½æ˜¯å› ä¸ºæˆ‘ä»¬ä¸äº†è§£å®‰å“å†…éƒ¨è¿è¡ŒåŸç†ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶æ‰æ˜¯æˆ‘ä»¬çš„ç›®çš„ã€‚â€” <code>å‰è¨€</code><br><a id="more"></a></p><blockquote><p>æœ¬æ–‡è½¬è‡ª <a href="https://juejin.im/post/586da43b1b69e60062cb8a4f" target="_blank" rel="noopener">å¢¨é•œçŒ«</a>ï¼Œé€šä¿—æœ‰è¶£çš„æ–‡ç¬”</p></blockquote><div align="center"><img src="https://github.com/yangxiaoge/PersonResources/blob/bfd168d0f60a7fa8b11ad50cdc53694c77d90bd9/Android/Android%20Framework.jpg?raw=true"></div><p>ä»»ä½•æ§åˆ¶ç±»ç¨‹åºéƒ½æœ‰ä¸€ä¸ªå…¥å£ï¼Œå®‰å“åº”ç”¨ç¨‹åºè‚¯å®šä¹Ÿæ˜¯æœ‰æ»´ã€‚<br>Android framework åŒ…å«ä¸‰ä¸ªå°ä¼™ä¼´ï¼šæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯ã€linux é©±åŠ¨ã€‚</p><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><p>æœåŠ¡ç«¯ä¸»è¦åŒ…å«ä¸¤ä¸ªç‹ é‡è¦çš„ç±»ï¼šWindowManagerServiceï¼ˆWMSï¼‰å’Œ ActivityManagerServiceï¼ˆAMSï¼‰</p><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><p>å®¢æˆ·ç«¯åŒ…å«ä»¥ä¸‹ç±»ï¼š</p><ul><li>ActivityThreadï¼šæ˜¯å®‰å“åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ç±»ï¼Œè¿™ä¸ªå°ä¼™ä¼´æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯ UI çº¿ç¨‹æˆ–è€…ç§°ä¸ºä¸»çº¿ç¨‹ã€‚</li><li>Activityï¼šActivityThread ä¼šæ ¹æ®ç”¨æˆ·çš„æ“ä½œé€‰æ‹©è®©å“ªä¸ª Activity å¯¹è±¡ä¸Šå®ƒçš„èˆ¹ã€‚</li><li>PhoneWindowï¼šå¯ŒäºŒä»£ï¼Œç»§æ‰¿äºç‰›æ°”çš„ Window ç±»ï¼Œè‡ªå·±å±‹é‡Œä½ç€ä¸€ä¸ª DecorView å¯¹è±¡ï¼Œåƒå®ƒè€çˆ¸å–œæ¬¢åˆ¶å®šè§„åˆ™æä¾›äº†ä¸€äº›é€šç”¨çª—å£æ“ä½œ APIã€‚</li><li>Windowï¼šå¯Œä¸€ä»£ï¼Œé•¿å¾—æ¯”è¾ƒæŠ½è±¡ï¼Œå–œæ¬¢åˆ¶å®šè§„åˆ™æä¾›äº†ä¸€äº›é€šç”¨çš„çª—å£æ“ä½œ APIã€‚å®ƒä¸å–œæ¬¢è¢«äººç®¡æ‰€ä»¥å‘¢ï¼Œæ³¨æ„ï¼šWindowManagerService ç®¡ç†çš„çª—å£ä¸æ˜¯ Window ç±»ï¼Œå…¶å®æ˜¯ View å’Œ ViewGroupã€‚</li><li>DecorViewï¼šå¾ˆèƒ½å¹²çš„å®¶ä¼™ï¼Œå®¶äº§æ¥è‡ª FrameLayoutï¼Œæ¯”è¾ƒæ³¨é‡å¤–åœ¨å–œæ¬¢æ‰“æ‰®ï¼ŒDecorView æ˜¯å¯¹ FrameLayout è¿›è¡Œäº†ä¸€äº›ä¿®é¥°ï¼Œä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚</li><li>ViewRootï¼šå°ç®¡å®¶ç»§æ‰¿äº Handlerï¼Œä¸»è¦ä½œç”¨æ˜¯æŠŠ WMS çš„ IPC è°ƒç”¨è½¬æ¢ä¸ºæœ¬åœ°çš„ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ã€‚</li><li>W ç±»ï¼šViewRoot å°åŠ©æ‰‹ï¼Œç»§æ‰¿äº binderï¼Œæ˜¯ ViewRoot å†…éƒ¨ç±»ã€‚ä¸»è¦å¸®åŠ© ViewRoot å®ç°æŠŠ WMS çš„ IPC è°ƒç”¨è½¬æ¢ä¸ºæœ¬åœ°çš„ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ã€‚</li><li>WindowManagerï¼šå®¢æˆ·ç«¯å¦‚æœæƒ³åˆ›å»ºä¸€ä¸ªçª—å£å¾—å…ˆå‘Šè¯‰ WindowManager ä¸€å£°ï¼Œç„¶åå®ƒå†å’Œ WindowManagerService äº¤æµä¸€ä¸‹çœ‹çœ‹èƒ½ä¸èƒ½åˆ›å»ºï¼Œå®¢æˆ·ç«¯ä¸èƒ½ç›´æ¥å’Œ WMS äº¤äº’ã€‚</li></ul><h3 id="Linux-é©±åŠ¨"><a href="#Linux-é©±åŠ¨" class="headerlink" title="Linux é©±åŠ¨"></a>Linux é©±åŠ¨</h3><p>Linux é©±åŠ¨å’Œ Framework ç›¸å…³çš„ä¸»è¦æ˜¯ä¸¤ä¸ªéƒ¨åˆ†ï¼šç”»å®¶ SurfaceFlingger å’Œå¿«é€’å‘˜ Binderã€‚</p><p>æ¯ä¸€ä¸ªçª—å£éƒ½å¯¹åº”ä¸€ä¸ªç”» Surfaceï¼ŒSF ä¸»è¦æ˜¯æŠŠå„ä¸ª Surface æ˜¾ç¤ºåˆ°åŒä¸€å±å¹•ä¸Šã€‚Binder æ˜¯æä¾›è·¨è¿›ç¨‹çš„æ¶ˆæ¯ä¼ é€’ã€‚</p><h3 id="ä»-apk-ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹å»çœ‹çœ‹ä¸Šé¢å„ä¸ªç»„ä»¶åœ¨å•¥æ—¶å€™å¹²å•¥æ´»çš„"><a href="#ä»-apk-ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹å»çœ‹çœ‹ä¸Šé¢å„ä¸ªç»„ä»¶åœ¨å•¥æ—¶å€™å¹²å•¥æ´»çš„" class="headerlink" title="ä» apk ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹å»çœ‹çœ‹ä¸Šé¢å„ä¸ªç»„ä»¶åœ¨å•¥æ—¶å€™å¹²å•¥æ´»çš„"></a>ä» apk ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹å»çœ‹çœ‹ä¸Šé¢å„ä¸ªç»„ä»¶åœ¨å•¥æ—¶å€™å¹²å•¥æ´»çš„</h3><p>ActivityThread ä» main() å‡½æ•°ä¸­å°±å¼€å§‹åŠ¨èµ·æ¥ï¼Œç„¶åè°ƒç”¨ prepareMainLooper() ä¸º UI çº¿ç¨‹åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯å¿«é€’é€šé“å³ MessageQueueã€‚</p><p>æ¥ç€åˆ›å»º ActivityThread å¯¹è±¡ï¼Œåˆ›å»ºè¿‡ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªæ¶ˆæ¯è£…å¸å·¥ Handler å¯¹è±¡å’Œä¸€ä¸ªå¿«é€’å‘˜ Binder å¯¹è±¡ï¼Œå…¶ä¸­ Binder è´Ÿè´£æ¥æ”¶è¿œç¨‹ Ams çš„ IPC è°ƒç”¨ï¼Œæ¥æ”¶åˆ°è°ƒç”¨åè®© Handler æŠŠæ¶ˆæ¯è£…åˆ°æ¶ˆæ¯å¿«é€’é˜Ÿåˆ—ï¼ŒUI çº¿ç¨‹å¾ˆå¿™çš„éƒ½æ˜¯å¼‚æ­¥çš„ä»æ¶ˆæ¯å¿«é€’é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶æ‰§è¡Œç›¸åº”æ“ä½œï¼Œæ¯”å¦‚ startã€stopã€pauseã€‚</p><p>ç„¶å UI çº¿ç¨‹è®©é˜Ÿåˆ—è°ƒç”¨ Looper.loop() æ–¹æ³•è¿›å…¥æ¶ˆæ¯å¾ªç¯ä½“ï¼Œè¿›å…¥åå°±ä¼šä¸æ–­åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–å¹¶å¤„ç†æ¶ˆæ¯ã€‚</p><p>å½“ ActivityThread æ¥æ”¶åˆ° Ams å‘é€ start æŸä¸ª Activity çš„å¿«é€’åå°±ä¼šåˆ›å»ºæŒ‡å®šçš„ Activity å¯¹è±¡ã€‚Activity ä¼šå…ˆæŒ‰çª—æˆ·å†å»æŒ‰ç»ç’ƒå’Œè´´çª—èŠ±ï¼Œæ‰€ä»¥å…ˆåˆ›å»º PhoneWindow-&gt;DecorView-&gt; åˆ›å»ºç›¸åº”çš„ View æˆ– ViewGroupã€‚åˆ›å»ºå®Œæˆåå°±å¯ä»¥è®©å¤§å®¶æ¬£èµäº†ï¼Œè°ƒç”¨ WindowManager æŠŠç•Œé¢æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œç„¶ååˆ›å»º ViewRootï¼Œç„¶åè°ƒç”¨ Wms æä¾›çš„è¿œç¨‹æ¥å£æ·»åŠ ä¸€ä¸ªçª—å£å¹¶æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯ç”¨æˆ·çš„æ“ä½œï¼Œäº‹ä»¶çº¿ç¨‹ä¸æ–­çš„æŠŠæ¶ˆæ¯å¿«é€’å‘åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­å»ï¼Œç„¶åäº‹ä»¶åˆ†å‘çº¿ç¨‹ç§˜ä¹¦é€ä¸ªå–å‡ºæ¶ˆæ¯ï¼Œç„¶åè°ƒç”¨ Wms ä¸­çš„ç›¸åº”å‡½æ•°å¤„ç†è¯¥æ¶ˆæ¯ã€‚</p><p><strong><em>å¾ˆå¤šçº¿ç¨‹æ˜¯ä¸æ˜¯å¾ˆæ™•ï¼Ÿ</em></strong></p><ol><li>å®‰å“ç¨‹åºä¸­éƒ½æœ‰å“ªäº›çº¿ç¨‹ï¼Ÿ</li></ol><p>å®¢æˆ·ç«¯å°ä¼™ä¼´è‡³å°‘åŒ…å«ä¸‰ä¸ªçº¿ç¨‹å°å¼Ÿï¼ŒActivity å¯åŠ¨åä¼šåˆ›å»ºä¸€ä¸ª ViewRoot.W å¯¹è±¡ï¼ŒåŒæ—¶ ActivityThread ä¼šåˆ›å»ºä¸€ä¸ª ApplicationThread å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ç»§æ‰¿æ¶ˆæ¯æ€»ç®¡ Binderï¼Œæ¯ä¸ª Binder å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œè´Ÿè´£æ¥æ”¶ Linux Binder é©±åŠ¨å‘é€çš„ IPC è°ƒç”¨ã€‚è¿˜æœ‰ä¸€ä¸ªæ˜¯ UI çº¿ç¨‹å‘—ã€‚</p><ol start="2"><li>UI çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><p>ä¸€ç›´åœ¨å€¾å¬ç”¨æˆ·çš„å¿ƒå£°ï¼Œæ‰€æœ‰çš„å¤„ç†ç”¨æˆ·æ¶ˆæ¯ï¼Œä»¥åŠç»˜åˆ¶é¡µé¢çš„å·¥ä½œéƒ½åœ¨è¯¥çº¿ç¨‹ä¸­å®Œæˆã€‚</p><ol start="3"><li>è‡ªå®šä¹‰çš„çº¿ç¨‹å’Œ UI çº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li></ol><p>UI çº¿ç¨‹æ˜¯ä» ActivityThread è¿è¡Œçš„ï¼Œåœ¨è¯¥ç±»çš„ main() æ–¹æ³•ä¸­å·²ç»ä½¿ç”¨äº† Looper.prepareMainLooper() ä¸ºè¯¥çº¿ç¨‹æ·»åŠ äº† Looper å¯¹è±¡ï¼Œå·²ç»ä¸ºè¯¥çº¿ç¨‹åˆ›å»ºäº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ˜¯è‡ªå¸¦ç§˜ä¹¦å…‰ç¯çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ‰å¯ä»¥åœ¨ Activity ä¸­å»å®šä¹‰ Handler å¯¹è±¡ï¼Œå› ä¸ºåˆ›å»º Handler å¯¹è±¡æ—¶å…¶çº¿ç¨‹å¿…é¡»å·²ç»åˆ›å»ºäº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè£…å¸å·¥å¾—é…è¿è¾“å¸¦è¦ä¸ç„¶æ²¡æ³•å¹²æ´»ã€‚è€Œæ™®é€šçš„ Thread åˆ™æ²¡æœ‰é»˜è®¤åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥åœ¨ Thread ä¸­ç›´æ¥å®šä¹‰ Handlerï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ä¸æ‡‚ç¨‹åºè¿è¡ŒåŸç†å¯¼è‡´çš„å›°æƒ‘ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨å¼€å‘ä¸­æˆ‘ä»¬ä¼šé‡åˆ°å„ç§å„æ ·çš„éå¸¸å¥‡æ€ªçš„é—®é¢˜ï¼Œæœ‰äº›é—®é¢˜æ˜¯ç™¾æ€ä¸å¾—éª‘å§ã€‚å…¶å®è¿™äº›é—®é¢˜å¤§éƒ½æ˜¯å› ä¸ºæˆ‘ä»¬ä¸äº†è§£å®‰å“å†…éƒ¨è¿è¡ŒåŸç†ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶æ‰æ˜¯æˆ‘ä»¬çš„ç›®çš„ã€‚â€” &lt;code&gt;å‰è¨€&lt;/code&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://yangxiaoge.github.io/tags/Android/"/>
    
      <category term="Framework" scheme="https://yangxiaoge.github.io/tags/Framework/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•é€‰æ‹©å¼€æºè®¸å¯è¯ï¼Ÿ</title>
    <link href="https://yangxiaoge.github.io/2017/08/29/2017-08-29-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%BC%80%E6%BA%90%E8%AE%B8%E5%8F%AF%E8%AF%81%EF%BC%9F/"/>
    <id>https://yangxiaoge.github.io/2017/08/29/2017-08-29-å¦‚ä½•é€‰æ‹©å¼€æºè®¸å¯è¯ï¼Ÿ/</id>
    <published>2017-08-29T14:36:51.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œåº”å½“ç§‰æ‰¿å¼€æºç²¾ç¥ï¼Œéµå®ˆå¼€æºåè®®ï¼Œè¿™æ˜¯å¿…å¤‡çš„é“å¾·ä¿®å…»å’Œç´ è´¨ã€‚<br><a id="more"></a></p><blockquote><p>æœ¬æ–‡è½¬è‡ª <a href="http://www.ruanyifeng.com/" target="_blank" rel="noopener">é˜®ä¸€å³°</a> å¤§å¤§</p></blockquote><p>å¦‚ä½•ä¸ºä»£ç é€‰æ‹©å¼€æºè®¸å¯è¯ï¼Œè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚<br>ä¸–ç•Œä¸Šçš„å¼€æºè®¸å¯è¯ï¼Œå¤§æ¦‚æœ‰<a href="http://www.gnu.org/licenses/license-list.html" target="_blank" rel="noopener">ä¸Šç™¾ç§</a>ã€‚å¾ˆå°‘æœ‰äººæå¾—æ¸…æ¥šå®ƒä»¬çš„åŒºåˆ«ã€‚å³ä½¿åœ¨æœ€æµè¡Œçš„å…­ç§â€”â€“ <a href="http://www.gnu.org/licenses/gpl.html" target="_blank" rel="noopener">GPL</a>ã€<a href="http://en.wikipedia.org/wiki/BSD_licenses" target="_blank" rel="noopener">BSD</a>ã€<a href="http://en.wikipedia.org/wiki/MIT_License" target="_blank" rel="noopener">MIT</a>ã€<a href="http://www.mozilla.org/MPL/" target="_blank" rel="noopener">Mozilla</a>ã€<a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener">Apache</a> å’Œ <a href="http://www.gnu.org/copyleft/lesser.html" target="_blank" rel="noopener">LGPL</a>â€”-ä¹‹ä¸­åšé€‰æ‹©ï¼Œä¹Ÿå¾ˆå¤æ‚ã€‚<br>ä¹Œå…‹å…°ç¨‹åºå‘˜ <a href="http://pbagwl.com/post/5078147450/description-of-popular-software-licenses" target="_blank" rel="noopener">Paul Bagwell</a> ï¼Œç”»äº†ä¸€å¼ åˆ†æå›¾ï¼Œè¯´æ˜åº”è¯¥æ€ä¹ˆé€‰æ‹©ã€‚è¿™æ˜¯æˆ‘è§è¿‡çš„æœ€ç®€å•çš„è®²è§£ï¼Œåªç”¨ä¸¤åˆ†é’Ÿï¼Œä½ å°±èƒ½ææ¸…æ¥šè¿™å…­ç§è®¸å¯è¯ä¹‹é—´çš„æœ€å¤§åŒºåˆ«ã€‚<br>ä¸‹é¢æ˜¯æˆ‘åˆ¶ä½œçš„ä¸­æ–‡ç‰ˆï¼Œè¯·çœ‹å¤§å›¾ã€‚<br><img src="http://image.beekka.com/blog/201105/free_software_licenses.png" alt></p><p>æœ‰å…´è¶£è¯¦ç»†äº†è§£å¼€æºåè®®çš„å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.gcssloop.com/tips/choose-license" target="_blank" rel="noopener">ç¨‹åºå‘˜ä¸å¯ä¸çŸ¥çš„ç‰ˆæƒåè®®</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œåº”å½“ç§‰æ‰¿å¼€æºç²¾ç¥ï¼Œéµå®ˆå¼€æºåè®®ï¼Œè¿™æ˜¯å¿…å¤‡çš„é“å¾·ä¿®å…»å’Œç´ è´¨ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="é—²è°ˆ" scheme="https://yangxiaoge.github.io/tags/%E9%97%B2%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>Binderæºç åˆ†æ</title>
    <link href="https://yangxiaoge.github.io/2017/07/06/2017-07-06-Binder%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>https://yangxiaoge.github.io/2017/07/06/2017-07-06-Binderæºç åˆ†æ/</id>
    <published>2017-07-06T10:00:05.000Z</published>
    <updated>2017-11-22T14:55:51.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>forked from <a href="https://github.com/xdtianyu/SourceAnalysis" target="_blank" rel="noopener">xdtianyu/SourceAnalysis</a></p></blockquote><p>æœ¬æ–‡æ˜¯åŸºäº <a href="https://github.com/xdtianyu/android-6.0.0_r1" target="_blank" rel="noopener">Android 6.0.0</a> å’Œ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow" target="_blank" rel="noopener">kernel 3.4</a> æºç  åŠ Android SDK 23 å±•å¼€çš„ã€‚</p><p>å…ˆä¸Šä¸€å¼ å›¾ï¼Œç›´ç™½çš„äº†è§£ Binder é€šä¿¡è¿‡ç¨‹ã€‚(æ‘˜è‡ª<a href="http://mp.weixin.qq.com/s/YVvV3-RUjbqYo-DYY3E6nA" target="_blank" rel="noopener">è¶…è¯¦ç»† Android é¢è¯•çš„å‡†å¤‡ä¸ç»å†åˆ†äº« | ç™¾åº¦ (offer)</a>)</p><blockquote><p><img src="/assets/å­¦ä¹ èµ„æ–™/é¢è¯•å°æœ­/Binderé€šä¿¡è¿‡ç¨‹.png" alt></p></blockquote><a id="more"></a><p><strong>ç›®å½•</strong></p><ul><li><a href="#1-ç®€ä»‹">1. ç®€ä»‹</a></li><li><a href="#2-binder-ä¸-aidl">2. Binder ä¸ AIDL</a><ul><li><a href="#21-aidl-å®¢æˆ·ç«¯">2.1 AIDL å®¢æˆ·ç«¯</a></li><li><a href="#22-aidl-æœåŠ¡ç«¯">2.2 AIDL æœåŠ¡ç«¯</a></li><li><a href="#23-è¿œç¨‹æœåŠ¡çš„è·å–ä¸ä½¿ç”¨">2.3 è¿œç¨‹æœåŠ¡çš„è·å–ä¸ä½¿ç”¨</a></li></ul></li><li><a href="#3-binder-æ¡†æ¶åŠ-native-å±‚">3. Binder æ¡†æ¶åŠ Native å±‚</a><ul><li><a href="#31-binder-native-çš„å…¥å£">3.1 Binder Native çš„å…¥å£</a></li><li><a href="#32-binder-æœ¬åœ°å±‚çš„æ•´ä¸ªå‡½æ•°/æ–¹æ³•è°ƒç”¨è¿‡ç¨‹">3.2 Binder æœ¬åœ°å±‚çš„æ•´ä¸ªå‡½æ•°/æ–¹æ³•è°ƒç”¨è¿‡ç¨‹</a></li><li><a href="#33-binder-è®¾å¤‡æ–‡ä»¶çš„æ‰“å¼€å’Œè¯»å†™">3.3 Binder è®¾å¤‡æ–‡ä»¶çš„æ‰“å¼€å’Œè¯»å†™</a></li></ul></li><li><a href="#4-binder-é©±åŠ¨">4. Binder é©±åŠ¨</a><ul><li><a href="#41-binder-è®¾å¤‡çš„åˆ›å»º">4.1 binder è®¾å¤‡çš„åˆ›å»º</a></li><li><a href="#42-binder-åè®®å’Œæ•°æ®ç»“æ„">4.2 binder åè®®å’Œæ•°æ®ç»“æ„</a></li><li><a href="#43-binder-é©±åŠ¨æ–‡ä»¶æ“ä½œ">4.3 binder é©±åŠ¨æ–‡ä»¶æ“ä½œ</a></li></ul></li><li><a href="#5-binder-ä¸ç³»ç»ŸæœåŠ¡">5. Binder ä¸ç³»ç»ŸæœåŠ¡</a><ul><li><a href="#51-contextgetsystemservice">5.1 Context.getSystemService()</a></li><li><a href="#52-contextgetsystemservice-æºç åˆ†æ">5.2 Context.getSystemService() æºç åˆ†æ</a></li></ul></li><li><a href="#6-ç»“è®º">6. ç»“è®º</a></li><li><a href="#7-å‚è€ƒ">7. å‚è€ƒ</a></li></ul><h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h2><p>Binder æ˜¯ä¸€ç§ Android è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œæä¾›è¿œç¨‹è¿‡ç¨‹è°ƒç”¨(Remote Procedure Call)åŠŸèƒ½ã€‚æˆ‘ä»¬æœ€ç›´æ¥çš„ä½¿ç”¨æ˜¯è°ƒç”¨ <code>Context.getSystemService()</code> æ¥è·å–ç³»ç»ŸæœåŠ¡ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ <code>AIDL</code> æ¥å®ç°å¤šä¸ªç¨‹åº(APP)é—´æ•°æ®äº¤äº’ã€‚</p><p>Binder æ˜¯éå¸¸é‡è¦çš„ Android åŸºç¡€ç»„ä»¶ï¼Œå‡ ä¹æ‰€æœ‰çš„è¿›ç¨‹é—´é€šä¿¡éƒ½æ˜¯ä½¿ç”¨ Binder æœºåˆ¶å®ç°çš„ã€‚æœ¬æ–‡å°†ç»“åˆæºç å±•å¼€è®²è¿° Binder ï¼ŒåŒæ—¶å¯¹ä¸€äº›é‡è¦çŸ¥è¯†ç‚¹æä¾›æ‰©å±•é˜…è¯»çš„å‚è€ƒã€‚</p><p><img src="https://raw.githubusercontent.com/xdtianyu/SourceAnalysis/master/art/android_binder.png" alt="android_binder"></p><p>ä¸ç®¡æ˜¯ Android ç³»ç»ŸæœåŠ¡(System services)è¿˜æ˜¯ç”¨æˆ·çš„åº”ç”¨è¿›ç¨‹(User apps)ï¼Œæœ€ç»ˆéƒ½ä¼šé€šè¿‡ binder æ¥å®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚ä¸Šå±‚åº”ç”¨é¦–å…ˆé€šè¿‡ IBinder çš„ transcate æ–¹æ³•å‘é€å‘½ä»¤ç»™ libbinderï¼Œ libbinder å†é€šè¿‡ç³»ç»Ÿè°ƒç”¨(ioctl) å‘é€å‘½ä»¤åˆ°å†…æ ¸ä¸­çš„ binder é©±åŠ¨ï¼Œä¹‹åå†ç”±é©±åŠ¨å®Œæˆè¿›ç¨‹é—´æ•°æ®çš„äº¤äº’ã€‚</p><p>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ Intentï¼ŒMessager æ•°æ®ä¼ é€’ä¹Ÿæ˜¯å¯¹ Binder æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡å’Œå°è£…ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šç”±å†…æ ¸ä¸­çš„ binder é©±åŠ¨å®Œæˆæ•°æ®çš„ä¼ é€’ã€‚</p><h2 id="2-Binder-ä¸-AIDL"><a href="#2-Binder-ä¸-AIDL" class="headerlink" title="2. Binder ä¸ AIDL"></a>2. Binder ä¸ AIDL</h2><p>AIDL (Android Interface definition language) æ˜¯æ¥å£æè¿°è¯­è¨€ï¼Œç”¨äºç”Ÿæˆåœ¨ä¸¤ä¸ªè¿›ç¨‹é—´è¿›è¡Œé€šä¿¡çš„ä»£ç ã€‚å…ˆçœ‹ AIDL æ¦‚å¿µå›¾</p><p><img src="https://raw.githubusercontent.com/xdtianyu/SourceAnalysis/master/art/AIDL.png" alt="AIDLæ¦‚å¿µå›¾"></p><ul><li><p>Stub.Proxy å’Œ Stub ä»£ç ç”± Android Sdk è‡ªåŠ¨ç”Ÿæˆï¼Œå®¢æˆ·ç«¯é€šè¿‡ Stub.Proxy ä¸è¿œç¨‹æœåŠ¡äº¤äº’ã€‚</p></li><li><p>Stub åŒ…å«å¯¹ IBinder å¯¹è±¡æ“ä½œçš„å°è£…ï¼Œéœ€è¦è¿œç¨‹æœåŠ¡å®ç°å…·ä½“åŠŸèƒ½ã€‚</p></li></ul><p>æ¥ä¸‹æ¥å†çœ‹å…·ä½“å®ç°ï¼Œ å®Œæ•´æºä»£ç è§ <a href="https://github.com/xdtianyu/AidlExample" target="_blank" rel="noopener">AidlExample</a>ã€‚åœ¨è¿™ä¸ªå·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸¤ä¸ªåº”ç”¨ï¼Œ <code>app</code> æ˜¯å®¢æˆ·ç«¯ä»£ç ï¼Œ <code>remoteservice</code> åˆ™æ˜¯æœåŠ¡ç«¯ä»£ç ã€‚</p><h3 id="2-1-AIDL-å®¢æˆ·ç«¯"><a href="#2-1-AIDL-å®¢æˆ·ç«¯" class="headerlink" title="2.1 AIDL å®¢æˆ·ç«¯"></a>2.1 AIDL å®¢æˆ·ç«¯</h3><p>åœ¨ Android Studio é¡¹ç›®ä¸Šå³é”®ï¼Œ <code>New</code> -&gt; <code>AIDL</code> -&gt; <code>AIDL File</code> è¾“å…¥æ–‡ä»¶ååå¯ä»¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ª AIDL çš„ä»£ç ç»“æ„ã€‚ä¾‹å¦‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ª <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/src/main/aidl/org/xdty/remoteservice/IRemoteService.aidl" target="_blank" rel="noopener">IRemoteService.aidl</a> æ–‡ä»¶</p><pre><code class="java">// IRemoteService.aidlpackage com.android.aidltest;interface IRemoteService {    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,            double aDouble, String aString);}</code></pre><p>ä»ç”Ÿæˆçš„ç¤ºä¾‹ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒAIDL çš„è¯­æ³•ç±»ä¼¼ Javaï¼Œ <code>basicTypes()</code> æ–¹æ³•ä¼ é€’çš„å‚æ•°åªæ˜¯åŸºæœ¬ç±»å‹ã€‚</p><p>å¦‚æœè¦ä¼ é€’è‡ªå®šä¹‰ç±»å‹å¦‚ <a href="https://github.com/xdtianyu/AidlExample/blob/master/remoteservice/src/main/java/org/xdty/remoteservice/User.java#L6" target="_blank" rel="noopener">User</a>ï¼Œåˆ™éœ€è¦å®ç° <a href="http://developer.android.com/reference/android/os/Parcelable.html" target="_blank" rel="noopener">Parcelable</a> æ¥å£ã€‚<code>Parcelable</code> æ˜¯ä¸€ä¸ªä¸ Java <code>Serializable</code> ç±»ä¼¼çš„åºåˆ—åŒ–æ¥å£ã€‚ </p><p>è¿™æ ·ç±» <code>User</code> çš„å®ä¾‹å°±å¯ä»¥å‚¨å­˜åˆ° <a href="http://developer.android.com/reference/android/os/Parcel.html" target="_blank" rel="noopener">Parcel</a> ä¸­ï¼Œè€Œ <code>Parcel</code> åˆ™æ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡ <code>IBinder</code> å‘é€æ•°æ®æˆ–å¯¹è±¡å¼•ç”¨çš„å®¹å™¨ã€‚</p><pre><code class="java">// User.javapublic class User implements Parcelable {    private int uid;    private String name;    // ä» Parcel ä¸­è¯»å–æ•°æ®ï¼Œé¡ºåºéœ€è¦å’Œå†™å…¥ä¿æŒä¸€è‡´    protected User(Parcel in) {        uid = in.readInt();        name = in.readString();    }    // å¿…é¡»å®ç°ï¼Œç”¨äºä» Parcel å¯¹è±¡ä¸­ç”Ÿæˆç±»å®ä¾‹    public static final Creator&lt;User&gt; CREATOR = new Creator&lt;User&gt;() {        @Override        public User createFromParcel(Parcel in) {            return new User(in);        }        @Override        public User[] newArray(int size) {            return new User[size];        }    };    // å°†æ•°æ®å†™å…¥åˆ° Parcel ä¸­ï¼Œ é¡ºåºéœ€è¦ä¸è¯»å–ä¿æŒä¸€è‡´    @Override    public void writeToParcel(Parcel dest, int flags) {        dest.writeInt(uid);        dest.writeString(name);    }}</code></pre><p>å†å‘ <code>IRemoteService.aidl</code> ä¸­æ·»åŠ ä¸€ä¸ª <code>addUser()</code> æ–¹æ³•ï¼ŒåŒæ—¶æ–°å»ºä¸€ä¸ª <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/src/main/aidl/org/xdty/remoteservice/User.aidl" target="_blank" rel="noopener">User.aidl</a> æ–‡ä»¶ã€‚</p><pre><code class="java">// IRemoteService.aidlpackage com.android.aidltest;import com.android.aidltest.User;interface IRemoteService {    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,            double aDouble, String aString);    // in è¡¨ç¤ºä¼ å…¥æ•°æ®ï¼Œ out è¡¨ç¤ºä¼ å‡ºæ•°æ®ï¼Œ inout è¡¨ç¤ºåŒå‘ä¼ é€’ã€‚æ³¨æ„å«æœ‰ out æ—¶ User ç±»éœ€è¦å®ç° readFromParcel() æ–¹æ³•    void addUser(in User user);}// User.aidlpackage com.android.aidltest;parcelable User;</code></pre><p>è¿è¡Œç¼–è¯‘åï¼Œä¼šåœ¨ <code>generated</code> æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸€ä¸ª <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L92" target="_blank" rel="noopener">IRemoteService.java</a> æ¥å£æ–‡ä»¶ã€‚è¿™ä¸ªæ¥å£ä¸­æœ‰ä¸¤ä¸ªå†…éƒ¨ç±» <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L19" target="_blank" rel="noopener">Stub</a> å’Œ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L92" target="_blank" rel="noopener">Stub.Proxy</a>ã€‚æ³¨æ„å®¢æˆ·ç«¯ç”Ÿæˆçš„<code>IRemoteService.java</code> æ–‡ä»¶å’Œåœ¨åæ–‡æœåŠ¡ç«¯ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹æ˜¯ç›¸åŒçš„ã€‚</p><p>å®¢æˆ·ç«¯ä¼šä» <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L34" target="_blank" rel="noopener">Stub.asInterface()</a> å¾—åˆ° <code>IRemoteService (Stub.Proxy)</code> çš„å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å°±æ˜¯ä¸€ä¸ªé€šè¿‡ Binder ä¼ é€’å›æ¥çš„ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L93" target="_blank" rel="noopener">è¿œç¨‹å¯¹è±¡</a> çš„åŒ…è£…ã€‚è€ŒæœåŠ¡ç«¯åˆ™éœ€è¦å®ç° <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L15" target="_blank" rel="noopener">IRemoteService.addUser()</a> æ–¹æ³•ã€‚</p><pre><code class="java">// IRemoteService.javapublic static org.xdty.remoteservice.IRemoteService asInterface(android.os.IBinder obj) {    if ((obj == null)) {        return null;    }    android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);    if (((iin != null) &amp;&amp; (iin instanceof org.xdty.remoteservice.IRemoteService))) {        return ((org.xdty.remoteservice.IRemoteService) iin);    }    return new org.xdty.remoteservice.IRemoteService.Stub.Proxy(obj);}</code></pre><h3 id="2-2-AIDL-æœåŠ¡ç«¯"><a href="#2-2-AIDL-æœåŠ¡ç«¯" class="headerlink" title="2.2 AIDL æœåŠ¡ç«¯"></a>2.2 AIDL æœåŠ¡ç«¯</h3><p>ä¸ºäº†æ¼”ç¤ºè¿›ç¨‹é—´é€šä¿¡ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ¨¡å—ï¼ˆåº”ç”¨ï¼‰ <a href="https://github.com/xdtianyu/AidlExample/tree/master/remoteservice" target="_blank" rel="noopener">RemoteService</a> æ¥å®ç°åŠŸèƒ½ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯ç»‘å®šæœåŠ¡ã€‚</p><p>æŒ‰å®¢æˆ·ç«¯çš„ç»“æ„æ–°å»º <a href="https://github.com/xdtianyu/AidlExample/blob/master/remoteservice/src/main/aidl/org/xdty/remoteservice/IRemoteService.aidl" target="_blank" rel="noopener">IRemoteService.aidl</a> <a href="https://github.com/xdtianyu/AidlExample/blob/master/remoteservice/src/main/aidl/org/xdty/remoteservice/User.aidl" target="_blank" rel="noopener">User.aidl</a> <a href="https://github.com/xdtianyu/AidlExample/blob/master/remoteservice/src/main/java/org/xdty/remoteservice/User.java" target="_blank" rel="noopener">User.java</a> æ–‡ä»¶ï¼Œå¹¶æ‹·è´å†…å®¹ï¼Œæ³¨æ„å¦‚æœéœ€è¦è¯·ä¿®æ”¹åŒ…åã€‚</p><p>æ–°å»ºæœåŠ¡ <a href="https://github.com/xdtianyu/AidlExample/blob/master/remoteservice/src/main/java/org/xdty/remoteservice/RemoteService.java#L29" target="_blank" rel="noopener">RemoteService</a> ï¼Œè¦†ç›–(Override) <code>onBind()</code> æ–¹æ³•å¹¶è¿”å› <code>IRemoteService.Stub</code> å®ä¾‹ <a href="https://github.com/xdtianyu/AidlExample/blob/master/remoteservice/src/main/java/org/xdty/remoteservice/RemoteService.java#L11" target="_blank" rel="noopener">mBinder</a>ï¼š</p><pre><code class="java">// RemoteService.javapublic class RemoteService extends Service {    private static final String TAG = RemoteService.class.getSimpleName();    private IBinder mBinder = new IRemoteService.Stub() {        @Override        public void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,                double aDouble, String aString) throws RemoteException {            Log.d(TAG, &quot;basicTypes: &quot;);        }        @Override        public void addUser(User user) throws RemoteException {            Log.d(TAG, &quot;addUser: &quot; + user.name);        }    };    @Override    public IBinder onBind(Intent intent) {        return mBinder;    }}</code></pre><p>è¿™æ ·æœåŠ¡ç«¯å°±å®ç°äº† <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L15" target="_blank" rel="noopener">addUser()</a> æ–¹æ³•ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡è¿œç¨‹å¯¹è±¡è°ƒç”¨ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L135" target="_blank" rel="noopener">IRemoteService.Stub.Proxy.addUser()</a> æ—¶ï¼Œè¿œç¨‹å¯¹è±¡ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L147" target="_blank" rel="noopener">mRemote</a> å°±ä¼šé€šè¿‡ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L147" target="_blank" rel="noopener">transact()</a> å‘é€å‘½ä»¤ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å‘½ä»¤ååœ¨ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L76" target="_blank" rel="noopener">Stub.onTransact()</a> ä¸­è¯»å–æ•°æ®å¹¶æ‰§è¡Œ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L84" target="_blank" rel="noopener">addUser()</a> æ–¹æ³•ã€‚æ›´å¤šç»†èŠ‚æˆ‘ä»¬å°†åœ¨ <a href="#3-binder-%E6%A1%86%E6%9E%B6%E5%8F%8A-native-%E5%B1%82">3. Binder æ¡†æ¶åŠ Native å±‚</a> å°èŠ‚è®²è¿°ã€‚</p><pre><code class="java">// IRemoteService.java@Overridepublic boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply,        int flags) throws android.os.RemoteException {    switch (code) {        ...        case TRANSACTION_addUser: {            data.enforceInterface(DESCRIPTOR);            org.xdty.remoteservice.User _arg0;            if ((0 != data.readInt())) {                _arg0 = org.xdty.remoteservice.User.CREATOR.createFromParcel(data);            } else {                _arg0 = null;            }            this.addUser(_arg0);            reply.writeNoException();            return true;        }    }    return super.onTransact(code, data, reply, flags);}</code></pre><h3 id="2-3-è¿œç¨‹æœåŠ¡çš„è·å–ä¸ä½¿ç”¨"><a href="#2-3-è¿œç¨‹æœåŠ¡çš„è·å–ä¸ä½¿ç”¨" class="headerlink" title="2.3 è¿œç¨‹æœåŠ¡çš„è·å–ä¸ä½¿ç”¨"></a>2.3 è¿œç¨‹æœåŠ¡çš„è·å–ä¸ä½¿ç”¨</h3><p>å®¢æˆ·ç«¯è¦ä½¿ç”¨è¿œç¨‹æœåŠ¡ï¼Œéœ€è¦ç»‘å®šæœåŠ¡ (<a href="https://github.com/xdtianyu/AidlExample/blob/master/app/src/main/java/org/xdty/aidlexample/MainActivity.java#L45" target="_blank" rel="noopener">bindService</a>) å¹¶å»ºç«‹æœåŠ¡è¿æ¥ (<a href="https://github.com/xdtianyu/AidlExample/blob/master/app/src/main/java/org/xdty/aidlexample/MainActivity.java#L19" target="_blank" rel="noopener">ServiceConnection</a>)ã€‚</p><pre><code class="java">// MainActivity.javapublic class MainActivity extends AppCompatActivity {    private ServiceConnection mConnection = new ServiceConnection() {        @Override        public void onServiceConnected(ComponentName name, IBinder service) {            IRemoteService remoteService = IRemoteService.Stub.asInterface(service);            try {                remoteService.addUser(new User(1, &quot;neo&quot;));            } catch (RemoteException e) {                e.printStackTrace();            }        }        ...    };    ...    @Override    protected void onCreate(Bundle savedInstanceState) {        ...        Intent intent = new Intent().setComponent(new ComponentName(                &quot;org.xdty.remoteservice&quot;,                &quot;org.xdty.remoteservice.RemoteService&quot;));        bindService(intent, mConnection, Context.BIND_AUTO_CREATE);    }}</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå®¢æˆ·ç«¯é€šè¿‡ <code>binderService()</code> æ–¹æ³•ï¼Œè·å–è¿œç¨‹æœåŠ¡å¹¶åœ¨æœåŠ¡è¿æ¥ <code>ServiceConnection</code> ä¸­ <code>onServiceConnected()</code> å›è°ƒä¸­å¾—åˆ°äº† <code>IBinder service</code> å®ä¾‹ï¼Œ æœ€åé€šè¿‡ä¸Šæ–‡æåˆ°çš„ <code>IRemoteService.Stub.asInterface(service)</code> æ–¹æ³•å¾—åˆ°è¿œç¨‹æœåŠ¡ <code>IRemoteService</code> çš„å®ä¾‹ã€‚é€šè¿‡ <code>IRemoteService.addUser()</code> æ–¹æ³•æˆ‘ä»¬å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æ–¹æ³•ã€‚åœ¨æ¥çœ‹ <code>IRemoteService.addUser()</code> çš„å®ç°ï¼š</p><pre><code class="java">// IRemoteService.javapublic static org.xdty.remoteservice.IRemoteService asInterface(android.os.IBinder obj) {    ...    return new org.xdty.remoteservice.IRemoteService.Stub.Proxy(obj);}private static class Proxy implements org.xdty.remoteservice.IRemoteService {    private android.os.IBinder mRemote;    Proxy(android.os.IBinder remote) {        mRemote = remote;    }    @Override    public android.os.IBinder asBinder() {        return mRemote;    }    ...    @Override    public void addUser(org.xdty.remoteservice.User user)            throws android.os.RemoteException {        android.os.Parcel _data = android.os.Parcel.obtain();        android.os.Parcel _reply = android.os.Parcel.obtain();        try {            _data.writeInterfaceToken(DESCRIPTOR);            if ((user != null)) {                _data.writeInt(1);                user.writeToParcel(_data, 0);            } else {                _data.writeInt(0);            }            mRemote.transact(Stub.TRANSACTION_addUser, _data, _reply, 0);            _reply.readException();        } finally {            _reply.recycle();            _data.recycle();        }    }}</code></pre><p>å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯è°ƒç”¨ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/src/main/java/org/xdty/aidlexample/MainActivity.java#L25" target="_blank" rel="noopener">remoteService.addUser(new User(1, â€œneoâ€))</a> æ–¹æ³•å®é™…ä¸Šæ˜¯é€šè¿‡ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L147" target="_blank" rel="noopener">IBinder service</a> å®ä¾‹çš„ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L147" target="_blank" rel="noopener">transact()</a> æ–¹æ³•ï¼Œå‘é€äº†ä¸æœåŠ¡ç«¯çº¦å®šå¥½çš„å‘½ä»¤ <code>Stub.TRANSACTION_addUser</code>ï¼Œå¹¶å°†å‚æ•°æŒ‰æ ¼å¼æ‰“åŒ…è¿› <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L137" target="_blank" rel="noopener">Parcel</a> å¯¹è±¡ã€‚</p><p>æœåŠ¡ç«¯åˆ™åœ¨ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L51" target="_blank" rel="noopener">onTransact()</a> æ–¹æ³•ä¸­æ”¶åˆ°å‘½ä»¤åä¼šå¯¹å‘½ä»¤å’Œå‚æ•°é‡æ–°è§£æï¼š</p><pre><code class="java">// IRemoteService.javapublic boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply,        int flags) throws android.os.RemoteException {    switch (code) {        ...        case TRANSACTION_addUser: {            data.enforceInterface(DESCRIPTOR);            org.xdty.remoteservice.User _arg0;            if ((0 != data.readInt())) {                _arg0 = org.xdty.remoteservice.User.CREATOR.createFromParcel(data);            } else {                _arg0 = null;            }            this.addUser(_arg0);            reply.writeNoException();            return true;        }    }    return super.onTransact(code, data, reply, flags);}</code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨ <code>onTransact()</code> ä¸­ï¼Œæœ€ç»ˆ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L84" target="_blank" rel="noopener">this.addUser(_arg0)</a> è°ƒç”¨äº†ä¸Šæ–‡æåˆ°çš„æœåŠ¡ç«¯çš„å®ç° <a href="https://github.com/xdtianyu/AidlExample/blob/master/remoteservice/src/main/java/org/xdty/remoteservice/RemoteService.java#L19" target="_blank" rel="noopener">IRemoteService.Stub.addUser()</a> ã€‚</p><p>è¿œç¨‹ Binder å¯¹è±¡ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L42" target="_blank" rel="noopener">mRemote</a> æ˜¯ç”±å®¢æˆ·ç«¯ç»‘å®šæœåŠ¡æ—¶ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/src/main/java/org/xdty/aidlexample/MainActivity.java#L23" target="_blank" rel="noopener">onServiceConnected()</a> è¿”å›çš„ã€‚ç»§ç»­è¿½è¸ª <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/ContextImpl.java#L1283" target="_blank" rel="noopener">bindService()</a></p><pre><code class="java">// ContextImpl.java@Overridepublic boolean bindService(Intent service, ServiceConnection conn,        int flags) {    warnIfCallingFromSystemProcess();    return bindServiceCommon(service, conn, flags, Process.myUserHandle());}</code></pre><p>å¯ä»¥çœ‹åˆ°æœ€åæ˜¯é€šè¿‡ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/ContextImpl.java#L1317#L1320" target="_blank" rel="noopener">ActivityManagerNative.getDefault().bindService()</a> æ¥ç»‘å®šæœåŠ¡</p><pre><code class="java">// bindServiceCommon()int res = ActivityManagerNative.getDefault().bindService(    mMainThread.getApplicationThread(), getActivityToken(), service,    service.resolveTypeIfNeeded(getContentResolver()),    sd, flags, getOpPackageName(), user.getIdentifier());// ActivityManagerNative.getDefault().bindService()public int bindService(IApplicationThread caller, IBinder token,        Intent service, String resolvedType, IServiceConnection connection,        int flags,  String callingPackage, int userId) throws RemoteException {    ...    data.writeStrongBinder(connection.asBinder());    ...    mRemote.transact(BIND_SERVICE_TRANSACTION, data, reply, 0);    ...}</code></pre><p>è¿½è¸ªåˆ° <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/ActivityManagerNative.java#L3740" target="_blank" rel="noopener">ActivityManagerNative.getDefault().bindService()</a> ï¼Œå¯ä»¥å‘ç° <code>ActivityManager</code> å’Œ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/ActivityManagerNative.java#L3750" target="_blank" rel="noopener">IServiceConnection</a>ä¹Ÿæ˜¯ä¸€ä¸ª <code>AIDL</code> å®ç°ã€‚é€šè¿‡å®ƒçš„ <code>ActivityManagerProxy.bindService()</code> å°†ç»‘å®šè¯·æ±‚å‘é€ç»™æœ¬åœ°å±‚ã€‚</p><p>å†ä» <code>onServiceConnected()</code> å›è°ƒè¿½è¸ªï¼Œ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/LoadedApk.java#L1223" target="_blank" rel="noopener">onServiceConnected()</a> æ˜¯ç”± <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/LoadedApk.java#L1175" target="_blank" rel="noopener">LoadedApk.ServiceDispatcher.doConnected()</a> å›è°ƒçš„ã€‚</p><p><em>å…³äºæ›´å¤šçš„ <code>bindService()</code> è¿œç¨‹æœåŠ¡åˆ›å»ºåŠ <code>ServiceConnection</code> å›è°ƒï¼Œ è¯·å‚è€ƒ <a href="http://blog.csdn.net/luoshengyang/article/details/6745181" target="_blank" rel="noopener">Androidåº”ç”¨ç¨‹åºç»‘å®šæœåŠ¡ï¼ˆbindServiceï¼‰çš„è¿‡ç¨‹æºä»£ç åˆ†æ</a></em></p><p><em>åˆ©ç”¨è¿›ç¨‹é—´é€šä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ç®€å•çš„åº”ç”¨æ’ä»¶åŠŸèƒ½ã€‚å…³äº AIDL åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨ï¼Œå¯ä»¥å‚è€ƒ <a href="https://github.com/xdtianyu/CallerInfo/tree/master/plugin/src/main" target="_blank" rel="noopener">CallerInfo Plugin</a> çš„å®ç° </em></p><p>ä»ä¸Šé¢åˆ†æå¯ä»¥çœ‹å‡ºï¼Œ AIDL çš„æœ¬è´¨æ˜¯å¯¹ Binder çš„åˆä¸€æ¬¡æŠ½è±¡å’Œå°è£…ï¼Œå®é™…çš„è¿›ç¨‹é—´é€šä¿¡ä»æ˜¯ç”± Binder å®Œæˆçš„ã€‚</p><h2 id="3-Binder-æ¡†æ¶åŠ-Native-å±‚"><a href="#3-Binder-æ¡†æ¶åŠ-Native-å±‚" class="headerlink" title="3. Binder æ¡†æ¶åŠ Native å±‚"></a>3. Binder æ¡†æ¶åŠ Native å±‚</h2><p>Binderæœºåˆ¶ä½¿æœ¬åœ°å¯¹è±¡å¯ä»¥åƒæ“ä½œå½“å‰å¯¹è±¡ä¸€æ ·è°ƒç”¨è¿œç¨‹å¯¹è±¡ï¼Œå¯ä»¥ä½¿ä¸åŒçš„è¿›ç¨‹é—´äº’ç›¸é€šä¿¡ã€‚Binder ä½¿ç”¨ Client/Server æ¶æ„ï¼Œå®¢æˆ·ç«¯é€šè¿‡æœåŠ¡ç«¯ä»£ç†ï¼Œç»è¿‡ Binder é©±åŠ¨ä¸æœåŠ¡ç«¯äº¤äº’ã€‚</p><p><img src="https://raw.githubusercontent.com/xdtianyu/SourceAnalysis/master/art/Binder.png" alt="Binderæ¡†æ¶å›¾ç‰‡"></p><p>Binder æœºåˆ¶å®ç°è¿›ç¨‹é—´é€šä¿¡çš„å¥¥ç§˜åœ¨äº kernel ä¸­çš„ Binder é©±åŠ¨ï¼Œå°†åœ¨ <a href="#4-binder-%E9%A9%B1%E5%8A%A8">4. Binder é©±åŠ¨</a> å°èŠ‚è¯¦ç»†è®²è¿°ã€‚</p><p><img src="https://raw.githubusercontent.com/xdtianyu/SourceAnalysis/master/art/binder_native.png" alt="Binderæœ¬åœ°æ¡†æ¶å›¾ç‰‡"></p><p>JNI çš„ä»£ç ä½äº <a href="https://github.com/xdtianyu/android-6.0.0_r1/tree/master/frameworks/base/core/jni" target="_blank" rel="noopener">frameworks/base/core/jni</a> ç›®å½•ä¸‹ï¼Œä¸»è¦æ˜¯ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.cpp" target="_blank" rel="noopener">android_util_Binder.cpp</a> æ–‡ä»¶å’Œå¤´æ–‡ä»¶ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.h" target="_blank" rel="noopener">android_util_Binder.h</a></p><p>Binder JNI ä»£ç æ˜¯ Binder Java å±‚æ“ä½œåˆ° Binder Native å±‚çš„æ¥å£å°è£…ï¼Œæœ€åä¼šè¢«ç¼–è¯‘è¿› <code>libandroid_runtime.so</code> ç³»ç»Ÿåº“ã€‚</p><p>Binder æœ¬åœ°å±‚çš„ä»£ç åœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/tree/master/frameworks/native/libs/binder" target="_blank" rel="noopener">frameworks/native/libs/binder</a> ç›®å½•ä¸‹ï¼Œ æ­¤ç›®å½•åœ¨ Android ç³»ç»Ÿç¼–è¯‘åä¼šç”Ÿæˆ <code>libbinder.so</code> æ–‡ä»¶ï¼Œä¾› JNI è°ƒç”¨ã€‚<code>libbinder</code> å°è£…äº†æ‰€æœ‰å¯¹ binder é©±åŠ¨çš„æ“ä½œï¼Œæ˜¯ä¸Šå±‚åº”ç”¨ä¸é©±åŠ¨äº¤äº’çš„æ¡¥æ¢ã€‚å¤´æ–‡ä»¶åˆ™åœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/tree/master/frameworks/native/include/binder" target="_blank" rel="noopener">frameworks/native/include/binder</a> ç›®å½•ä¸‹ã€‚</p><h3 id="3-1-Binder-Native-çš„å…¥å£"><a href="#3-1-Binder-Native-çš„å…¥å£" class="headerlink" title="3.1 Binder Native çš„å…¥å£"></a>3.1 Binder Native çš„å…¥å£</h3><p><a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IInterface.cpp#L33" target="_blank" rel="noopener">IInterface.cpp</a> æ˜¯ Binder æœ¬åœ°å±‚å…¥å£ï¼Œä¸ java å±‚çš„ <code>android.os.IInterface</code> å¯¹åº”ï¼Œæä¾› <code>asBinder()</code> çš„å®ç°ï¼Œè¿”å› <code>IBinder</code> å¯¹è±¡ã€‚</p><p>åœ¨å¤´æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªç±» <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/include/binder/IInterface.h#L50" target="_blank" rel="noopener">BnInterface (Binder Native Interface)</a> å’Œ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/include/binder/IInterface.h#L63" target="_blank" rel="noopener">BpInterface (Binder Proxy Interface)</a>, å¯¹åº”äº java å±‚çš„ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L19" target="_blank" rel="noopener">Stub</a> å’Œ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L92" target="_blank" rel="noopener">Proxy</a></p><pre><code class="c++">sp&lt;IBinder&gt; IInterface::asBinder(const IInterface* iface){    if (iface == NULL) return NULL;    return const_cast&lt;IInterface*&gt;(iface)-&gt;onAsBinder();}</code></pre><pre><code class="c++">template&lt;typename INTERFACE&gt;class BnInterface : public INTERFACE, public BBinder{public:    virtual sp&lt;IInterface&gt;      queryLocalInterface(const String16&amp; _descriptor);    virtual const String16&amp;     getInterfaceDescriptor() const;protected:    virtual IBinder*            onAsBinder();};// ----------------------------------------------------------------------template&lt;typename INTERFACE&gt;class BpInterface : public INTERFACE, public BpRefBase{public:                                BpInterface(const sp&lt;IBinder&gt;&amp; remote);protected:    virtual IBinder*            onAsBinder();};</code></pre><p>å…¶ä¸­ <code>BnInterface</code> æ˜¯å®ç°StubåŠŸèƒ½çš„æ¨¡æ¿ï¼Œæ‰©å±•BBinderçš„onTransact()æ–¹æ³•å®ç°Binderå‘½ä»¤çš„è§£æå’Œæ‰§è¡Œã€‚<code>BpInterface</code> æ˜¯å®ç°ProxyåŠŸèƒ½çš„æ¨¡æ¿ï¼ŒBpRefBaseé‡Œæœ‰ä¸ªmRemoteå¯¹è±¡æŒ‡å‘ä¸€ä¸ªBpBinderå¯¹è±¡ã€‚</p><h3 id="3-2-Binder-æœ¬åœ°å±‚çš„æ•´ä¸ªå‡½æ•°-æ–¹æ³•è°ƒç”¨è¿‡ç¨‹"><a href="#3-2-Binder-æœ¬åœ°å±‚çš„æ•´ä¸ªå‡½æ•°-æ–¹æ³•è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="3.2 Binder æœ¬åœ°å±‚çš„æ•´ä¸ªå‡½æ•°/æ–¹æ³•è°ƒç”¨è¿‡ç¨‹"></a>3.2 Binder æœ¬åœ°å±‚çš„æ•´ä¸ªå‡½æ•°/æ–¹æ³•è°ƒç”¨è¿‡ç¨‹</h3><p><img src="https://raw.githubusercontent.com/xdtianyu/SourceAnalysis/master/art/binder_native_stack.png" alt="Binderæœ¬åœ°å‡½æ•°è°ƒç”¨å›¾"></p><p>1. Java å±‚ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L147" target="_blank" rel="noopener">IRemoteService.Stub.Proxy</a> è°ƒç”¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/os/Binder.java#L501" target="_blank" rel="noopener">android.os.IBinder (å®ç°åœ¨ android.os.Binder.BinderProxy)</a> çš„ <code>transact()</code> å‘é€ <code>Stub.TRANSACTION_addUser</code> å‘½ä»¤ã€‚</p><p>2. ç”± <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/os/Binder.java#L507" target="_blank" rel="noopener">BinderProxy.transact()</a> è¿›å…¥ native å±‚ã€‚</p><p>3. ç”± <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.cpp#L1246" target="_blank" rel="noopener">jni</a> è½¬åˆ° <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.cpp#L1246" target="_blank" rel="noopener">android_os_BinderProxy_transact()</a> å‡½æ•°ã€‚</p><p>4. è°ƒç”¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.cpp#L1124" target="_blank" rel="noopener">IBinder-&gt;transact</a> å‡½æ•°ã€‚</p><pre><code class="c++">static jboolean android_os_BinderProxy_transact(JNIEnv* env, jobject obj,        jint code, jobject dataObj, jobject replyObj, jint flags) // throws RemoteException{    IBinder* target = (IBinder*)        env-&gt;GetLongField(obj, gBinderProxyOffsets.mObject);    status_t err = target-&gt;transact(code, *data, reply, flags);}</code></pre><p>è€Œ <code>gBinderProxyOffsets.mObject</code> åˆ™æ˜¯åœ¨ java å±‚è°ƒç”¨ <code>IBinder.getContextObject()</code> æ—¶åœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.cpp#L580" target="_blank" rel="noopener">javaObjectForIBinder</a> å‡½æ•°ä¸­è®¾ç½®çš„</p><pre><code class="c++">static jobject android_os_BinderInternal_getContextObject(JNIEnv* env, jobject clazz){    sp&lt;IBinder&gt; b = ProcessState::self()-&gt;getContextObject(NULL);    return javaObjectForIBinder(env, b);}jobject javaObjectForIBinder(JNIEnv* env, const sp&lt;IBinder&gt;&amp; val){    ...    LOGDEATH(&quot;objectForBinder %p: created new proxy %p !\n&quot;, val.get(), object);    // The proxy holds a reference to the native object.    env-&gt;SetLongField(object, gBinderProxyOffsets.mObject, (jlong)val.get());    val-&gt;incStrong((void*)javaObjectForIBinder);    ...}</code></pre><p>ç»è¿‡ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/ProcessState.cpp#L85" target="_blank" rel="noopener">ProcessState::getContextObject()</a> å’Œ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/ProcessState.cpp#L220" target="_blank" rel="noopener">ProcessState::getStrongProxyForHandle()</a></p><pre><code class="c++">sp&lt;IBinder&gt; ProcessState::getContextObject(const sp&lt;IBinder&gt;&amp; /*caller*/){    return getStrongProxyForHandle(0);}sp&lt;IBinder&gt; ProcessState::getStrongProxyForHandle(int32_t handle){    sp&lt;IBinder&gt; result;    ...    b = new BpBinder(handle);     result = b;    ...    return result;}</code></pre><p>å¯è§ <a href>android_os_BinderProxy_transact()</a> å‡½æ•°å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/BpBinder.cpp#L159" target="_blank" rel="noopener">BpBinder::transact()</a> å‡½æ•°ã€‚</p><p>5. <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/BpBinder.cpp#L164" target="_blank" rel="noopener">BpBinder::transact()</a> åˆ™åˆè°ƒç”¨äº† <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L548" target="_blank" rel="noopener">IPCThreadState::self()-&gt;transact()</a> å‡½æ•°ã€‚</p><pre><code class="c++">status_t IPCThreadState::transact(int32_t handle,                                  uint32_t code, const Parcel&amp; data,                                  Parcel* reply, uint32_t flags){    status_t err = data.errorCheck();    flags |= TF_ACCEPT_FDS;    if (err == NO_ERROR) {        LOG_ONEWAY(&quot;&gt;&gt;&gt;&gt; SEND from pid %d uid %d %s&quot;, getpid(), getuid(),            (flags &amp; TF_ONE_WAY) == 0 ? &quot;READ REPLY&quot; : &quot;ONE WAY&quot;);        err = writeTransactionData(BC_TRANSACTION, flags, handle, code, data, NULL);    }    if ((flags &amp; TF_ONE_WAY) == 0) {        if (reply) {            err = waitForResponse(reply);        } else {            Parcel fakeReply;            err = waitForResponse(&amp;fakeReply);        }    } else {        err = waitForResponse(NULL, NULL);    }    return err;}status_t IPCThreadState::writeTransactionData(int32_t cmd, uint32_t binderFlags,    int32_t handle, uint32_t code, const Parcel&amp; data, status_t* statusBuffer){    binder_transaction_data tr;    tr.target.ptr = 0; /* Don&#39;t pass uninitialized stack data to a remote process */    tr.target.handle = handle;    tr.code = code;    ...    mOut.writeInt32(cmd);    mOut.write(&amp;tr, sizeof(tr));    return NO_ERROR;}</code></pre><p>ç”±å‡½æ•°å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œ æ•°æ®å†ä¸€æ¬¡é€šè¿‡ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L904" target="_blank" rel="noopener">writeTransactionData()</a> ä¼ é€’ç»™ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L934" target="_blank" rel="noopener">mOut</a> è¿›è¡Œå†™å…¥æ“ä½œã€‚ <code>mOut</code> æ˜¯ä¸€ä¸ª Parcel å¯¹è±¡ï¼Œ å£°æ˜åœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/include/binder/IPCThreadState.h#L123" target="_blank" rel="noopener">IPCThreadState.h</a> æ–‡ä»¶ä¸­ã€‚ä¹‹ååˆ™è°ƒç”¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L583" target="_blank" rel="noopener">waitForResponse()</a> å‡½æ•°ã€‚</p><p>6. <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L712" target="_blank" rel="noopener">IPCThreadState::waitForResponse()</a> åœ¨ä¸€ä¸ª <code>while</code> å¾ªç¯é‡Œä¸æ–­çš„è°ƒç”¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L803" target="_blank" rel="noopener">talkWithDriver()</a> å¹¶æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®è¿”å›ã€‚</p><pre><code class="c++">status_t IPCThreadState::waitForResponse(Parcel *reply, status_t *acquireResult){    uint32_t cmd;    int32_t err;    while (1) {        if ((err=talkWithDriver()) &lt; NO_ERROR) break;        ...        cmd = (uint32_t)mIn.readInt32();        switch (cmd) {        case BR_TRANSACTION_COMPLETE:            ...        case BR_REPLY:            {                binder_transaction_data tr;                err = mIn.read(&amp;tr, sizeof(tr));                ALOG_ASSERT(err == NO_ERROR, &quot;Not enough command data for brREPLY&quot;);                if (err != NO_ERROR) goto finish;                if (reply) {                    if ((tr.flags &amp; TF_STATUS_CODE) == 0) {                        reply-&gt;ipcSetDataReference(                            reinterpret_cast&lt;const uint8_t*&gt;(tr.data.ptr.buffer),                            tr.data_size,                            reinterpret_cast&lt;const binder_size_t*&gt;(tr.data.ptr.offsets),                            tr.offsets_size/sizeof(binder_size_t),                            freeBuffer, this);                    } else {                        err = *reinterpret_cast&lt;const status_t*&gt;(tr.data.ptr.buffer);                        freeBuffer(NULL,                            reinterpret_cast&lt;const uint8_t*&gt;(tr.data.ptr.buffer),                            tr.data_size,                            reinterpret_cast&lt;const binder_size_t*&gt;(tr.data.ptr.offsets),                            tr.offsets_size/sizeof(binder_size_t), this);                    }                } else {                    freeBuffer(NULL,                        reinterpret_cast&lt;const uint8_t*&gt;(tr.data.ptr.buffer),                        tr.data_size,                        reinterpret_cast&lt;const binder_size_t*&gt;(tr.data.ptr.offsets),                        tr.offsets_size/sizeof(binder_size_t), this);                    continue;                }            }            goto finish;        }        default:            err = executeCommand(cmd);            if (err != NO_ERROR) goto finish;            break;        }    }    ...}</code></pre><p>7. <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L803" target="_blank" rel="noopener">IPCThreadState::talkWithDriver()</a> å‡½æ•°æ˜¯çœŸæ­£ä¸ binder é©±åŠ¨äº¤äº’çš„å®ç°ã€‚<a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L856" target="_blank" rel="noopener">ioctl(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr)</a> å°±æ˜¯ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨å‡½æ•° <code>ioctl</code> å‘ binder è®¾å¤‡æ–‡ä»¶ <code>/dev/binder</code> å‘é€ <code>BINDER_WRITE_READ</code> å‘½ä»¤ã€‚</p><pre><code class="c++">status_t IPCThreadState::talkWithDriver(bool doReceive){    if (mProcess-&gt;mDriverFD &lt;= 0) {        return -EBADF;    }    binder_write_read bwr;    // Is the read buffer empty?    const bool needRead = mIn.dataPosition() &gt;= mIn.dataSize();    // We don&#39;t want to write anything if we are still reading    // from data left in the input buffer and the caller    // has requested to read the next data.    const size_t outAvail = (!doReceive || needRead) ? mOut.dataSize() : 0;    bwr.write_size = outAvail;    bwr.write_buffer = (uintptr_t)mOut.data();    // This is what we&#39;ll read.    if (doReceive &amp;&amp; needRead) {        bwr.read_size = mIn.dataCapacity();        bwr.read_buffer = (uintptr_t)mIn.data();    } else {        bwr.read_size = 0;        bwr.read_buffer = 0;    }    // Return immediately if there is nothing to do.    if ((bwr.write_size == 0) &amp;&amp; (bwr.read_size == 0)) return NO_ERROR;    bwr.write_consumed = 0;    bwr.read_consumed = 0;    status_t err;#if defined(HAVE_ANDROID_OS)        // ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ ioctl å‘ /dev/binder å‘é€ BINDER_WRITE_READ å‘½ä»¤        if (ioctl(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr) &gt;= 0)            err = NO_ERROR;        else            err = -errno;#else        err = INVALID_OPERATION;#endif    do {        if (mProcess-&gt;mDriverFD &lt;= 0) {            err = -EBADF;        }    } while (err == -EINTR);    if (err &gt;= NO_ERROR) {        if (bwr.write_consumed &gt; 0) {            if (bwr.write_consumed &lt; mOut.dataSize())                mOut.remove(0, bwr.write_consumed);            else                mOut.setDataSize(0);        }        if (bwr.read_consumed &gt; 0) {            mIn.setDataSize(bwr.read_consumed);            mIn.setDataPosition(0);        }        return NO_ERROR;    }    return err;}</code></pre><p>ç»è¿‡ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L718" target="_blank" rel="noopener">IPCThreadState::talkWithDriver()</a> ,å°±å°†æ•°æ®å‘é€ç»™äº† Binder é©±åŠ¨ã€‚</p><p>ç»§ç»­è¿½è¸ª <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L723" target="_blank" rel="noopener">IPCThreadState::waitForResponse()</a> ï¼Œå¯ä»¥ä» ç¬¬6æ­¥ å‘ç° <code>IPCThreadState</code> ä¸æ–­çš„å¾ªç¯è¯»å– Binder é©±åŠ¨è¿”å›ï¼Œè·å–åˆ°è¿”å›å‘½ä»¤åæ‰§è¡Œäº† <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L787" target="_blank" rel="noopener">executeCommand(cmd)</a> å‡½æ•°ã€‚</p><p>8. <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L947" target="_blank" rel="noopener">IPCThreadState::executeCommand()</a> å¤„ç† Binder é©±åŠ¨è¿”å›å‘½ä»¤</p><pre><code class="c++">status_t IPCThreadState::executeCommand(int32_t cmd){    BBinder* obj;    RefBase::weakref_type* refs;    status_t result = NO_ERROR;    switch ((uint32_t)cmd) {    ...    case BR_TRANSACTION:        {            binder_transaction_data tr;            result = mIn.read(&amp;tr, sizeof(tr));            ...            Parcel buffer;            buffer.ipcSetDataReference(                reinterpret_cast&lt;const uint8_t*&gt;(tr.data.ptr.buffer),                tr.data_size,                reinterpret_cast&lt;const binder_size_t*&gt;(tr.data.ptr.offsets),                tr.offsets_size/sizeof(binder_size_t), freeBuffer, this);            ...            Parcel reply;            status_t error;            if (tr.target.ptr) {                sp&lt;BBinder&gt; b((BBinder*)tr.cookie);                error = b-&gt;transact(tr.code, buffer, &amp;reply, tr.flags);            } else {                error = the_context_object-&gt;transact(tr.code, buffer, &amp;reply, tr.flags);            }            ...        }        break;    ...}</code></pre><p>9. å¯ä»¥çœ‹å‡ºå…¶è°ƒç”¨äº† <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L1085#L1091" target="_blank" rel="noopener">BBinder::transact()</a> å‡½æ•°ï¼Œå°†æ•°æ®è¿”å›ç»™ä¸Šå±‚ã€‚</p><pre><code class="c++">status_t BBinder::transact(    uint32_t code, const Parcel&amp; data, Parcel* reply, uint32_t flags){    data.setDataPosition(0);    status_t err = NO_ERROR;    switch (code) {        case PING_TRANSACTION:            reply-&gt;writeInt32(pingBinder());            break;        default:            err = onTransact(code, data, reply, flags);            break;    }    if (reply != NULL) {        reply-&gt;setDataPosition(0);    }    return err;}</code></pre><p>10. è€Œè¿™é‡Œçš„ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L1085#L1091" target="_blank" rel="noopener">b-&gt;transact(tr.code, buffer, &amp;reply, tr.flags)</a> ä¸­çš„ <code>b (BBinder)</code> æ˜¯ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.cpp#L217" target="_blank" rel="noopener">JavaBBinder</a> çš„å®ä¾‹ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.cpp#L247" target="_blank" rel="noopener">JavaBBinder::onTransact()</a> å‡½æ•°</p><pre><code class="c++">// frameworks/base/core/jni/android_util_Binder.cppvirtual status_t onTransact(        uint32_t code, const Parcel&amp; data, Parcel* reply, uint32_t flags = 0)    {        JNIEnv* env = javavm_to_jnienv(mVM);        ...        jboolean res = env-&gt;CallBooleanMethod(mObject, gBinderOffsets.mExecTransact,            code, reinterpret_cast&lt;jlong&gt;(&amp;data), reinterpret_cast&lt;jlong&gt;(reply), flags);    }static int int_register_android_os_Binder(JNIEnv* env){    ...    gBinderOffsets.mExecTransact = GetMethodIDOrDie(env, clazz, &quot;execTransact&quot;, &quot;(IJJI)Z&quot;);    ...}</code></pre><p>11. å¯è§ JNI é€šè¿‡ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.cpp#L260" target="_blank" rel="noopener">gBinderOffsets.mExecTransact</a> æœ€åæ‰§è¡Œäº† <code>android.os.Binder</code> çš„ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/jni/android_util_Binder.cpp#L865" target="_blank" rel="noopener">execTransact()</a> æ–¹æ³•ã€‚</p><p><a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/os/Binder.java#L442" target="_blank" rel="noopener">execTransact()</a> æ–¹æ³•æ˜¯ jni å›è°ƒçš„å…¥å£ã€‚</p><pre><code class="java">// Entry point from android_util_Binder.cpp&#39;s onTransact    private boolean execTransact(int code, long dataObj, long replyObj,            int flags) {        Parcel data = Parcel.obtain(dataObj);        Parcel reply = Parcel.obtain(replyObj);        ...        try {            res = onTransact(code, data, reply, flags);        }         ...    }</code></pre><p>12. è€Œæˆ‘ä»¬åˆ™åœ¨æœåŠ¡ç«¯ <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L19" target="_blank" rel="noopener">IRemoteService.Stub</a> é‡è½½äº† <a href="https://github.com/xdtianyu/AidlExample/blob/master/app/build/generated/source/aidl/debug/org/xdty/remoteservice/IRemoteService.java#L51" target="_blank" rel="noopener">onTransact()</a> æ–¹æ³•ï¼Œæ‰€ä»¥æ•°æ®æœ€åä¼šå›åˆ°æˆ‘ä»¬çš„æœåŠ¡ç«¯å¹¶æ‰§è¡ŒæœåŠ¡ç«¯å®ç°çš„ <code>addUser()</code> æ–¹æ³•ã€‚</p><pre><code class="java">public static abstract class Stub extends android.os.Binder        implements org.xdty.remoteservice.IRemoteService {    ...    @Override    public boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply,            int flags) throws android.os.RemoteException {        switch (code) {            case INTERFACE_TRANSACTION: {                reply.writeString(DESCRIPTOR);                return true;            }            case TRANSACTION_basicTypes: {                ...                return true;            }            case TRANSACTION_addUser: {                data.enforceInterface(DESCRIPTOR);                org.xdty.remoteservice.User _arg0;                if ((0 != data.readInt())) {                    _arg0 = org.xdty.remoteservice.User.CREATOR.createFromParcel(data);                } else {                    _arg0 = null;                }                this.addUser(_arg0);                reply.writeNoException();                return true;            }        }        return super.onTransact(code, data, reply, flags);    }}</code></pre><p>ä¸Šè¿°è¿‡ç¨‹å°±æ˜¯æ‰€æœ‰çš„ Native å±‚å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è°ƒç”¨è¿‡ç¨‹ï¼Œæ€»ç»“ä¸‹æ¥å°±æ˜¯ å®¢æˆ·ç«¯è¿›ç¨‹å‘é€ <code>BC_TRANSACTION</code> åˆ° Binder é©±åŠ¨ï¼ŒæœåŠ¡ç«¯è¿›ç¨‹ç›‘å¬è¿”å›çš„ <code>BR_TRANSACTION</code> å‘½ä»¤å¹¶å¤„ç†ã€‚å¦‚æœæ˜¯æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®ï¼Œç±»ä¼¼çš„æ˜¯æœåŠ¡ç«¯å‘é€ <code>BC_REPLY</code> å‘½ä»¤ï¼Œ å®¢æˆ·ç«¯ç›‘å¬ <code>BR_REPLY</code> å‘½ä»¤ã€‚</p><h3 id="3-3-Binder-è®¾å¤‡æ–‡ä»¶çš„æ‰“å¼€å’Œè¯»å†™"><a href="#3-3-Binder-è®¾å¤‡æ–‡ä»¶çš„æ‰“å¼€å’Œè¯»å†™" class="headerlink" title="3.3 Binder è®¾å¤‡æ–‡ä»¶çš„æ‰“å¼€å’Œè¯»å†™"></a>3.3 Binder è®¾å¤‡æ–‡ä»¶çš„æ‰“å¼€å’Œè¯»å†™</h3><p><strong>1. è®¾å¤‡çš„æ‰“å¼€</strong></p><p>åœ¨ä¸Šä¸€å°èŠ‚ä¸­æˆ‘ä»¬çœ‹åˆ° JNI è¿‡ç¨‹ä¸­è°ƒç”¨äº† <code>ProcessState::getContextObject()</code> å‡½æ•°ï¼Œ åœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/ProcessState.cpp#L340" target="_blank" rel="noopener">ProcessState</a> åˆå§‹åŒ–æ—¶ä¼šæ‰“å¼€ binder è®¾å¤‡</p><pre><code class="c++">// ProcessState.cppProcessState::ProcessState()    : mDriverFD(open_driver())    ...{    ...}</code></pre><p><a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/ProcessState.cpp#L311#L337" target="_blank" rel="noopener">open_driver()</a> å‡½æ•°å†…å®¹å¦‚ä¸‹</p><pre><code class="c++">// ProcessState.cppstatic int open_driver(){    // æ‰“å¼€è®¾å¤‡æ–‡ä»¶    int fd = open(&quot;/dev/binder&quot;, O_RDWR);    if (fd &gt;= 0) {        fcntl(fd, F_SETFD, FD_CLOEXEC);        int vers = 0;        // è·å–é©±åŠ¨ç‰ˆæœ¬        status_t result = ioctl(fd, BINDER_VERSION, &amp;vers);        if (result == -1) {            ALOGE(&quot;Binder ioctl to obtain version failed: %s&quot;, strerror(errno));            close(fd);            fd = -1;        }        // æ£€æŸ¥é©±åŠ¨ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´        if (result != 0 || vers != BINDER_CURRENT_PROTOCOL_VERSION) {            ALOGE(&quot;Binder driver protocol does not match user space protocol!&quot;);            close(fd);            fd = -1;        }        // è®¾ç½®æœ€å¤š 15 ä¸ª binder çº¿ç¨‹        size_t maxThreads = DEFAULT_MAX_BINDER_THREADS;        result = ioctl(fd, BINDER_SET_MAX_THREADS, &amp;maxThreads);        if (result == -1) {            ALOGE(&quot;Binder ioctl to set max threads failed: %s&quot;, strerror(errno));        }    } else {        ALOGW(&quot;Opening &#39;/dev/binder&#39; failed: %s\n&quot;, strerror(errno));    }    return fd;}</code></pre><p><strong>2. è®¾å¤‡çš„è¯»å†™</strong></p><p>æ‰“å¼€è®¾å¤‡æ–‡ä»¶åï¼Œæ–‡ä»¶æè¿°ç¬¦è¢«ä¿å­˜åœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/ProcessState.cpp#L340" target="_blank" rel="noopener">mDriverFD</a>ï¼Œ é€šè¿‡ç³»ç»Ÿè°ƒç”¨ <code>ioctl</code> å‡½æ•°æ“ä½œ <code>mDriverFD</code> å°±å¯ä»¥å®ç°å’Œ binder é©±åŠ¨çš„äº¤äº’ã€‚</p><p>å¯¹ Binder è®¾å¤‡æ–‡ä»¶çš„æ‰€æœ‰è¯»å†™åŠå…³é—­æ“ä½œåˆ™éƒ½åœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L805" target="_blank" rel="noopener">IPCThreadState</a> ä¸­ï¼Œå¦‚ä¸Šä¸€å°èŠ‚æåŠåˆ°çš„ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L803" target="_blank" rel="noopener">IPCThreadState::talkWithDriver</a> å‡½æ•°</p><p><code>talkWithDriver()</code> å‡½æ•°å°è£…äº† <code>BINDER_WRITE_READ</code> å‘½ä»¤ï¼Œä¼šä» binder é©±åŠ¨è¯»å–æˆ–å†™å…¥å°è£…åœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L856" target="_blank" rel="noopener">binder_write_read</a> ç»“æ„ä½“ä¸­çš„æœ¬åœ°æˆ–è¿œç¨‹å¯¹è±¡ã€‚</p><pre><code class="c++">// IPCThreadState.cppstatus_t IPCThreadState::talkWithDriver(bool doReceive){       binder_write_read bwr;    const bool needRead = mIn.dataPosition() &gt;= mIn.dataSize();    const size_t outAvail = (!doReceive || needRead) ? mOut.dataSize() : 0;    // å†™å…¥æ•°æ®    bwr.write_size = outAvail;    bwr.write_buffer = (uintptr_t)mOut.data();    // è¯»å–æ•°æ®    if (doReceive &amp;&amp; needRead) {        bwr.read_size = mIn.dataCapacity();        bwr.read_buffer = (uintptr_t)mIn.data();    } else {        bwr.read_size = 0;        bwr.read_buffer = 0;    }    ...    // ä½¿ç”¨ ioctl ç³»ç»Ÿè°ƒç”¨å‘é€ BINDER_WRITE_READ å‘½ä»¤åˆ° biner é©±åŠ¨    if (ioctl(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr) &gt;= 0)        err = NO_ERROR;    ...}</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œæœ¬åœ°å±‚æ˜¯å¯¹åº”ç”¨ä¸ binder é©±åŠ¨äº¤äº’çš„ç›´æ¥å°è£…ä¸å®ç°ï¼Œæœ€ç»ˆçš„æ•°æ®ä¼ è¾“ä»æ˜¯ç”±é©±åŠ¨æ¥å®Œæˆçš„ã€‚æœ¬åœ°å±‚å¯¹åº•å±‚é©±åŠ¨è¿›è¡Œäº†å®Œæ•´çš„å°è£…ï¼Œä¸Šå±‚åº”ç”¨åªå…³å¿ƒ transact() å’Œ onTransact() å›è°ƒï¼Œå¯Ÿè§‰ä¸åˆ° binder é©±åŠ¨çš„å­˜åœ¨ï¼Œå‡è½»äº†ä¸Šå±‚åº”ç”¨è¿›ç¨‹é—´é€šä¿¡å¼€å‘çš„å¤æ‚åº¦ã€‚</p><h2 id="4-Binder-é©±åŠ¨"><a href="#4-Binder-é©±åŠ¨" class="headerlink" title="4. Binder é©±åŠ¨"></a>4. Binder é©±åŠ¨</h2><p>å…³äº binder é©±åŠ¨å»ºè®®å‚è€ƒå¦ä¸€ç¯‡æ–‡ç«  <a href="http://blog.csdn.net/yangwen123/article/details/9316987" target="_blank" rel="noopener">æ·±å…¥åˆ†æAndroid Binder é©±åŠ¨</a> <a href="[Android Binder](https://web.archive.org/web/20101016004342/http://www.gmier.com/node/11">åŸæ–‡</a>ï¼Œæœ¬å°èŠ‚ä»éœ€è¦å®Œå–„ã€‚</p><p>Binder é©±åŠ¨æ˜¯ Binder çš„æœ€ç»ˆå®ç°ï¼Œ ServiceManager å’Œ Client/Service è¿›ç¨‹é—´é€šä¿¡æœ€ç»ˆéƒ½æ˜¯ç”± Binder é©±åŠ¨æŠ•é€’çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/xdtianyu/SourceAnalysis/master/art/binder_reference.png" alt="Binder reference"></p><p>Binder é©±åŠ¨çš„ä»£ç ä½äº kernel ä»£ç çš„ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/tree/master/drivers/staging/android" target="_blank" rel="noopener">drivers/staging/android</a> ç›®å½•ä¸‹ã€‚ä¸»æ–‡ä»¶æ˜¯ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h" target="_blank" rel="noopener">binder.h</a> å’Œ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c" target="_blank" rel="noopener">binder.c</a></p><p>è¿›ç¨‹é—´ä¼ è¾“çš„æ•°æ®è¢«ç§°ä¸º Binder å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ª <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L49" target="_blank" rel="noopener">flat_binder_object</a>ï¼Œç»“æ„å¦‚ä¸‹</p><pre><code class="c">struct flat_binder_object {    /* 8 bytes for large_flat_header. */    unsigned long       type;    unsigned long       flags;    /* 8 bytes of data. */    union {        void        *binder;    /* local object */        signed long handle;     /* remote object */    };    /* extra data associated with local object */    void            *cookie;};</code></pre><p>å…¶ä¸­ ç±»å‹ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L29" target="_blank" rel="noopener">type</a> æè¿°äº† Binder å¯¹è±¡çš„ç±»å‹ï¼ŒåŒ…å« <code>BINDER</code>(æœ¬åœ°å¯¹è±¡)ã€<code>HANDLE</code>(è¿œç¨‹å¯¹è±¡)ã€ <code>FD</code> ä¸‰å¤§ç±»(äº”ç§)</p><pre><code class="c">enum {    BINDER_TYPE_BINDER  = B_PACK_CHARS(&#39;s&#39;, &#39;b&#39;, &#39;*&#39;, B_TYPE_LARGE),    BINDER_TYPE_WEAK_BINDER = B_PACK_CHARS(&#39;w&#39;, &#39;b&#39;, &#39;*&#39;, B_TYPE_LARGE),    BINDER_TYPE_HANDLE  = B_PACK_CHARS(&#39;s&#39;, &#39;h&#39;, &#39;*&#39;, B_TYPE_LARGE),    BINDER_TYPE_WEAK_HANDLE = B_PACK_CHARS(&#39;w&#39;, &#39;h&#39;, &#39;*&#39;, B_TYPE_LARGE),    BINDER_TYPE_FD      = B_PACK_CHARS(&#39;f&#39;, &#39;d&#39;, &#39;*&#39;, B_TYPE_LARGE),};</code></pre><p><a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L52" target="_blank" rel="noopener">flags</a> åˆ™è¡¨è¿°äº†<a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L110" target="_blank" rel="noopener">ä¼ è¾“æ–¹å¼</a>ï¼Œå¦‚å¼‚æ­¥ã€æ— è¿”å›ç­‰</p><pre><code class="c">enum transaction_flags {    TF_ONE_WAY  = 0x01, /* this is a one-way call: async, no return */    TF_ROOT_OBJECT  = 0x04, /* contents are the component&#39;s root object */    TF_STATUS_CODE  = 0x08, /* contents are a 32-bit status code */    TF_ACCEPT_FDS   = 0x10, /* allow replies with file descriptors */};</code></pre><p>è€Œ <code>flat_binder_object</code> ä¸­çš„ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L55" target="_blank" rel="noopener">union è”åˆä½“</a> å°±æ˜¯è¦ä¼ è¾“çš„æ•°æ®ï¼Œå½“ç±»å‹ä¸º <code>BINDER</code> æ—¶ï¼Œ æ•°æ®å°±æ˜¯ä¸€ä¸ªæœ¬åœ°å¯¹è±¡ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L56" target="_blank" rel="noopener">*binder</a>ï¼Œè€Œç±»å‹ä¸º <code>HANDLE</code> æ—¶ï¼Œæ•°æ®åˆ™æ˜¯ä¸€ä¸ªè¿œç¨‹å¯¹è±¡ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L57" target="_blank" rel="noopener">handle</a>ã€‚</p><p>å½“ <code>flat_binder_object</code> åœ¨è¿›ç¨‹é—´ä¼ é€’æ—¶ï¼Œ Binder é©±åŠ¨ä¼šä¿®æ”¹å®ƒçš„ç±»å‹å’Œæ•°æ®ï¼Œäº¤æ¢çš„ä»£ç å‚è€ƒ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L1671" target="_blank" rel="noopener">binder_transaction</a> çš„å®ç°ã€‚</p><p>è¯¥å¦‚ä½•ç†è§£æœ¬åœ° <code>BINDER</code> å¯¹è±¡å’Œè¿œç¨‹ <code>HANDLE</code> å¯¹è±¡å‘¢ï¼Ÿå…¶å®å®ƒä»¬éƒ½ä»£è¡¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸è¿‡æ˜¯ä»ä¸åŒçš„è§’åº¦æ¥çœ‹ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå‡å¦‚è¿›ç¨‹ <code>RemoteService</code> æœ‰ä¸ªå¯¹è±¡ <a href="https://github.com/xdtianyu/AidlExample/blob/master/remoteservice/src/main/java/org/xdty/remoteservice/RemoteService.java#L11" target="_blank" rel="noopener">mBinder</a>ï¼Œå¯¹äº <code>RemoteService</code> æ¥è¯´ï¼Œ<code>mBinder</code> å°±æ˜¯ä¸€ä¸ªæœ¬åœ°çš„ <code>BINDER</code> å¯¹è±¡ï¼›å¦‚æœè¿›ç¨‹ <code>app</code> é€šè¿‡ Binder é©±åŠ¨è®¿é—® <code>RemoteService</code> çš„ <code>mBinder</code> å¯¹è±¡ï¼Œå¯¹äº <code>app</code> æ¥è¯´ï¼Œ <code>mBinder</code> å°±æ˜¯ä¸€ä¸ª <code>HANDLE</code>ã€‚å› æ­¤ï¼Œä»æ ¹æœ¬ä¸Šæ¥è¯´ <code>handle</code> å’Œ <code>binder</code> éƒ½æŒ‡å‘ <code>RemoteService</code> çš„ <code>mBinder</code>ã€‚æœ¬åœ°å¯¹è±¡è¿˜å¯ä»¥å¸¦æœ‰é¢å¤–çš„æ•°æ®ï¼Œä¿å­˜åœ¨ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L61" target="_blank" rel="noopener">cookie</a> ä¸­ã€‚</p><p>Binder é©±åŠ¨ç›´æ¥æ“ä½œçš„æœ€å¤–å±‚æ•°æ®ç»“æ„æ˜¯ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L117" target="_blank" rel="noopener">binder_transaction_data</a>ï¼Œ Binder å¯¹è±¡ <code>flat_binder_object</code> è¢«å°è£…åœ¨ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L142" target="_blank" rel="noopener">binder_transaction_data</a> ç»“æ„ä½“ä¸­ã€‚</p><p><code>binder_transaction_data</code> æ•°æ®ç»“æ„æ‰æ˜¯çœŸæ­£ä¼ è¾“çš„æ•°æ®ï¼Œå…¶å®šä¹‰å¦‚ä¸‹</p><pre><code class="c">struct binder_transaction_data {    /* The first two are only used for bcTRANSACTION and brTRANSACTION,     * identifying the target and contents of the transaction.     */    union {        size_t  handle; /* target descriptor of command transaction */        void    *ptr;   /* target descriptor of return transaction */    } target;    void        *cookie;    /* target object cookie */    unsigned int    code;       /* transaction command */    /* General information about the transaction. */    unsigned int    flags;    pid_t       sender_pid;    uid_t       sender_euid;    size_t      data_size;  /* number of bytes of data */    size_t      offsets_size;   /* number of bytes of offsets */    /* If this transaction is inline, the data immediately     * follows here; otherwise, it ends with a pointer to     * the data buffer.     */    union {        struct {            /* transaction data */            const void  *buffer;            /* offsets from buffer to flat_binder_object structs */            const void  *offsets;        } ptr;        uint8_t buf[8];    } data;};</code></pre><p><code>flat_binder_object</code> å°±è¢«å°è£…åœ¨ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L142" target="_blank" rel="noopener">*buffer</a>ä¸­ï¼Œå…¶ä¸­çš„ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L126" target="_blank" rel="noopener">unsigned int   code;</a> åˆ™æ˜¯ä¼ è¾“å‘½ä»¤ï¼Œæè¿°äº† Binder å¯¹è±¡æ‰§è¡Œçš„æ“ä½œã€‚</p><h3 id="4-1-binder-è®¾å¤‡çš„åˆ›å»º"><a href="#4-1-binder-è®¾å¤‡çš„åˆ›å»º" class="headerlink" title="4.1 binder è®¾å¤‡çš„åˆ›å»º"></a>4.1 binder è®¾å¤‡çš„åˆ›å»º</h3><p><a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L3747" target="_blank" rel="noopener">device_initcall()</a> å‡½æ•°æ˜¯å†…æ ¸åŠ è½½é©±åŠ¨çš„å…¥å£å‡½æ•°ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ã€‚</p><pre><code class="c">static struct miscdevice binder_miscdev = {    .minor = MISC_DYNAMIC_MINOR,    // è®¾å¤‡æ–‡ä»¶ /dev/binder    .name = &quot;binder&quot;,    // è®¾å¤‡æ–‡ä»¶æ“ä½œ    .fops = &amp;binder_fops};static int __init binder_init(void){    int ret;    ...    // æ³¨å†Œå­—ç¬¦è®¾å¤‡    ret = misc_register(&amp;binder_miscdev);    ...    // è°ƒè¯•æ–‡ä»¶ï¼Œ åœ¨ /sys/kernel/debug/binder ç›®å½•ä¸‹    if (binder_debugfs_dir_entry_root) {        debugfs_create_file(&quot;state&quot;,                    S_IRUGO,                    binder_debugfs_dir_entry_root,                    NULL,                    &amp;binder_state_fops);        ...    }    return ret;}device_initcall(binder_init);</code></pre><p>å¯ä»¥çœ‹å‡º <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L3704" target="_blank" rel="noopener">binder_init()</a> ä½¿ç”¨ <code>misc_register()</code> å‡½æ•°åˆ›å»ºäº† binder è®¾å¤‡ã€‚ä» <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L3716" target="_blank" rel="noopener">misc_register(&amp;binder_miscdev);</a> åŠ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L3695" target="_blank" rel="noopener">.name = â€œbinderâ€</a> å¯ä»¥çœ‹å‡ºï¼Œ binder å‘ kernel æ³¨å†Œäº†ä¸€ä¸ª <code>/dev/binder</code> çš„å­—ç¬¦è®¾å¤‡ï¼Œè€Œæ–‡ä»¶æ“ä½œéƒ½åœ¨ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L3683" target="_blank" rel="noopener">binder_fops</a> ç»“æ„ä½“ä¸­å®šä¹‰ã€‚</p><pre><code class="c">static const struct file_operations binder_fops = {    .owner = THIS_MODULE,    .poll = binder_poll,    .unlocked_ioctl = binder_ioctl,    .mmap = binder_mmap,    .open = binder_open,    .flush = binder_flush,    .release = binder_release,};</code></pre><p>ä»ä¸Šé¢ <code>binder_fops</code> ç»“æ„ä½“å¯ä»¥çœ‹å‡ºï¼Œä¸»è¦çš„æ“ä½œæ˜¯ <code>binder_ioctl()</code> <code>binder_mmap()</code> <code>binder_open()</code> ç­‰å‡½æ•°å®ç°çš„ã€‚</p><h3 id="4-2-binder-åè®®å’Œæ•°æ®ç»“æ„"><a href="#4-2-binder-åè®®å’Œæ•°æ®ç»“æ„" class="headerlink" title="4.2 binder åè®®å’Œæ•°æ®ç»“æ„"></a>4.2 binder åè®®å’Œæ•°æ®ç»“æ„</h3><p><a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h" target="_blank" rel="noopener">binder.h</a> æ–‡ä»¶ä¸­å®šä¹‰äº† binder åè®®å’Œé‡è¦çš„æ•°æ®ç»“æ„ã€‚</p><p>é¦–å…ˆåœ¨ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L29" target="_blank" rel="noopener">enum</a> ä¸­å®šä¹‰äº† binder å¤„ç†çš„ç±»å‹ï¼Œå¼•ç”¨æˆ–æ˜¯å¥æŸ„</p><pre><code class="c">enum {    BINDER_TYPE_BINDER  = B_PACK_CHARS(&#39;s&#39;, &#39;b&#39;, &#39;*&#39;, B_TYPE_LARGE),    BINDER_TYPE_WEAK_BINDER = B_PACK_CHARS(&#39;w&#39;, &#39;b&#39;, &#39;*&#39;, B_TYPE_LARGE),    BINDER_TYPE_HANDLE  = B_PACK_CHARS(&#39;s&#39;, &#39;h&#39;, &#39;*&#39;, B_TYPE_LARGE),    BINDER_TYPE_WEAK_HANDLE = B_PACK_CHARS(&#39;w&#39;, &#39;h&#39;, &#39;*&#39;, B_TYPE_LARGE),    BINDER_TYPE_FD      = B_PACK_CHARS(&#39;f&#39;, &#39;d&#39;, &#39;*&#39;, B_TYPE_LARGE),};</code></pre><p>ä¸‹é¢è¿™æ®µå®å®šä¹‰åˆ™æ˜¯åœ¨ <code>ioctl</code> å‡½æ•°è°ƒç”¨æ—¶å¯ç”¨çš„å…·ä½“å‘½ä»¤ã€‚</p><pre><code class="c">#define BINDER_WRITE_READ       _IOWR(&#39;b&#39;, 1, struct binder_write_read)#define BINDER_SET_IDLE_TIMEOUT     _IOW(&#39;b&#39;, 3, int64_t)#define BINDER_SET_MAX_THREADS      _IOW(&#39;b&#39;, 5, size_t)#define BINDER_SET_IDLE_PRIORITY    _IOW(&#39;b&#39;, 6, int)#define BINDER_SET_CONTEXT_MGR      _IOW(&#39;b&#39;, 7, int)#define BINDER_THREAD_EXIT      _IOW(&#39;b&#39;, 8, int)#define BINDER_VERSION          _IOWR(&#39;b&#39;, 9, struct binder_version)</code></pre><p>åœ¨ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L166" target="_blank" rel="noopener">BinderDriverReturnProtocol</a> å’Œ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L254" target="_blank" rel="noopener">BinderDriverCommandProtocol</a> ä¸­ åˆ™åˆ†åˆ«å®šä¹‰äº† å®¢æˆ·ç«¯è°ƒç”¨ å’Œ æœåŠ¡ç«¯ è¿”å›çš„å‘½ä»¤ã€‚</p><h3 id="4-3-binder-é©±åŠ¨æ–‡ä»¶æ“ä½œ"><a href="#4-3-binder-é©±åŠ¨æ–‡ä»¶æ“ä½œ" class="headerlink" title="4.3 binder é©±åŠ¨æ–‡ä»¶æ“ä½œ"></a>4.3 binder é©±åŠ¨æ–‡ä»¶æ“ä½œ</h3><p>ä¸Šæ–‡å·²ç»æåˆ°ï¼Œæ‰€æœ‰çš„æ“ä½œå®šä¹‰åœ¨ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L3683" target="_blank" rel="noopener">binder_fops</a> ç»“æ„ä½“ä¸­ï¼Œä¸‹é¢è®²è¿°è¿™äº›æ“ä½œã€‚</p><p><strong>è®¾å¤‡çš„æ‰“å¼€ - binder_open() å‡½æ•°</strong></p><p>ç”¨æˆ·ç©ºé—´åœ¨æ‰“å¼€ <code>/dev/binder</code> è®¾å¤‡æ—¶ï¼Œé©±åŠ¨ä¼šå‡ºå‘ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L3004" target="_blank" rel="noopener">binder_open()</a> å‡½æ•°çš„å“åº”ã€‚</p><pre><code class="c">static int binder_open(struct inode *nodp, struct file *filp){    struct binder_proc *proc;    // åˆ†é… binder_proc æ•°æ®ç»“æ„å†…å­˜    proc = kzalloc(sizeof(*proc), GFP_KERNEL);    if (proc == NULL)        return -ENOMEM;    // å¢åŠ å½“å‰çº¿ç¨‹/è¿›ç¨‹çš„å¼•ç”¨è®¡æ•°å¹¶èµ‹å€¼ç»™tsk    get_task_struct(current);    proc-&gt;tsk = current;    // åˆå§‹åŒ–é˜Ÿåˆ—    INIT_LIST_HEAD(&amp;proc-&gt;todo);    init_waitqueue_head(&amp;proc-&gt;wait);    proc-&gt;default_priority = task_nice(current);    binder_lock(__func__);    // å¢åŠ BINDER_STAT_PROCçš„å¯¹è±¡è®¡æ•°    binder_stats_created(BINDER_STAT_PROC);    // æ·»åŠ  proc_node åˆ° binder_procs å…¨å±€åˆ—è¡¨ä¸­ï¼Œè¿™æ ·ä»»ä½•è¿›ç¨‹å°±å¯ä»¥è®¿é—®åˆ°å…¶ä»–è¿›ç¨‹çš„ binder_proc å¯¹è±¡äº†    hlist_add_head(&amp;proc-&gt;proc_node, &amp;binder_procs);    // ä¿å­˜è¿›ç¨‹ id    proc-&gt;pid = current-&gt;group_leader-&gt;pid;    INIT_LIST_HEAD(&amp;proc-&gt;delivered_death);    // é©±åŠ¨æ–‡ä»¶ private_data æŒ‡å‘ proc    filp-&gt;private_data = proc;    binder_unlock(__func__);    return 0;}</code></pre><p><strong>é©±åŠ¨æ–‡ä»¶é‡Šæ”¾ - binder_release() å‡½æ•°</strong></p><p>åœ¨ç”¨æˆ·ç©ºé—´å…³é—­é©±åŠ¨è®¾å¤‡æ–‡ä»¶æ—¶ï¼Œä¼šè°ƒç”¨ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L3068" target="_blank" rel="noopener">binder_release()</a> å‡½æ•°ï¼Œæ¸…ç† binder_proc å¯¹è±¡ï¼Œé‡Šæ”¾å ç”¨çš„å†…å­˜ã€‚</p><pre><code class="c">static int binder_release(struct inode *nodp, struct file *filp){    struct binder_proc *proc = filp-&gt;private_data;    binder_defer_work(proc, BINDER_DEFERRED_RELEASE);    return 0;}static voidbinder_defer_work(struct binder_proc *proc, enum binder_deferred_state defer){    mutex_lock(&amp;binder_deferred_lock);    proc-&gt;deferred_work |= defer;    if (hlist_unhashed(&amp;proc-&gt;deferred_work_node)) {        // æ·»åŠ åˆ°é‡Šæ”¾é˜Ÿåˆ—ä¸­        hlist_add_head(&amp;proc-&gt;deferred_work_node,                &amp;binder_deferred_list);        queue_work(binder_deferred_workqueue, &amp;binder_deferred_work);    }    mutex_unlock(&amp;binder_deferred_lock);}</code></pre><p><strong>å†…å­˜æ˜ å°„ - binder_mmap() å‡½æ•°</strong></p><p><a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L2905" target="_blank" rel="noopener">binder_mmap()</a> å‡½æ•°æŠŠè®¾å¤‡å†…å­˜æ˜ å°„åˆ°ç”¨æˆ·è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥åƒæ“ä½œç”¨æˆ·å†…å­˜é‚£æ ·æ“ä½œè®¾å¤‡å†…å­˜ã€‚</p><pre><code class="c">static int binder_mmap(struct file *filp, struct vm_area_struct *vma){    int ret;    struct vm_struct *area;    // è·å¾— binder_proc å¯¹è±¡    struct binder_proc *proc = filp-&gt;private_data;    const char *failure_string;    struct binder_buffer *buffer;    // æœ€å¤šåªåˆ†é… 4M çš„å†…å­˜    if ((vma-&gt;vm_end - vma-&gt;vm_start) &gt; SZ_4M)        vma-&gt;vm_end = vma-&gt;vm_start + SZ_4M;    // æ£€æŸ¥ flags    if (vma-&gt;vm_flags &amp; FORBIDDEN_MMAP_FLAGS) {        ret = -EPERM;        failure_string = &quot;bad vm_flags&quot;;        goto err_bad_arg;    }    vma-&gt;vm_flags = (vma-&gt;vm_flags | VM_DONTCOPY) &amp; ~VM_MAYWRITE;    mutex_lock(&amp;binder_mmap_lock);    // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜ å°„    if (proc-&gt;buffer) {        ret = -EBUSY;        failure_string = &quot;already mapped&quot;;        goto err_already_mapped;    }    // ç”³è¯·å†…æ ¸è™šæ‹Ÿå†…å­˜ç©ºé—´    area = get_vm_area(vma-&gt;vm_end - vma-&gt;vm_start, VM_IOREMAP);    if (area == NULL) {        ret = -ENOMEM;        failure_string = &quot;get_vm_area&quot;;        goto err_get_vm_area_failed;    }    // å°†ç”³è¯·åˆ°çš„å†…å­˜åœ°å€ä¿å­˜åˆ° binder_proc å¯¹è±¡ä¸­    proc-&gt;buffer = area-&gt;addr;    proc-&gt;user_buffer_offset = vma-&gt;vm_start - (uintptr_t)proc-&gt;buffer;    mutex_unlock(&amp;binder_mmap_lock);    // æ ¹æ®è¯·æ±‚åˆ°çš„å†…å­˜ç©ºé—´å¤§å°ï¼Œåˆ†é…ç»™ binder_proc å¯¹è±¡çš„ pagesï¼Œ ç”¨äºä¿å­˜æŒ‡å‘ç‰©ç†é¡µçš„æŒ‡é’ˆ    proc-&gt;pages = kzalloc(sizeof(proc-&gt;pages[0]) * ((vma-&gt;vm_end - vma-&gt;vm_start) / PAGE_SIZE), GFP_KERNEL);    if (proc-&gt;pages == NULL) {        ret = -ENOMEM;        failure_string = &quot;alloc page array&quot;;        goto err_alloc_pages_failed;    }    proc-&gt;buffer_size = vma-&gt;vm_end - vma-&gt;vm_start;    vma-&gt;vm_ops = &amp;binder_vm_ops;    vma-&gt;vm_private_data = proc;    // åˆ†é…ä¸€ä¸ªé¡µçš„ç‰©ç†å†…å­˜    if (binder_update_page_range(proc, 1, proc-&gt;buffer, proc-&gt;buffer + PAGE_SIZE, vma)) {        ret = -ENOMEM;        failure_string = &quot;alloc small buf&quot;;        goto err_alloc_small_buf_failed;    }    // å†…å­˜æä¾›ç»™ binder_buffer    buffer = proc-&gt;buffer;    // åˆå§‹åŒ– proc-&gt;buffers é“¾è¡¨    INIT_LIST_HEAD(&amp;proc-&gt;buffers);    // å°† binder_buffer å¯¹è±¡æ”¾å…¥åˆ° proc-&gt;buffers é“¾è¡¨ä¸­    list_add(&amp;buffer-&gt;entry, &amp;proc-&gt;buffers);    buffer-&gt;free = 1;    binder_insert_free_buffer(proc, buffer);    proc-&gt;free_async_space = proc-&gt;buffer_size / 2;    barrier();    proc-&gt;files = get_files_struct(proc-&gt;tsk);    proc-&gt;vma = vma;    proc-&gt;vma_vm_mm = vma-&gt;vm_mm;    return 0;}</code></pre><p><strong>é©±åŠ¨å‘½ä»¤æ¥å£ - binder_ioctl() å‡½æ•°</strong></p><p>ç”¨æˆ·æ€ç¨‹åºè°ƒç”¨ <code>ioctl</code> ç³»ç»Ÿå‡½æ•°å‘ <code>/dev/binder</code> è®¾å¤‡å‘é€æ•°æ®æ—¶ï¼Œä¼šè§¦å‘ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L2734" target="_blank" rel="noopener">binder_ioctl()</a> å‡½æ•°å“åº”ã€‚</p><p>ä¸Šæ–‡æ•°æ®ç»“æ„ä¸­å·²ç»æåˆ°äº† <code>binder_ioctl</code> å¯ä»¥å¤„ç†çš„ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L87" target="_blank" rel="noopener">å‘½ä»¤</a></p><pre><code class="c">// æ ¸å¿ƒå‘½ä»¤ï¼Œæ•°æ®çš„è¯»å†™#define BINDER_WRITE_READ       _IOWR(&#39;b&#39;, 1, struct binder_write_read)// è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°#define BINDER_SET_MAX_THREADS      _IOW(&#39;b&#39;, 5, size_t)// è®¾ç½® context manager#define BINDER_SET_CONTEXT_MGR      _IOW(&#39;b&#39;, 7, int)// çº¿ç¨‹é€€å‡ºå‘½ä»¤#define BINDER_THREAD_EXIT      _IOW(&#39;b&#39;, 8, int)// binder é©±åŠ¨çš„ç‰ˆæœ¬#define BINDER_VERSION          _IOWR(&#39;b&#39;, 9, struct binder_version)</code></pre><pre><code class="c">static long binder_ioctl(struct file *filp, unsigned int cmd, unsigned long arg){    int ret;    struct binder_proc *proc = filp-&gt;private_data;    struct binder_thread *thread;    unsigned int size = _IOC_SIZE(cmd);    void __user *ubuf = (void __user *)arg;    // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯    ret = wait_event_interruptible(binder_user_error_wait, binder_stop_on_user_error &lt; 2);    if (ret)        goto err_unlocked;    binder_lock(__func__);    // è·å– binder_thread å¯¹è±¡    thread = binder_get_thread(proc);    if (thread == NULL) {        ret = -ENOMEM;        goto err;    }    switch (cmd) {    case BINDER_WRITE_READ: {        struct binder_write_read bwr;        if (size != sizeof(struct binder_write_read)) {            ret = -EINVAL;            goto err;        }        // ä»ç”¨æˆ·ç©ºé—´æ‹·è´ binder_write_read åˆ° binder é©±åŠ¨ï¼Œå‚¨å­˜åœ¨ bwr        if (copy_from_user(&amp;bwr, ubuf, sizeof(bwr))) {            ret = -EFAULT;            goto err;        }        if (bwr.write_size &gt; 0) {            // æ‰§è¡Œå†™å…¥æ“ä½œ            ret = binder_thread_write(proc, thread, (void __user *)bwr.write_buffer, bwr.write_size, &amp;bwr.write_consumed);            if (ret &lt; 0) {                bwr.read_consumed = 0;                if (copy_to_user(ubuf, &amp;bwr, sizeof(bwr)))                    ret = -EFAULT;                goto err;            }        }        if (bwr.read_size &gt; 0) {            // æ‰§è¡Œè¯»å–æ“ä½œ            ret = binder_thread_read(proc, thread, (void __user *)bwr.read_buffer, bwr.read_size, &amp;bwr.read_consumed, filp-&gt;f_flags &amp; O_NONBLOCK);            if (!list_empty(&amp;proc-&gt;todo))                wake_up_interruptible(&amp;proc-&gt;wait);            if (ret &lt; 0) {                if (copy_to_user(ubuf, &amp;bwr, sizeof(bwr)))                    ret = -EFAULT;                goto err;            }        }        // æ“ä½œå®Œæˆåå°†æ•°æ®è¿”å›ç»™ç”¨æˆ·ç©ºé—´        if (copy_to_user(ubuf, &amp;bwr, sizeof(bwr))) {            ret = -EFAULT;            goto err;        }        break;    }    case BINDER_SET_MAX_THREADS:        // è®¾ç½®æœ€å¤§çº¿ç¨‹ï¼Œä»ç”¨æˆ·ç©ºé—´æ‹·è´æ•°æ®åˆ° proc-&gt;max_threads        if (copy_from_user(&amp;proc-&gt;max_threads, ubuf, sizeof(proc-&gt;max_threads))) {            ret = -EINVAL;            goto err;        }        break;    case BINDER_SET_CONTEXT_MGR:        // æ£€æŸ¥æ˜¯å¦å·²ç»è®¾ç½®        if (binder_context_mgr_node != NULL) {            ret = -EBUSY;            goto err;        }        // è®¾ç½® context manager        ret = security_binder_set_context_mgr(proc-&gt;tsk);        if (ret &lt; 0)            goto err;        if (binder_context_mgr_uid != -1) {            if (binder_context_mgr_uid != current-&gt;cred-&gt;euid) {                ret = -EPERM;                goto err;            }        } else            binder_context_mgr_uid = current-&gt;cred-&gt;euid;        // åˆ›å»º binder_context_mgr_node èŠ‚ç‚¹        binder_context_mgr_node = binder_new_node(proc, NULL, NULL);        if (binder_context_mgr_node == NULL) {            ret = -ENOMEM;            goto err;        }        // åˆå§‹åŒ–èŠ‚ç‚¹æ•°æ®        binder_context_mgr_node-&gt;local_weak_refs++;        binder_context_mgr_node-&gt;local_strong_refs++;        binder_context_mgr_node-&gt;has_strong_ref = 1;        binder_context_mgr_node-&gt;has_weak_ref = 1;        break;    case BINDER_THREAD_EXIT:        // çº¿ç¨‹é€€å‡ºï¼Œé‡Šæ”¾èµ„æº        binder_free_thread(proc, thread);        thread = NULL;        break;    case BINDER_VERSION:        // å°† binder é©±åŠ¨ç‰ˆæœ¬å·å†™å…¥åˆ°ç”¨æˆ·ç©ºé—´ ubuf-&gt;protocol_version ä¸­        if (put_user(BINDER_CURRENT_PROTOCOL_VERSION, &amp;((struct binder_version *)ubuf)-&gt;protocol_version)) {            ret = -EINVAL;            goto err;        }        break;    default:        ret = -EINVAL;        goto err;    }    ret = 0;...}</code></pre><pre><code class="c">static struct binder_node *binder_new_node(struct binder_proc *proc,                       void __user *ptr,                       void __user *cookie){    struct rb_node **p = &amp;proc-&gt;nodes.rb_node;    struct rb_node *parent = NULL;    struct binder_node *node;    // æŸ¥æ‰¾è¦æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹    while (*p) {        parent = *p;        node = rb_entry(parent, struct binder_node, rb_node);        if (ptr &lt; node-&gt;ptr)            p = &amp;(*p)-&gt;rb_left;        else if (ptr &gt; node-&gt;ptr)            p = &amp;(*p)-&gt;rb_right;        else            return NULL;    }    // ä¸ºè¦æ’å…¥èŠ‚ç‚¹åˆ†é…å†…å­˜ç©ºé—´    node = kzalloc(sizeof(*node), GFP_KERNEL);    if (node == NULL)        return NULL;    binder_stats_created(BINDER_STAT_NODE);    // æ’å…¥èŠ‚ç‚¹    rb_link_node(&amp;node-&gt;rb_node, parent, p);    rb_insert_color(&amp;node-&gt;rb_node, &amp;proc-&gt;nodes);    // åˆå§‹åŒ–    node-&gt;debug_id = ++binder_last_id;    node-&gt;proc = proc;    node-&gt;ptr = ptr;    node-&gt;cookie = cookie;    node-&gt;work.type = BINDER_WORK_NODE;    INIT_LIST_HEAD(&amp;node-&gt;work.entry);    INIT_LIST_HEAD(&amp;node-&gt;async_todo);    return node;}</code></pre><p><strong>BINDER_WRITE_READ å¤„ç†è¿‡ç¨‹</strong></p><p>åœ¨ binder æœ¬åœ°å±‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨ <code>IPCThreadState::talkWithDriver()</code> å‡½æ•°ä¸­ï¼Œ binder æœ¬åœ°å±‚é€šè¿‡ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/native/libs/binder/IPCThreadState.cpp#L856" target="_blank" rel="noopener">ioctl()(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr)</a> å‘½ä»¤çš„å½¢å¼ï¼Œä¸ binder é©±åŠ¨äº¤äº’ã€‚</p><p>å¯ä»¥çœ‹å‡º <code>ioctl()</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.h#L69" target="_blank" rel="noopener">binder_write_read</a> ç»“æ„ä½“</p><p>binder.h å¤´æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ•°æ®ç±»å‹, ä¸€ä¸ªæ˜¯ <code>binder_write_read</code></p><pre><code class="c">struct binder_write_read {    signed long write_size; /* bytes to write */    signed long write_consumed; /* bytes consumed by driver */    unsigned long   write_buffer;    signed long read_size;  /* bytes to read */    signed long read_consumed;  /* bytes consumed by driver */    unsigned long   read_buffer;};</code></pre><p>å…¶ä¸­ <code>write_size</code> å’Œ <code>read_size</code> è¡¨ç¤ºéœ€è¦è¢«è¯»å†™çš„å­—èŠ‚æ•°ï¼Œ <code>write_consumed</code> å’Œ <code>read_consumed</code> è¡¨ç¤ºå·²ç»è¢« binder é©±åŠ¨è¯»å†™çš„å­—èŠ‚æ•°ï¼Œ <code>write_buffer</code> å’Œ <code>read_buffer</code> åˆ™æ˜¯æŒ‡å‘è¢«è¯»å†™æ•°æ®çš„æŒ‡é’ˆã€‚</p><p>å…·ä½“çš„è¯»å†™æ“ä½œè¢« <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L1852" target="_blank" rel="noopener">binder_thread_write</a> å’Œ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L2266" target="_blank" rel="noopener">binder_thread_read</a> å®ç°ã€‚</p><p><strong>æ•°æ®å†™å…¥ - binder_thread_write() å‡½æ•°</strong></p><p>å°†ç”¨æˆ·ç©ºé—´æ•°æ®å†™å…¥åˆ° binder é©±åŠ¨ï¼Œä»é©±åŠ¨è§’åº¦æ¥çœ‹æ˜¯è¯»å–çš„æ“ä½œã€‚</p><pre><code class="c">int binder_thread_write(struct binder_proc *proc, struct binder_thread *thread,            void __user *buffer, int size, signed long *consumed){    uint32_t cmd;    // ç”¨æˆ·ç©ºé—´æ•°æ®ï¼Œèµ·å§‹åœ°å€å’Œç»“æŸåœ°å€    void __user *ptr = buffer + *consumed;    void __user *end = buffer + size;    // å¾ªç¯è¯»å–    while (ptr &lt; end &amp;&amp; thread-&gt;return_error == BR_OK) {        // ä»ç”¨æˆ·ç©ºé—´è·å–æ“ä½œå‘½ä»¤        if (get_user(cmd, (uint32_t __user *)ptr))            return -EFAULT;        ptr += sizeof(uint32_t);        if (_IOC_NR(cmd) &lt; ARRAY_SIZE(binder_stats.bc)) {            // å¢åŠ å‘½ä»¤è®¡æ•°å™¨            binder_stats.bc[_IOC_NR(cmd)]++;            proc-&gt;stats.bc[_IOC_NR(cmd)]++;            thread-&gt;stats.bc[_IOC_NR(cmd)]++;        }        switch (cmd) {        // è¿™å››ä¸ªå‘½ä»¤ç”¨æ¥å¢åŠ æˆ–å‡å°‘å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œ æ“ä½œç›®æ ‡ binder_ref        case BC_INCREFS:        case BC_ACQUIRE:        case BC_RELEASE:        case BC_DECREFS: {            uint32_t target;            struct binder_ref *ref;            const char *debug_string;            // è·å–ç›®æ ‡è¿›ç¨‹èŠ‚ç‚¹æè¿° desc            if (get_user(target, (uint32_t __user *)ptr))                return -EFAULT;            ptr += sizeof(uint32_t);            // ç´¢æè¿°ä¸º 0 è¡¨ç¤º context manager è¿›ç¨‹            if (target == 0 &amp;&amp; binder_context_mgr_node &amp;&amp;                (cmd == BC_INCREFS || cmd == BC_ACQUIRE)) {                // åœ¨ proc-&gt;refs_by_node.rb_node çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾å¼•ç”¨                ref = binder_get_ref_for_node(proc,                           binder_context_mgr_node);            } else                // åœ¨ proc-&gt;refs_by_desc.rb_node çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾å¼•ç”¨                ref = binder_get_ref(proc, target);            switch (cmd) {            case BC_INCREFS:                debug_string = &quot;IncRefs&quot;;                // å¢åŠ å¼±å¼•ç”¨è®¡æ•°                binder_inc_ref(ref, 0, NULL);                break;            case BC_ACQUIRE:                debug_string = &quot;Acquire&quot;;                // å¢åŠ å¼ºå¼•ç”¨è®¡æ•°                binder_inc_ref(ref, 1, NULL);                break;            case BC_RELEASE:                debug_string = &quot;Release&quot;;                // å‡å°‘å¼ºå¼•ç”¨è®¡æ•°                binder_dec_ref(ref, 1);                break;            case BC_DECREFS:            default:                debug_string = &quot;DecRefs&quot;;                // å‡å°‘å¼±å¼•ç”¨è®¡æ•°                binder_dec_ref(ref, 0);                break;            }            break;        }        case BC_INCREFS_DONE:        case BC_ACQUIRE_DONE: {            void __user *node_ptr;            void *cookie;            struct binder_node *node;            // ä»ç”¨æˆ·ç©ºé—´è¯»å– node_ptr            if (get_user(node_ptr, (void * __user *)ptr))                return -EFAULT;            ptr += sizeof(void *);            // ä»ç”¨æˆ·ç©ºé—´è¯»å– cookie            if (get_user(cookie, (void * __user *)ptr))                return -EFAULT;            ptr += sizeof(void *);            // è·å¾—èŠ‚ç‚¹            node = binder_get_node(proc, node_ptr);            // æ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å›            if (node == NULL) {                binder_user_error(&quot;binder: %d:%d &quot;                    &quot;%s u%p no match\n&quot;,                    proc-&gt;pid, thread-&gt;pid,                    cmd == BC_INCREFS_DONE ?                    &quot;BC_INCREFS_DONE&quot; :                    &quot;BC_ACQUIRE_DONE&quot;,                    node_ptr);                break;            }            // cookie ä¸åŒ¹é…åˆ™è¿”å›            if (cookie != node-&gt;cookie) {                binder_user_error(&quot;binder: %d:%d %s u%p node %d&quot;                    &quot; cookie mismatch %p != %p\n&quot;,                    proc-&gt;pid, thread-&gt;pid,                    cmd == BC_INCREFS_DONE ?                    &quot;BC_INCREFS_DONE&quot; : &quot;BC_ACQUIRE_DONE&quot;,                    node_ptr, node-&gt;debug_id,                    cookie, node-&gt;cookie);                break;            }            if (cmd == BC_ACQUIRE_DONE) {                node-&gt;pending_strong_ref = 0;            } else {                node-&gt;pending_weak_ref = 0;            }            // å‡å°‘èŠ‚ç‚¹ä½¿ç”¨è®¡æ•°            binder_dec_node(node, cmd == BC_ACQUIRE_DONE, 0);            break;        }        // é‡Šæ”¾ binder_bffer        case BC_FREE_BUFFER: {            void __user *data_ptr;            struct binder_buffer *buffer;            // ä»ç”¨æˆ·ç©ºé—´è·å– data_ptr            if (get_user(data_ptr, (void * __user *)ptr))                return -EFAULT;            ptr += sizeof(void *);            // æŸ¥æ‰¾ binder_buffer            buffer = binder_buffer_lookup(proc, data_ptr);            // æ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å›            if (buffer == NULL) {                binder_user_error(&quot;binder: %d:%d &quot;                    &quot;BC_FREE_BUFFER u%p no match\n&quot;,                    proc-&gt;pid, thread-&gt;pid, data_ptr);                break;            }            // ä¸å…è®¸ç”¨æˆ·é‡Šæ”¾åˆ™è¿”å›            if (!buffer-&gt;allow_user_free) {                binder_user_error(&quot;binder: %d:%d &quot;                    &quot;BC_FREE_BUFFER u%p matched &quot;                    &quot;unreturned buffer\n&quot;,                    proc-&gt;pid, thread-&gt;pid, data_ptr);                break;            }            // å°† buffer-&gt;transaction ç½®ç©º            if (buffer-&gt;transaction) {                buffer-&gt;transaction-&gt;buffer = NULL;                buffer-&gt;transaction = NULL;            }            if (buffer-&gt;async_transaction &amp;&amp; buffer-&gt;target_node) {                if (list_empty(&amp;buffer-&gt;target_node-&gt;async_todo))                    buffer-&gt;target_node-&gt;has_async_transaction = 0;                else                    list_move_tail(buffer-&gt;target_node-&gt;async_todo.next, &amp;thread-&gt;todo);            }            // é‡Šæ”¾ binder_buffer å¯¹è±¡            trace_binder_transaction_buffer_release(buffer);            binder_transaction_buffer_release(proc, buffer, NULL);            binder_free_buf(proc, buffer);            break;        }        // binder æ•°æ®ä¼ é€’å¤„ç†        case BC_TRANSACTION:        case BC_REPLY: {            struct binder_transaction_data tr;            // ä»ç”¨æˆ·ç©ºé—´æ‹·è´ binder_transaction_data å¯¹è±¡            if (copy_from_user(&amp;tr, ptr, sizeof(tr)))                return -EFAULT;            ptr += sizeof(tr);            // å®é™…çš„ä¼ è¾“å‡½æ•°ï¼Œåœ¨ä¸‹æ–‡è®²è§£            binder_transaction(proc, thread, &amp;tr, cmd == BC_REPLY);            break;        }        // è®¾ç½® looper ä¸º BINDER_LOOPER_STATE_REGISTERED çŠ¶æ€        case BC_REGISTER_LOOPER:            if (thread-&gt;looper &amp; BINDER_LOOPER_STATE_ENTERED) {                thread-&gt;looper |= BINDER_LOOPER_STATE_INVALID;                binder_user_error(&quot;binder: %d:%d ERROR:&quot;                    &quot; BC_REGISTER_LOOPER called &quot;                    &quot;after BC_ENTER_LOOPER\n&quot;,                    proc-&gt;pid, thread-&gt;pid);            } else if (proc-&gt;requested_threads == 0) {                thread-&gt;looper |= BINDER_LOOPER_STATE_INVALID;                binder_user_error(&quot;binder: %d:%d ERROR:&quot;                    &quot; BC_REGISTER_LOOPER called &quot;                    &quot;without request\n&quot;,                    proc-&gt;pid, thread-&gt;pid);            } else {                proc-&gt;requested_threads--;                proc-&gt;requested_threads_started++;            }            thread-&gt;looper |= BINDER_LOOPER_STATE_REGISTERED;            break;        // è®¾ç½® looper ä¸º BINDER_LOOPER_STATE_ENTERED çŠ¶æ€        case BC_ENTER_LOOPER:            if (thread-&gt;looper &amp; BINDER_LOOPER_STATE_REGISTERED) {                thread-&gt;looper |= BINDER_LOOPER_STATE_INVALID;                binder_user_error(&quot;binder: %d:%d ERROR:&quot;                    &quot; BC_ENTER_LOOPER called after &quot;                    &quot;BC_REGISTER_LOOPER\n&quot;,                    proc-&gt;pid, thread-&gt;pid);            }            thread-&gt;looper |= BINDER_LOOPER_STATE_ENTERED;            break;        // è®¾ç½® looper ä¸º BINDER_LOOPER_STATE_EXITED çŠ¶æ€        case BC_EXIT_LOOPER:            thread-&gt;looper |= BINDER_LOOPER_STATE_EXITED;            break;        // å‘é€ REQUEST_DEATH æˆ– CLEAR_DEATH é€šçŸ¥        case BC_REQUEST_DEATH_NOTIFICATION:        case BC_CLEAR_DEATH_NOTIFICATION: {            uint32_t target;            void __user *cookie;            struct binder_ref *ref;            struct binder_ref_death *death;            // ä»ç”¨æˆ·ç©ºé—´è·å– binder_ref æè¿° desc            if (get_user(target, (uint32_t __user *)ptr))                return -EFAULT;            ptr += sizeof(uint32_t);            // ä»ç”¨æˆ·ç©ºé—´è·å– cookie            if (get_user(cookie, (void __user * __user *)ptr))                return -EFAULT;            ptr += sizeof(void *);            // è·å– binder_ref å¼•ç”¨            ref = binder_get_ref(proc, target);            if (ref == NULL) {                binder_user_error(&quot;binder: %d:%d %s &quot;                    &quot;invalid ref %d\n&quot;,                    proc-&gt;pid, thread-&gt;pid,                    cmd == BC_REQUEST_DEATH_NOTIFICATION ?                    &quot;BC_REQUEST_DEATH_NOTIFICATION&quot; :                    &quot;BC_CLEAR_DEATH_NOTIFICATION&quot;,                    target);                break;            }            if (cmd == BC_REQUEST_DEATH_NOTIFICATION) {                if (ref-&gt;death) {                    binder_user_error(&quot;binder: %d:%&quot;                        &quot;d BC_REQUEST_DEATH_NOTI&quot;                        &quot;FICATION death notific&quot;                        &quot;ation already set\n&quot;,                        proc-&gt;pid, thread-&gt;pid);                    break;                }                // ä¸º binder_ref_death å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´                death = kzalloc(sizeof(*death), GFP_KERNEL);                if (death == NULL) {                    thread-&gt;return_error = BR_ERROR;                    break;                }                // åˆå§‹åŒ– binder_ref_death å¯¹è±¡                binder_stats_created(BINDER_STAT_DEATH);                INIT_LIST_HEAD(&amp;death-&gt;work.entry);                death-&gt;cookie = cookie;                ref-&gt;death = death;                if (ref-&gt;node-&gt;proc == NULL) {                    ref-&gt;death-&gt;work.type = BINDER_WORK_DEAD_BINDER;                    if (thread-&gt;looper &amp; (BINDER_LOOPER_STATE_REGISTERED | BINDER_LOOPER_STATE_ENTERED)) {                        list_add_tail(&amp;ref-&gt;death-&gt;work.entry, &amp;thread-&gt;todo);                    } else {                        list_add_tail(&amp;ref-&gt;death-&gt;work.entry, &amp;proc-&gt;todo);                        // å”¤é†’ç›®æ ‡è¿›ç¨‹                        wake_up_interruptible(&amp;proc-&gt;wait);                    }                }            } else {                if (ref-&gt;death == NULL) {                    binder_user_error(&quot;binder: %d:%&quot;                        &quot;d BC_CLEAR_DEATH_NOTIFI&quot;                        &quot;CATION death notificat&quot;                        &quot;ion not active\n&quot;,                        proc-&gt;pid, thread-&gt;pid);                    break;                }                death = ref-&gt;death;                if (death-&gt;cookie != cookie) {                    binder_user_error(&quot;binder: %d:%&quot;                        &quot;d BC_CLEAR_DEATH_NOTIFI&quot;                        &quot;CATION death notificat&quot;                        &quot;ion cookie mismatch &quot;                        &quot;%p != %p\n&quot;,                        proc-&gt;pid, thread-&gt;pid,                        death-&gt;cookie, cookie);                    break;                }                // å°† ref-&gt;death ç½®ç©º                ref-&gt;death = NULL;                if (list_empty(&amp;death-&gt;work.entry)) {                    death-&gt;work.type = BINDER_WORK_CLEAR_DEATH_NOTIFICATION;                    if (thread-&gt;looper &amp; (BINDER_LOOPER_STATE_REGISTERED | BINDER_LOOPER_STATE_ENTERED)) {                        list_add_tail(&amp;death-&gt;work.entry, &amp;thread-&gt;todo);                    } else {                        list_add_tail(&amp;death-&gt;work.entry, &amp;proc-&gt;todo);                        // å”¤é†’ç›®æ ‡è¿›ç¨‹                        wake_up_interruptible(&amp;proc-&gt;wait);                    }                } else {                    BUG_ON(death-&gt;work.type != BINDER_WORK_DEAD_BINDER);                    death-&gt;work.type = BINDER_WORK_DEAD_BINDER_AND_CLEAR;                }            }        } break;        case BC_DEAD_BINDER_DONE: {            struct binder_work *w;            void __user *cookie;            struct binder_ref_death *death = NULL;            // ä»ç”¨æˆ·ç©ºé—´è·å– cookie            if (get_user(cookie, (void __user * __user *)ptr))                return -EFAULT;            ptr += sizeof(void *);            list_for_each_entry(w, &amp;proc-&gt;delivered_death, entry) {                struct binder_ref_death *tmp_death = container_of(w, struct binder_ref_death, work);                if (tmp_death-&gt;cookie == cookie) {                    death = tmp_death;                    break;                }            }            if (death == NULL) {                binder_user_error(&quot;binder: %d:%d BC_DEAD&quot;                    &quot;_BINDER_DONE %p not found\n&quot;,                    proc-&gt;pid, thread-&gt;pid, cookie);                break;            }            list_del_init(&amp;death-&gt;work.entry);            // å¦‚æœ death-&gt;work.t ä¸º BINDER_WORK_DEAD_BINDER_AND_CLEAR åˆ™ä¿®æ”¹ä¸º BINDER_WORK_CLEAR_DEATH_NOTIFICATION            if (death-&gt;work.t == BINDER_WORK_DEAD_BINDER_AND_CLEAR ) {                death-&gt;work.type = BINDER_WORK_CLEAR_DEATH_NOTIFICATION;                if (thread-&gt;looper &amp; (BINDER_LOOPER_STATE_REGISTERED | BINDER_LOOPER_STATE_ENTERED)) {                    list_add_tail(&amp;death-&gt;work.entry, &amp;thread-&gt;todo);                } else {                    list_add_tail(&amp;death-&gt;work.entry, &amp;proc-&gt;todo);                    // å”¤é†’ç›®æ ‡è¿›ç¨‹                    wake_up_interruptible(&amp;proc-&gt;wait);                }            }        } break;        default:            return -EINVAL;        }        *consumed = ptr - buffer;    }    return 0;}</code></pre><p><strong>binder_transaction() å‡½æ•°</strong></p><p>åœ¨ä¸Šæ–‡å¤„ç† <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L2041" target="_blank" rel="noopener">BC_TRANSACTION</a> å’Œ <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L2042" target="_blank" rel="noopener">BC_REPLY</a> æ—¶ï¼Œè°ƒç”¨äº† <a href="https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow/blob/master/drivers/staging/android/binder.c#L1417" target="_blank" rel="noopener">binder_transaction()</a> å‡½æ•°ã€‚æˆ‘ä»¬ç»§ç»­è¿½è¸ª</p><pre><code class="c">static void binder_transaction(struct binder_proc *proc,                   struct binder_thread *thread,                   struct binder_transaction_data *tr, int reply){    struct binder_transaction *t;    struct binder_work *tcomplete;    size_t *offp, *off_end;    struct binder_proc *target_proc;    struct binder_thread *target_thread = NULL;    struct binder_node *target_node = NULL;    struct list_head *target_list;    wait_queue_head_t *target_wait;    struct binder_transaction *in_reply_to = NULL;    if (reply) {        // BC_REPLY å¤„ç†æµç¨‹        // å¾—åˆ° binder_transaction å¯¹è±¡        in_reply_to = thread-&gt;transaction_stack;        if (in_reply_to == NULL) {            return_error = BR_FAILED_REPLY;            goto err_empty_call_stack;        }        binder_set_nice(in_reply_to-&gt;saved_priority);        thread-&gt;transaction_stack = in_reply_to-&gt;to_parent;        // è·å–ç›®æ ‡çº¿ç¨‹        target_thread = in_reply_to-&gt;from;        target_proc = target_thread-&gt;proc;    } else {        // BC_TRANSACTION å¤„ç†æµç¨‹        // æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹        if (tr-&gt;target.handle) {            struct binder_ref *ref;            // è·å– binder_ref å¯¹è±¡            ref = binder_get_ref(proc, tr-&gt;target.handle);            target_node = ref-&gt;node;        } else {            // ç´¢å¼•ä¸º 0 åˆ™è¿”å› context manager            target_node = binder_context_mgr_node;        }        // å¾—åˆ°ç›®æ ‡è¿›ç¨‹        target_proc = target_node-&gt;proc;        if (!(tr-&gt;flags &amp; TF_ONE_WAY) &amp;&amp; thread-&gt;transaction_stack) {            struct binder_transaction *tmp;            tmp = thread-&gt;transaction_stack;            while (tmp) {                if (tmp-&gt;from &amp;&amp; tmp-&gt;from-&gt;proc == target_proc)                    // è·å¾—ç›®æ ‡çº¿ç¨‹                    target_thread = tmp-&gt;from;                tmp = tmp-&gt;from_parent;            }        }    }    // è®¾ç½®è¦å¤„ç†çš„ç›®æ ‡è¿›ç¨‹æˆ–ç›®æ ‡çº¿ç¨‹ä»»åŠ¡    if (target_thread) {        target_list = &amp;target_thread-&gt;todo;        target_wait = &amp;target_thread-&gt;wait;    } else {        target_list = &amp;target_proc-&gt;todo;        target_wait = &amp;target_proc-&gt;wait;    }    // ä¸º binder_transaction å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´    t = kzalloc(sizeof(*t), GFP_KERNEL);    binder_stats_created(BINDER_STAT_TRANSACTION);    tcomplete = kzalloc(sizeof(*tcomplete), GFP_KERNEL);    binder_stats_created(BINDER_STAT_TRANSACTION_COMPLETE);    // å¦‚æœæ˜¯åŒæ­¥ä¼ è¾“(åŒå‘)ï¼Œåˆ™å°†å½“å‰çš„ binder_thread å¯¹è±¡ä¿å­˜åœ¨ binder_transaction å¯¹è±¡çš„ from ä¸­ã€‚    if (!reply &amp;&amp; !(tr-&gt;flags &amp; TF_ONE_WAY))        t-&gt;from = thread;    else        t-&gt;from = NULL;    // è®¾ç½® binder_transaction å¯¹è±¡    t-&gt;sender_euid = proc-&gt;tsk-&gt;cred-&gt;euid;    t-&gt;to_proc = target_proc;    t-&gt;to_thread = target_thread;    t-&gt;code = tr-&gt;code;    t-&gt;flags = tr-&gt;flags;    t-&gt;priority = task_nice(current);    // ä¸º binder_buffer åˆ†é…å†…å­˜ç©ºé—´    t-&gt;buffer = binder_alloc_buf(target_proc, tr-&gt;data_size,        tr-&gt;offsets_size, !reply &amp;&amp; (t-&gt;flags &amp; TF_ONE_WAY));    // è®¾ç½® binder_buffer    t-&gt;buffer-&gt;allow_user_free = 0;    t-&gt;buffer-&gt;debug_id = t-&gt;debug_id;    t-&gt;buffer-&gt;transaction = t;    t-&gt;buffer-&gt;target_node = target_node;    if (target_node)        binder_inc_node(target_node, 1, 0, NULL);    offp = (size_t *)(t-&gt;buffer-&gt;data + ALIGN(tr-&gt;data_size, sizeof(void *)));    // ä»ç”¨æˆ·ç©ºé—´æ‹·è´æ•°æ®åˆ° binder_buffer    if (copy_from_user(t-&gt;buffer-&gt;data, tr-&gt;data.ptr.buffer, tr-&gt;data_size)) {        return_error = BR_FAILED_REPLY;        goto err_copy_data_failed;    }    if (copy_from_user(offp, tr-&gt;data.ptr.offsets, tr-&gt;offsets_size)) {        return_error = BR_FAILED_REPLY;        goto err_copy_data_failed;    }    off_end = (void *)offp + tr-&gt;offsets_size;    for (; offp &lt; off_end; offp++) {        struct flat_binder_object *fp;        // ä¸º flat_binder_object èµ‹å€¼        fp = (struct flat_binder_object *)(t-&gt;buffer-&gt;data + *offp);        // è½¬æ¢ binder ç±»å‹ï¼Œå¦‚æœæ˜¯ BINDER åˆ™è½¬æ¢ä¸º HANDLEï¼Œ å¦‚æœæ˜¯ HANDLE åˆ™è½¬ä¸º BANDLE        switch (fp-&gt;type) {        case BINDER_TYPE_BINDER:        case BINDER_TYPE_WEAK_BINDER: {            struct binder_ref *ref;            // è·å– binder_node èŠ‚ç‚¹            struct binder_node *node = binder_get_node(proc, fp-&gt;binder);            if (node == NULL) {                node = binder_new_node(proc, fp-&gt;binder, fp-&gt;cookie);                if (node == NULL) {                    return_error = BR_FAILED_REPLY;                    goto err_binder_new_node_failed;                }                node-&gt;min_priority = fp-&gt;flags &amp; FLAT_BINDER_FLAG_PRIORITY_MASK;                node-&gt;accept_fds = !!(fp-&gt;flags &amp; FLAT_BINDER_FLAG_ACCEPTS_FDS);            }            if (fp-&gt;cookie != node-&gt;cookie) {                goto err_binder_get_ref_for_node_failed;            }            // è·å– binder_ref å¯¹è±¡            ref = binder_get_ref_for_node(target_proc, node);            // è½¬æ¢ç±»å‹            if (fp-&gt;type == BINDER_TYPE_BINDER)                fp-&gt;type = BINDER_TYPE_HANDLE;            else                fp-&gt;type = BINDER_TYPE_WEAK_HANDLE;            fp-&gt;handle = ref-&gt;desc;            binder_inc_ref(ref, fp-&gt;type == BINDER_TYPE_HANDLE,                       &amp;thread-&gt;todo);        } break;        case BINDER_TYPE_HANDLE:        case BINDER_TYPE_WEAK_HANDLE: {            // è·å– binder_ref å¯¹è±¡            struct binder_ref*ref = binder_get_ref(proc, fp-&gt;handle);            // è½¬æ¢ç±»å‹            if (ref-&gt;node-&gt;proc == target_proc) {                if (fp-&gt;type == BINDER_TYPE_HANDLE)                    fp-&gt;type = BINDER_TYPE_BINDER;                else                    fp-&gt;type = BINDER_TYPE_WEAK_BINDER;                fp-&gt;binder = ref-&gt;node-&gt;ptr;                fp-&gt;cookie = ref-&gt;node-&gt;cookie;                binder_inc_node(ref-&gt;node, fp-&gt;type == BINDER_TYPE_BINDER, 0, NULL);            } else {                struct binder_ref *new_ref;                new_ref = binder_get_ref_for_node(target_proc, ref-&gt;node);                fp-&gt;handle = new_ref-&gt;desc;                binder_inc_ref(new_ref, fp-&gt;type == BINDER_TYPE_HANDLE, NULL);            }        } break;        // æ–‡ä»¶ç±»å‹        case BINDER_TYPE_FD: {            int target_fd;            struct file *file;            // è·å¾—æ–‡ä»¶å¯¹è±¡            file = fget(fp-&gt;handle);            // åˆ†é…ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦            target_fd = task_get_unused_fd_flags(target_proc, O_CLOEXEC);            task_fd_install(target_proc, target_fd, file);            fp-&gt;handle = target_fd;        } break;        default:            return_error = BR_FAILED_REPLY;            goto err_bad_object_type;        }    }    if (reply) {        // BC_REPLY å¤„ç†æµç¨‹, binder_transaction ä¸­é‡Šæ”¾ binder_transaction å¯¹è±¡        binder_pop_transaction(target_thread, in_reply_to);    } else if (!(t-&gt;flags &amp; TF_ONE_WAY)) {        // åŒæ­¥çŠ¶æ€(åŒå‘)éœ€è¦è®¾ç½®å›å¤        t-&gt;need_reply = 1;        t-&gt;from_parent = thread-&gt;transaction_stack;        thread-&gt;transaction_stack = t;    } else {        // å¼‚æ­¥ä¼ è¾“ä¸éœ€è¦è®¾ç½®å›å¤        if (target_node-&gt;has_async_transaction) {            target_list = &amp;target_node-&gt;async_todo;            target_wait = NULL;        } else            target_node-&gt;has_async_transaction = 1;    }    t-&gt;work.type = BINDER_WORK_TRANSACTION;    list_add_tail(&amp;t-&gt;work.entry, target_list);    tcomplete-&gt;type = BINDER_WORK_TRANSACTION_COMPLETE;    list_add_tail(&amp;tcomplete-&gt;entry, &amp;thread-&gt;todo);    if (target_wait)        // å”¤é†’ç›®æ ‡çº¿ç¨‹        wake_up_interruptible(target_wait);    return;}</code></pre><p><strong>æ•°æ®è¯»å– - binder_thread_read() å‡½æ•°</strong></p><p>ç”¨æˆ·ç©ºé—´ä» binder é©±åŠ¨è¯»å–æ•°æ®ï¼Œä»é©±åŠ¨è§’åº¦æ¥çœ‹æ˜¯å†™å‡ºçš„æ“ä½œã€‚</p><pre><code class="c">static int binder_thread_read(struct binder_proc *proc,                  struct binder_thread *thread,                  void  __user *buffer, int size,                  signed long *consumed, int non_block){    void __user *ptr = buffer + *consumed;    void __user *end = buffer + size;    int ret = 0;    int wait_for_proc_work;    if (*consumed == 0) {        // ç¬¬ä¸€æ¬¡æ“ä½œæ—¶å‘ç”¨æˆ·ç©ºé—´è¿”å› BR_NOOP å‘½ä»¤        if (put_user(BR_NOOP, (uint32_t __user *)ptr))            return -EFAULT;        ptr += sizeof(uint32_t);    }retry:    // è·å–å°†è¦å¤„ç†çš„ä»»åŠ¡    wait_for_proc_work = thread-&gt;transaction_stack == NULL &amp;&amp;                list_empty(&amp;thread-&gt;todo);    if (wait_for_proc_work) {        if (!(thread-&gt;looper &amp; (BINDER_LOOPER_STATE_REGISTERED |                    BINDER_LOOPER_STATE_ENTERED))) {            binder_user_error(&quot;binder: %d:%d ERROR: Thread waiting &quot;                &quot;for process work before calling BC_REGISTER_&quot;                &quot;LOOPER or BC_ENTER_LOOPER (state %x)\n&quot;,                proc-&gt;pid, thread-&gt;pid, thread-&gt;looper);            wait_event_interruptible(binder_user_error_wait,                         binder_stop_on_user_error &lt; 2);        }        binder_set_nice(proc-&gt;default_priority);        if (non_block) {            // éé˜»å¡ä¸”æ²¡æœ‰æ•°æ®åˆ™è¿”å› EAGAIN            if (!binder_has_proc_work(proc, thread))                ret = -EAGAIN;        } else            // é˜»å¡åˆ™è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç­‰å¾…å¯æ“ä½œçš„ä»»åŠ¡            ret = wait_event_freezable_exclusive(proc-&gt;wait, binder_has_proc_work(proc, thread));    } else {        if (non_block) {            if (!binder_has_thread_work(thread))                ret = -EAGAIN;        } else            ret = wait_event_freezable(thread-&gt;wait, binder_has_thread_work(thread));    }    binder_lock(__func__);    if (wait_for_proc_work)        proc-&gt;ready_threads--;    thread-&gt;looper &amp;= ~BINDER_LOOPER_STATE_WAITING;    if (ret)        return ret;    while (1) {        uint32_t cmd;        struct binder_transaction_data tr;        struct binder_work *w;        struct binder_transaction *t = NULL;        // è·å– binder_work å¯¹è±¡        if (!list_empty(&amp;thread-&gt;todo))            w = list_first_entry(&amp;thread-&gt;todo, struct binder_work, entry);        else if (!list_empty(&amp;proc-&gt;todo) &amp;&amp; wait_for_proc_work)            w = list_first_entry(&amp;proc-&gt;todo, struct binder_work, entry);        else {            if (ptr - buffer == 4 &amp;&amp; !(thread-&gt;looper &amp; BINDER_LOOPER_STATE_NEED_RETURN)) /* no data added */                goto retry;            break;        }        if (end - ptr &lt; sizeof(tr) + 4)            break;        switch (w-&gt;type) {        case BINDER_WORK_TRANSACTION: {            // è·å– binder_transaction å¯¹è±¡            t = container_of(w, struct binder_transaction, work);        } break;        case BINDER_WORK_TRANSACTION_COMPLETE: {            cmd = BR_TRANSACTION_COMPLETE;            // è¿”å› BR_TRANSACTION_COMPLETE å‘½ä»¤            if (put_user(cmd, (uint32_t __user *)ptr))                return -EFAULT;            ptr += sizeof(uint32_t);            binder_stat_br(proc, thread, cmd);            // ä» work é“¾è¡¨ä¸­åˆ é™¤å¹¶é‡Šæ”¾å†…å­˜            list_del(&amp;w-&gt;entry);            kfree(w);            binder_stats_deleted(BINDER_STAT_TRANSACTION_COMPLETE);        } break;        case BINDER_WORK_NODE: {            // è·å¾— binder_node èŠ‚ç‚¹            struct binder_node *node = container_of(w, struct binder_node, work);            uint32_t cmd = BR_NOOP;            const char *cmd_name;            // æ ¹æ®èŠ‚ç‚¹ç±»å‹ï¼Œå¢åŠ /è·å–ã€å‡å°‘/é‡Šæ”¾èŠ‚ç‚¹ç´¢å¼•            int strong = node-&gt;internal_strong_refs || node-&gt;local_strong_refs;            int weak = !hlist_empty(&amp;node-&gt;refs) || node-&gt;local_weak_refs || strong;            // æ„é€  BR_* å‘½ä»¤            if (weak &amp;&amp; !node-&gt;has_weak_ref) {                cmd = BR_INCREFS;                cmd_name = &quot;BR_INCREFS&quot;;                node-&gt;has_weak_ref = 1;                node-&gt;pending_weak_ref = 1;                node-&gt;local_weak_refs++;            } else if (strong &amp;&amp; !node-&gt;has_strong_ref) {                cmd = BR_ACQUIRE;                cmd_name = &quot;BR_ACQUIRE&quot;;                node-&gt;has_strong_ref = 1;                node-&gt;pending_strong_ref = 1;                node-&gt;local_strong_refs++;            } else if (!strong &amp;&amp; node-&gt;has_strong_ref) {                cmd = BR_RELEASE;                cmd_name = &quot;BR_RELEASE&quot;;                node-&gt;has_strong_ref = 0;            } else if (!weak &amp;&amp; node-&gt;has_weak_ref) {                cmd = BR_DECREFS;                cmd_name = &quot;BR_DECREFS&quot;;                node-&gt;has_weak_ref = 0;            }            // å‘ç”¨æˆ·ç©ºé—´è¿”å›å‘½ä»¤            if (cmd != BR_NOOP) {                if (put_user(cmd, (uint32_t __user *)ptr))                    return -EFAULT;                ptr += sizeof(uint32_t);                if (put_user(node-&gt;ptr, (void * __user *)ptr))                    return -EFAULT;                ptr += sizeof(void *);                if (put_user(node-&gt;cookie, (void * __user *)ptr))                    return -EFAULT;                ptr += sizeof(void *);                binder_stat_br(proc, thread, cmd);            } else {                list_del_init(&amp;w-&gt;entry);                if (!weak &amp;&amp; !strong) {                    rb_erase(&amp;node-&gt;rb_node, &amp;proc-&gt;nodes);                    kfree(node);                    binder_stats_deleted(BINDER_STAT_NODE);                }            }        } break;        case BINDER_WORK_DEAD_BINDER:        case BINDER_WORK_DEAD_BINDER_AND_CLEAR:        case BINDER_WORK_CLEAR_DEATH_NOTIFICATION: {            struct binder_ref_death *death;            uint32_t cmd;            // è·å– binder_ref_death å¯¹è±¡            death = container_of(w, struct binder_ref_death, work);            // æ„é€ è¿”å›å‘½ä»¤            if (w-&gt;type == BINDER_WORK_CLEAR_DEATH_NOTIFICATION)                cmd = BR_CLEAR_DEATH_NOTIFICATION_DONE;            else                cmd = BR_DEAD_BINDER;            // å‘ç”¨æˆ·ç©ºé—´è¿”å›å‘½ä»¤            if (put_user(cmd, (uint32_t __user *)ptr))                return -EFAULT;            ptr += sizeof(uint32_t);            // å°† cookie è¿”å›ç»™ç”¨æˆ·ç©ºé—´            if (put_user(death-&gt;cookie, (void * __user *)ptr))                return -EFAULT;            ptr += sizeof(void *);            binder_stat_br(proc, thread, cmd);            if (w-&gt;type == BINDER_WORK_CLEAR_DEATH_NOTIFICATION) {                list_del(&amp;w-&gt;entry);                kfree(death);                binder_stats_deleted(BINDER_STAT_DEATH);            } else                list_move(&amp;w-&gt;entry, &amp;proc-&gt;delivered_death);            if (cmd == BR_DEAD_BINDER)                goto done; /* DEAD_BINDER notifications can cause transactions */        } break;        }        if (!t)            continue;        if (t-&gt;buffer-&gt;target_node) {            // è·å¾— binder_node èŠ‚ç‚¹            struct binder_node *target_node = t-&gt;buffer-&gt;target_node;            // å°†æ•°æ®å°è£…åˆ° binder_transaction_data å¯¹è±¡            tr.target.ptr = target_node-&gt;ptr;            tr.cookie =  target_node-&gt;cookie;            t-&gt;saved_priority = task_nice(current);            if (t-&gt;priority &lt; target_node-&gt;min_priority &amp;&amp;                !(t-&gt;flags &amp; TF_ONE_WAY))                binder_set_nice(t-&gt;priority);            else if (!(t-&gt;flags &amp; TF_ONE_WAY) ||                 t-&gt;saved_priority &gt; target_node-&gt;min_priority)                binder_set_nice(target_node-&gt;min_priority);            // è®¾ç½®è¿”å›çš„å‘½ä»¤ç±»å‹            cmd = BR_TRANSACTION;        } else {            tr.target.ptr = NULL;            tr.cookie = NULL;            cmd = BR_REPLY;        }        tr.code = t-&gt;code;        tr.flags = t-&gt;flags;        tr.sender_euid = t-&gt;sender_euid;        if (t-&gt;from) {            struct task_struct *sender = t-&gt;from-&gt;proc-&gt;tsk;            tr.sender_pid = task_tgid_nr_ns(sender,                            current-&gt;nsproxy-&gt;pid_ns);        } else {            tr.sender_pid = 0;        }        tr.data_size = t-&gt;buffer-&gt;data_size;        tr.offsets_size = t-&gt;buffer-&gt;offsets_size;        tr.data.ptr.buffer = (void *)t-&gt;buffer-&gt;data +                    proc-&gt;user_buffer_offset;        tr.data.ptr.offsets = tr.data.ptr.buffer +                    ALIGN(t-&gt;buffer-&gt;data_size,                        sizeof(void *));        if (put_user(cmd, (uint32_t __user *)ptr))            return -EFAULT;        ptr += sizeof(uint32_t);        // æ‹·è´ binder_transaction_data å¯¹è±¡åˆ°ç”¨æˆ·ç©ºé—´        if (copy_to_user(ptr, &amp;tr, sizeof(tr)))            return -EFAULT;        ptr += sizeof(tr);        binder_stat_br(proc, thread, cmd);        // ç§»é™¤ binder_transaction å¹¶é‡Šæ”¾ç©ºé—´        list_del(&amp;t-&gt;work.entry);        t-&gt;buffer-&gt;allow_user_free = 1;        // å¦‚æœæ˜¯åŒæ­¥æ“ä½œï¼Œåˆ™å°† thread å¯¹è±¡ä¿å­˜åœ¨ binder_transaction ä¸­ï¼Œè¿”å›ç»™å‘é€æ–¹è¿›ç¨‹, å¦åˆ™é‡Šæ”¾ binder_transaction å¯¹è±¡        if (cmd == BR_TRANSACTION &amp;&amp; !(t-&gt;flags &amp; TF_ONE_WAY)) {            t-&gt;to_parent = thread-&gt;transaction_stack;            t-&gt;to_thread = thread;            thread-&gt;transaction_stack = t;        } else {            t-&gt;buffer-&gt;transaction = NULL;            kfree(t);            binder_stats_deleted(BINDER_STAT_TRANSACTION);        }        break;    }}</code></pre><p>ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡º binder é©±åŠ¨çš„å…·ä½“å®ç°ï¼Œä»¥åŠæ˜¯å¦‚ä½•å‘é€å’Œæ¥æ”¶æ•°æ®çš„ã€‚</p><h2 id="5-Binder-ä¸ç³»ç»ŸæœåŠ¡"><a href="#5-Binder-ä¸ç³»ç»ŸæœåŠ¡" class="headerlink" title="5. Binder ä¸ç³»ç»ŸæœåŠ¡"></a>5. Binder ä¸ç³»ç»ŸæœåŠ¡</h2><h3 id="5-1-Context-getSystemService"><a href="#5-1-Context-getSystemService" class="headerlink" title="5.1 Context.getSystemService()"></a>5.1 Context.getSystemService()</h3><p>Android ç³»ç»Ÿåœ¨å¯åŠ¨åä¼šåœ¨åå°è¿è¡Œå¾ˆå¤šç³»ç»ŸæœåŠ¡æä¾›ç»™åº”ç”¨ä½¿ç”¨ï¼Œè¿™äº› <a href="http://developer.android.com/reference/android/content/Context.html#getSystemService(java.lang.Class&lt;T" target="_blank" rel="noopener">æœåŠ¡</a>) ä¸»è¦æœ‰ <code>WindowManager, LayoutInflater, ActivityManager, PowerManager, AlarmManager, NotificationManager, KeyguardManager, LocationManager, SearchManager, Vibrator, ConnectivityManager, WifiManager, AudioManager, MediaRouter, TelephonyManager, SubscriptionManager, InputMethodManager, UiModeManager, DownloadManager, BatteryManager, JobScheduler, NetworkStatsManager</code></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Context.getSystemService(String name)</code> æ¥è·å– <a href="http://developer.android.com/reference/android/content/Context.html#getSystemService(java.lang.String" target="_blank" rel="noopener">æœåŠ¡</a>)ã€‚</p><p>ä¾‹å¦‚ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•ä» xml ä¸­æ’å…¥æ–°çš„è§†å›¾</p><pre><code>LayoutInflater inflater = (LayoutInflater) getSystemService(LAYOUT_INFLATER_SERVICE);inflater.inflate(R.layout.view, root, true);</code></pre><h3 id="5-2-Context-getSystemService-æºç åˆ†æ"><a href="#5-2-Context-getSystemService-æºç åˆ†æ" class="headerlink" title="5.2 Context.getSystemService() æºç åˆ†æ"></a>5.2 Context.getSystemService() æºç åˆ†æ</h3><p>è¿½è¸ª <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/ContextImpl.java#L1364" target="_blank" rel="noopener">ContextImpl</a> <code>getSystemService()</code> æºä»£ç </p><pre><code class="java">    @Override    public Object getSystemService(String name) {        return SystemServiceRegistry.getSystemService(this, name);    }</code></pre><p>ç»§ç»­è¿½è¸ª <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/SystemServiceRegistry.java#L719" target="_blank" rel="noopener">SystemServiceRegistry</a> æºä»£ç </p><pre><code class="java">    /**     * Gets a system service from a given context.     */    public static Object getSystemService(ContextImpl ctx, String name) {        ServiceFetcher&lt;?&gt; fetcher = SYSTEM_SERVICE_FETCHERS.get(name);        return fetcher != null ? fetcher.getService(ctx) : null;    }</code></pre><p>è¿½è¸ª <code>SYSTEM_SERVICE_FETCHERS</code> å¯ä»¥å‘ç°åœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/SystemServiceRegistry.java#L318" target="_blank" rel="noopener">SystemServiceRegistry</a> é™æ€åŒºä¸­æ³¨å†Œäº†å‡ ä¹æ‰€æœ‰çš„ç³»ç»ŸæœåŠ¡</p><pre><code class="java">    registerService(Context.LAYOUT_INFLATER_SERVICE, LayoutInflater.class,            new CachedServiceFetcher&lt;LayoutInflater&gt;() {        @Override        public LayoutInflater createService(ContextImpl ctx) {            return new PhoneLayoutInflater(ctx.getOuterContext());        }});    registerService(Context.LOCATION_SERVICE, LocationManager.class,            new CachedServiceFetcher&lt;LocationManager&gt;() {        @Override        public LocationManager createService(ContextImpl ctx) {            IBinder b = ServiceManager.getService(Context.LOCATION_SERVICE);            return new LocationManager(ctx, ILocationManager.Stub.asInterface(b));        }});</code></pre><p>ä¸Šé¢ä»£ç ç‰‡æ–­ä¸­ï¼Œ<a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/app/SystemServiceRegistry.java#L322" target="_blank" rel="noopener">PhoneLayoutInflater</a> æœ€ç»ˆå›åˆ°äº† <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/view/LayoutInflater.java#L204" target="_blank" rel="noopener">LayoutInflater</a>ã€‚è€Œ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/location/java/android/location/LocationManager.java#L315" target="_blank" rel="noopener">LocationManager</a> åˆ™æ˜¯å¯¹ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/location/java/android/location/ILocationManager.aidl#L39" target="_blank" rel="noopener">ILocationManager</a> çš„å°è£…ã€‚å¯ä»¥å‘ç°ï¼Œåœ¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/tree/master/frameworks/base/location/java/android/location" target="_blank" rel="noopener">frameworks/base/location/java/android/location</a> åŒ…ä¸‹å«æœ‰å¤§é‡çš„ AIDL æ–‡ä»¶ã€‚</p><p>ç»§ç»­è¿½è¸ª <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/os/ServiceManager.java#L49" target="_blank" rel="noopener">ServiceManager.getService(Context.LOCATION_SERVICE)</a> </p><pre><code class="java">    private static IServiceManager getIServiceManager() {        if (sServiceManager != null) {            return sServiceManager;        }        // Find the service manager        sServiceManager = ServiceManagerNative.asInterface(BinderInternal.getContextObject());        return sServiceManager;    }    /**     * Returns a reference to a service with the given name.     *      * @param name the name of the service to get     * @return a reference to the service, or &lt;code&gt;null&lt;/code&gt; if the service doesn&#39;t exist     */    public static IBinder getService(String name) {        try {            IBinder service = sCache.get(name);            if (service != null) {                return service;            } else {                return getIServiceManager().getService(name);            }        } catch (RemoteException e) {            Log.e(TAG, &quot;error in getService&quot;, e);        }        return null;    }</code></pre><p>ä»ä¸Šé¢ä»£ç ç‰‡æ–­å¯ä»¥çœ‹å‡ºï¼Œ<code>ServiceManager</code> ä¼šä» <code>sCache</code> ç¼“å­˜æˆ– <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/os/ServiceManagerNative.java#L33" target="_blank" rel="noopener">IServiceManager</a> ä¸­æŸ¥æ‰¾æœåŠ¡å¹¶è¿”å›ä¸€ä¸ª <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/os/IBinder.java#L85" target="_blank" rel="noopener">IBinder</a> å¯¹è±¡ã€‚è¿™ä¸ª <code>IBinder</code> å°±æ˜¯ä¸€ä¸ªè¿œç¨‹å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å®ƒä¸å…¶ä»–è¿›ç¨‹äº¤äº’ã€‚ </p><p>ç»§ç»­æ·±å…¥ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/os/ServiceManager.java#L55" target="_blank" rel="noopener">getIServiceManager().getService(name)</a> , è¿›å…¥ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/os/ServiceManagerNative.java#L33" target="_blank" rel="noopener">ServiceManagerNative</a> </p><pre><code class="java">    /**     * Cast a Binder object into a service manager interface, generating     * a proxy if needed.     */    static public IServiceManager asInterface(IBinder obj)    {        if (obj == null) {            return null;        }        IServiceManager in =            (IServiceManager)obj.queryLocalInterface(descriptor);        if (in != null) {            return in;        }        return new ServiceManagerProxy(obj);    }    class ServiceManagerProxy implements IServiceManager {        public ServiceManagerProxy(IBinder remote) {            mRemote = remote;        }        public IBinder asBinder() {            return mRemote;        }        public IBinder getService(String name) throws RemoteException {            Parcel data = Parcel.obtain();            Parcel reply = Parcel.obtain();            data.writeInterfaceToken(IServiceManager.descriptor);            data.writeString(name);            mRemote.transact(GET_SERVICE_TRANSACTION, data, reply, 0);            IBinder binder = reply.readStrongBinder();            reply.recycle();            data.recycle();            return binder;        }        private IBinder mRemote;    }</code></pre><p>ä»ä¸Šè¾¹ä»£ç ç‰‡æ–­å¯ä»¥çœ‹åˆ°ï¼Œ<code>ServiceManager.getIServiceManager()</code> è¿”å›çš„æ˜¯ä¸€ä¸ª <code>ServiceManagerProxy</code>, è€Œ <code>ServiceManager.getService()</code> åˆ™æ˜¯åœ¨ <code>ServiceManagerProxy</code> ä¸­é€šè¿‡ <code>ServiceManager</code> çš„è¿œç¨‹ <code>Binder</code> å¯¹è±¡ <code>mRemote</code>ï¼Œæ“ä½œ <code>Parcel</code> æ•°æ®ï¼Œè°ƒç”¨ <a href="https://github.com/xdtianyu/android-6.0.0_r1/blob/master/frameworks/base/core/java/android/os/IBinder.java#L223" target="_blank" rel="noopener">IBinder.transact(int code, Parcel data, Parcel reply, int flags)</a> æ–¹æ³•æ¥å‘é€è¯·æ±‚ï¼Œå¹¶é€šè¿‡ <code>reply.readStrongBinder()</code> è¿”å›äº†è¦æŸ¥æ‰¾çš„æœåŠ¡çš„è¿œç¨‹å¯¹è±¡ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»ŸæœåŠ¡çš„è·å–æ–¹å¼ä¹Ÿæ˜¯é€šè¿‡ AIDL çš„æ–¹å¼å®ç°çš„ã€‚</p><h2 id="6-ç»“è®º"><a href="#6-ç»“è®º" class="headerlink" title="6. ç»“è®º"></a>6. ç»“è®º</h2><p>1. Binder çš„å®ç°æ¶‰åŠåˆ° kernel é©±åŠ¨ï¼Œæœ¬åœ°å±‚ï¼ŒJNI å’Œåº”ç”¨å±‚ï¼Œè´¯ç©¿äº†æ•´ä¸ª ï¼¡ndroid ç³»ç»Ÿã€‚ç³»ç»ŸæœåŠ¡è·å–ã€Activity/Service å¯åŠ¨ã€Intentçš„ä¼ é€’ç­‰éƒ½ç¦»ä¸å¼€ binder,è¦æŒæ¡ binder çš„åŸç†éœ€è¦æ·±å…¥åˆ°ç³»ç»Ÿçš„æ¯ä¸€å±‚ä»£ç ã€‚</p><p>2. ä¸Šå±‚çš„ <code>android.os.Binder</code> åªæ˜¯å¯¹ binder çš„åˆä¸€æ¬¡æŠ½è±¡å°è£…ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸­ä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥ä½¿ç”¨ã€‚</p><p>3. AIDL æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”¨äºå°è£… Binder æ“ä½œçš„å·¥å…·ï¼Œæœ€ç»ˆçš„è¿›ç¨‹é—´é€šä¿¡ç”± Binder çš„ <code>transact</code> å’Œ <code>onTransact</code> å®Œæˆã€‚æˆ‘ä»¬åœ¨åº”ç”¨ä¸­å®ç° AIDL æ¥å£ï¼Œå¯ä»¥å¿«é€Ÿå®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚</p><h2 id="7-å‚è€ƒ"><a href="#7-å‚è€ƒ" class="headerlink" title="7. å‚è€ƒ"></a>7. å‚è€ƒ</h2><p><a href="http://wangkuiwu.github.io/2014/09/01/Binder-Introduce/" target="_blank" rel="noopener">Android Binderæœºåˆ¶</a></p><p><a href="http://blog.csdn.net/luoshengyang/article/details/6618363" target="_blank" rel="noopener">Androidè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æœºåˆ¶Binder</a></p><p><a href="https://www.nds.rub.de/media/attachments/files/2012/03/binder.pdf" target="_blank" rel="noopener">Android Binder</a></p><p><a href="http://rts.lab.asu.edu/web_438/project_final/CSE_598_Android_Architecture_Binder.pdf" target="_blank" rel="noopener">Android Architecture Binder</a></p><p><a href="http://liuxiangtian.github.io/2016/01/07/AIDL%E4%B8%8EBinder%E6%A1%86%E6%9E%B6%E6%B5%85%E8%B0%88/" target="_blank" rel="noopener">AIDLä¸Binderæ¡†æ¶æµ…è°ˆ</a></p><p><a href="https://github.com/hehonghui/android-tech-frontier/blob/master/issue-22/Binder%E6%A1%86%E6%9E%B6%E8%A7%A3%E6%9E%90.md" target="_blank" rel="noopener">Binderæ¡†æ¶è§£æ</a></p><p><a href="http://events.linuxfoundation.org/images/stories/slides/abs2013_gargentas.pdf" target="_blank" rel="noopener">Deep Dive into Android IPC/Binder Framework at Android Builders Summit 2013</a></p><p><a href="https://www.youtube.com/watch?v=NWhyADzgoiI" target="_blank" rel="noopener">Android Builders Summit 2013 - Deep Dive into Android IPC/Binder Framework (video)</a></p><p><a href="http://blog.csdn.net/u010961631/article/details/20479507" target="_blank" rel="noopener">Binderæºç åˆ†æä¹‹é©±åŠ¨å±‚ï¼ˆåŸï¼‰</a></p><p><a href="http://blog.csdn.net/yangwen123/article/details/9316987" target="_blank" rel="noopener">æ·±å…¥åˆ†æAndroid Binder é©±åŠ¨</a></p><p><a href="http://blog.csdn.net/qq429205464/article/details/7822442" target="_blank" rel="noopener">æ„é€ IOCTLå‘½ä»¤çš„å­¦ä¹ å¿ƒå¾—â€”â€“_IO, _IOR, _IOW, _IOWR å¹»æ•°çš„ç†è§£</a></p><p><a href="http://blog.csdn.net/21cnbao/article/details/8087354" target="_blank" rel="noopener">Serviceä¸Androidç³»ç»Ÿè®¾è®¡ï¼ˆ7ï¼‰â€” Binderé©±åŠ¨</a></p><p><a href="https://web.archive.org/web/20101016004342/http://www.gmier.com/node/11" target="_blank" rel="noopener">Android Binder</a></p><p><a href="http://www.cnblogs.com/zhangxinyan/p/3487889.html" target="_blank" rel="noopener">Binderæœºåˆ¶ï¼Œä»Javaåˆ°C ï¼ˆ7. Native Serviceï¼‰</a></p><hr><p><strong>å¾…è¡¥å……çš„å†…å®¹</strong></p><p>1. å®¢æˆ·ç«¯ bindService() æµç¨‹åŠæºç åˆ†æ</p><p>2. Binder Native å±‚å…¶ä»–æºç æ–‡ä»¶åˆ†æ</p><p>3. ç³»ç»ŸæœåŠ¡ï¼ˆSystemServiceï¼‰è¯¦ç»†åˆ—è¡¨åŠåœ¨æœ¬åœ°å±‚çš„æºç åˆ†æ</p><p>4. SystemManager æºç åˆ†æ</p><p>5. å®Œå–„ binder é©±åŠ¨å†…å®¹ï¼Œè¡¥å……å…³ç³»å›¾</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;forked from &lt;a href=&quot;https://github.com/xdtianyu/SourceAnalysis&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;xdtianyu/SourceAnalysis&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯åŸºäº &lt;a href=&quot;https://github.com/xdtianyu/android-6.0.0_r1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Android 6.0.0&lt;/a&gt; å’Œ &lt;a href=&quot;https://github.com/xdtianyu/android-msm-hammerhead-3.4-marshmallow&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;kernel 3.4&lt;/a&gt; æºç  åŠ Android SDK 23 å±•å¼€çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆä¸Šä¸€å¼ å›¾ï¼Œç›´ç™½çš„äº†è§£ Binder é€šä¿¡è¿‡ç¨‹ã€‚(æ‘˜è‡ª&lt;a href=&quot;http://mp.weixin.qq.com/s/YVvV3-RUjbqYo-DYY3E6nA&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¶…è¯¦ç»† Android é¢è¯•çš„å‡†å¤‡ä¸ç»å†åˆ†äº« | ç™¾åº¦ (offer)&lt;/a&gt;)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/assets/å­¦ä¹ èµ„æ–™/é¢è¯•å°æœ­/Binderé€šä¿¡è¿‡ç¨‹.png&quot; alt&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Android" scheme="https://yangxiaoge.github.io/categories/Android/"/>
    
    
      <category term="Binder" scheme="https://yangxiaoge.github.io/tags/Binder/"/>
    
  </entry>
  
  <entry>
    <title>Android Oä¸Šæ‰‹ä½“éªŒ</title>
    <link href="https://yangxiaoge.github.io/2017/05/19/2017-05-19-Android-O%E4%B8%8A%E6%89%8B%E4%BD%93%E9%AA%8C/"/>
    <id>https://yangxiaoge.github.io/2017/05/19/2017-05-19-Android-Oä¸Šæ‰‹ä½“éªŒ/</id>
    <published>2017-05-19T13:34:15.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p>2017 Google IO å¼€å‘è€…å¤§ä¼š, äºåŒ—äº¬æ—¶é—´ 5 æœˆ 18 æ—¥å‡Œæ™¨ 1 ç‚¹ä¸¾åŠäº†ï¼Œå…·ä½“çš„å†…å®¹è¯·çœ‹ <a href="http://blog.csdn.net/googdev/article/details/72514716#0-tsina-1-11403-397232819ff9a47a7b7e80a40613cfe1" target="_blank" rel="noopener">stormzhang</a> ï¼ˆå¸…æ¯”å¼ å»äº†åŠ å·ç°åœºè¿˜å¼€äº†ä¸ªç›´æ’­ï¼Œç»ˆäºçœ‹åˆ°äº†ä¸€ä¸ªä¼šåŠ¨çš„å¸…æ¯”å¼ ï¼Œå“ˆå“ˆï¼‰ã€‚<a id="more"></a><br>æœ‰å‡ ä¸ªé‡è¦çš„äº‹ä»¶ï¼šGoogle AIï¼ŒAndroid Oï¼ŒKotlinï¼Œç­‰ç­‰<br>æœ¬æ–‡é‡ç‚¹æ˜¯ Android O çš„ä¸Šæ‰‹è§†é¢‘ï¼Œè¿«ä¸åŠå¾…çš„æŠŠæµ‹è¯•æœº Nexus 5X åˆ·æˆäº† Android 0ï¼Œ<a href="https://developer.android.com/preview/download.html" target="_blank" rel="noopener">Android O ç³»ç»Ÿæ˜ åƒæ–‡ä»¶ä¸‹è½½</a>ï¼Œå®˜ç½‘ä»‹ç»ç‰¹æ€§ï¼š<a href="https://developer.android.com/preview/index.html" target="_blank" rel="noopener">Android O æ–°ç‰¹æ€§ä»‹ç»</a>ã€‚</p><p><strong>ä¸Šæ‰‹è§†é¢‘ï¼š</strong><br><!--<video height="800" controls>    <source src="/img/video/Android8.0device-2017-05-19-131435.mp4"></video>--><br><!--å®½å æ»¡ï¼Œé«˜åº¦è‡ªé€‚åº”ã€‚ poster é¢„åŠ è½½æ˜¾ç¤ºçš„å›¾åƒ--></p><video height="700" id="video" controls preload="none" poster="/img/video/Android_O_Preload.png"><br>      <source id="mp4" src="/img/video/Android8.0device-2017-05-19-131435.mp4" type="video/mp4"><br></video>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;2017 Google IO å¼€å‘è€…å¤§ä¼š, äºåŒ—äº¬æ—¶é—´ 5 æœˆ 18 æ—¥å‡Œæ™¨ 1 ç‚¹ä¸¾åŠäº†ï¼Œå…·ä½“çš„å†…å®¹è¯·çœ‹ &lt;a href=&quot;http://blog.csdn.net/googdev/article/details/72514716#0-tsina-1-11403-397232819ff9a47a7b7e80a40613cfe1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;stormzhang&lt;/a&gt; ï¼ˆå¸…æ¯”å¼ å»äº†åŠ å·ç°åœºè¿˜å¼€äº†ä¸ªç›´æ’­ï¼Œç»ˆäºçœ‹åˆ°äº†ä¸€ä¸ªä¼šåŠ¨çš„å¸…æ¯”å¼ ï¼Œå“ˆå“ˆï¼‰ã€‚
    
    </summary>
    
      <category term="Android O" scheme="https://yangxiaoge.github.io/categories/Android-O/"/>
    
    
      <category term="Android O" scheme="https://yangxiaoge.github.io/tags/Android-O/"/>
    
  </entry>
  
  <entry>
    <title>Androidè¾“å…¥æ³•åŠ å¯†ç ”ç©¶</title>
    <link href="https://yangxiaoge.github.io/2017/05/09/2017-05-09-Android%E8%BE%93%E5%85%A5%E6%B3%95%E5%8A%A0%E5%AF%86%E7%A0%94%E7%A9%B6/"/>
    <id>https://yangxiaoge.github.io/2017/05/09/2017-05-09-Androidè¾“å…¥æ³•åŠ å¯†ç ”ç©¶/</id>
    <published>2017-05-09T09:51:03.000Z</published>
    <updated>2019-03-14T01:40:22.198Z</updated>
    
    <content type="html"><![CDATA[<p>è¿‘æœŸæ¥åˆ°ä¸€ä¸ªå¾®ä¿¡ï¼ŒQQ èŠå¤©æ—¶åŠ å¯†æ–‡å­—çš„éœ€æ±‚ã€‚<br>æˆ‘å½“æ—¶çš„å¿ƒæƒ…æ˜¯è¿™æ ·çš„ï¼š<br><img src="/img/Androidè¾“å…¥æ³•åŠ å¯†ç ”ç©¶/kidding_me.png" width="150" alt="are you kidding me?" align="center"><br><a id="more"></a></p><h2 id="å¼€æºé¡¹ç›®å…¥æ‰‹"><a href="#å¼€æºé¡¹ç›®å…¥æ‰‹" class="headerlink" title="å¼€æºé¡¹ç›®å…¥æ‰‹"></a>å¼€æºé¡¹ç›®å…¥æ‰‹</h2><p>å†·é™ä¸‹æ¥ï¼Œç»†ç»†æ€è€ƒï¼Œè¦ä¸å¼€å‘ä¸€ä¸ªè¾“å…¥æ³•ï¼Ÿæˆ‘è¿™æ˜¯è¦æŒ‘æˆ˜æœç‹—è¾“å…¥æ³•ä¸€ä¸ªå›¢é˜Ÿå—ï¼Œä¸ç°å®å‘€ï¼ç„¶åå°±æ‰¾åˆ°äº† Goolge å¼€æºçš„ PinyinIMEï¼ˆAndroid 4.4.4ï¼‰ã€‚<br>æ¯•ç«Ÿè¾“å…¥æ³•å°†è¾“å…¥çš„æ–‡å­—è®¾ç½®åˆ°ç¼–è¾‘æ¡†è¦èµ° BaseInputConnection ä¸­ commitText æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘å°±æƒ³åœ¨è¿™ä¸ªåœ°æ–¹åŠ¨æ‰‹è„šå‘—ã€‚å—¯ï¼Œè¯´å¹²å°±å¹²ï¼Œæˆ‘å°±æ’¸äº†ä¸€ä¸‹ PinyinIME é¡¹ç›®ä¸­çš„ä»£ç ï¼Œå®ç°æ•ˆæœå¦‚ä¸‹ï¼š(åŠ å¯†åçš„æ–‡å­—åé¢æˆ‘åŠ äº†ä¸€ä¸ª â€œä¸­â€ å­—)<br><img src="/img/Androidè¾“å…¥æ³•åŠ å¯†ç ”ç©¶/æ’¸äº†ä¸ªåŠ å¯†.png" width="350" alt="åŠ å¯†å‰å" align="center"></p><p>å“å‘¦ï¼Œçœ‹ç€ä¹Ÿè¿˜å‡‘æ´»å“ˆã€‚å—¯ï¼Œç„¶åæ‰“å¼€æœç‹—ï¼Œç™¾åº¦è¾“å…¥æ³•ä¸€çœ‹ï¼Œç”¨æˆ·å°±ä¸ä¹æ„äº†ï¼Œä½ å®¶è¾“å…¥æ³•çœŸæŒ«ï¼ä¸€æ€’ä¹‹ä¸‹ä¸ç”¨äº†ã€‚è™½ç„¶è¿™æ˜¯ä¸ªç¬‘è¯ï¼Œä½†æ˜¯å¼€å‘è¾“å…¥æ³•ä»£ä»·å¤ªå¤§äº†ï¼Œæ¯•ç«Ÿè¦å¤§é‡æ—¶é—´ï¼ŒäººåŠ›ã€‚</p><h2 id="æºç åˆ†æå…¥æ‰‹"><a href="#æºç åˆ†æå…¥æ‰‹" class="headerlink" title="æºç åˆ†æå…¥æ‰‹"></a>æºç åˆ†æå…¥æ‰‹</h2><p>æ‰€ä»¥å•Šï¼Œæˆ‘æƒ³è¦ä¸ä»ç³»ç»Ÿå±‚å…¥æ‰‹ï¼Ÿï¼ˆ<a href="https://developer.android.com/reference/android/inputmethodservice/InputMethodService.html?hl=zh-cn" target="_blank" rel="noopener">æŸ¥äº†ä¸‹ Api</a>ï¼‰</p><ul><li><p><code>frameworks/base/...</code> ä¸‹æœ‰ä¸ªç±» <code>InputMethodManager</code> (è¾“å…¥æ³•ç®¡ç†å™¨ï¼Œç®¡ç†å„éƒ¨åˆ†çš„äº¤äº’ã€‚å®ƒæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯APIï¼Œå­˜åœ¨äºå„ä¸ªåº”ç”¨ç¨‹åºçš„ context ä¸­ï¼Œç”¨æ¥æ²Ÿé€šç®¡ç†æ‰€æœ‰è¿›ç¨‹é—´äº¤äº’çš„å…¨å±€ç³»ç»ŸæœåŠ¡ã€‚) ä¸­æœ‰ä¸ªæ–¹æ³• showSoftInput (View view, int flags, ResultReceiver resultReceiver)ã€‚ æ³¨æ„åˆ°ä¸€ä¸ª view å‚æ•°ï¼Œæ­¤å‚æ•°å°±æ˜¯è¾“å…¥æ¡†ï¼ˆå¾®ä¿¡ï¼ŒQQï¼Œç­‰è¾“å…¥æ¡†ï¼Œwebviewé™¤å¤–ï¼‰çš„ Viewï¼Œæ—¢ç„¶æœ‰äº† viewï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥ getTextï¼ŒsetText ç­‰ç­‰æ“ä½œã€‚<br>æˆ‘å°† view ä¸­çš„å†…å®¹ Toast å‡ºæ¥æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/img/Androidè¾“å…¥æ³•åŠ å¯†ç ”ç©¶/input_method2.png" width="350" alt="InputMethodManagerä¸­è·å–è¾“å…¥æ¡†å¯¹è±¡ï¼Œéšæ—¶å¯ä»¥è·å–æ–‡æœ¬" align="center"></p></li><li><p><code>InputMethodService</code>ï¼Œæ¯ä¸ª<code>è¾“å…¥æ³• App</code> åº”ç”¨éƒ½æ˜¯ç»§æ‰¿è‡ªå®ƒï¼é‚£ä¹ˆå°±å¯ä»¥å¯¹å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸‹æ‰‹äº†ã€‚è¾“å…¥æ³•æ˜¾ç¤ºçš„æ—¶å€™å¼€å¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æœåŠ¡ï¼ˆæœ‰æ‚¬æµ®çª—çš„ï¼‰ï¼Œè¾“å…¥æ³•å…³é—­çš„æ—¶å€™ç»“æŸæœåŠ¡å¹¶ä¸”é‡Šæ”¾ç›¸åº”çš„é™æ€å˜é‡ã€‚é‡ç‚¹å°±åœ¨äºç”Ÿå‘½å‘¨æœŸçš„ç ”ç©¶ï¼</p></li><li><p>ç›®çš„æ˜¯ï¼Œå°† <code>InputMethodManager</code> ä¸­çš„ ç¼–è¾‘æ¡† View å¯¹è±¡å­˜èµ·æ¥ï¼Œç„¶ååœ¨ InputMethodService ä¸­å¯åŠ¨çš„æœåŠ¡ æš‚ä¸”å«åš <code>MyFloatEncryService</code> ä¸­è·å–è¿™ä¸ª Viewï¼Œä¹‹åå°±ç›´æ¥å¯ä»¥ getï¼Œset åŠ å¯†äº†ã€‚</p></li></ul><p>å®ç°æ–¹æ¡ˆåœ¨å¼€å‘ä¸­ï¼Œåç»­è¡¥å……~~~ </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿‘æœŸæ¥åˆ°ä¸€ä¸ªå¾®ä¿¡ï¼ŒQQ èŠå¤©æ—¶åŠ å¯†æ–‡å­—çš„éœ€æ±‚ã€‚&lt;br&gt;æˆ‘å½“æ—¶çš„å¿ƒæƒ…æ˜¯è¿™æ ·çš„ï¼š&lt;br&gt;&lt;img src=&quot;/img/Androidè¾“å…¥æ³•åŠ å¯†ç ”ç©¶/kidding_me.png&quot; width=&quot;150&quot; alt=&quot;are you kidding me?&quot; align=&quot;center&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="è¾“å…¥æ³•" scheme="https://yangxiaoge.github.io/categories/%E8%BE%93%E5%85%A5%E6%B3%95/"/>
    
    
      <category term="è¾“å…¥æ³•" scheme="https://yangxiaoge.github.io/tags/%E8%BE%93%E5%85%A5%E6%B3%95/"/>
    
  </entry>
  
</feed>
